import{w as c}from"./Dd9dlJ0t.js";import{A as o}from"./C3wcvxbl.js";import{q as s,c as u,d,f}from"./Cc16BkMR.js";const m={musicVolume:.4,ambienceVolume:.6,currentAmbience:"none",whiteNoiseVolume:.5,currentWhiteNoise:"none",isMuted:!1,availableAlbums:[],isLoadingLibrary:!0,playlist:[],currentTrackIndex:0,isPlaying:!1,activeVibe:"custom",duration:0,currentTime:0,seekRequest:null,repeatMode:"off",shuffle:!1},n=c(m);let i=!1;const l="v3_r2_migration";async function A(){if(!i){if(i=!0,typeof localStorage<"u"){const e=localStorage.getItem("chillchess_albums_cache"),a=localStorage.getItem("chillchess_cache_version");if(e&&a===l)try{const t=JSON.parse(e);console.log("[AudioLibrary] Loaded from cache (Instant)."),n.update(r=>({...r,availableAlbums:t,isLoadingLibrary:!1}))}catch(t){console.warn("Invalid cache",t)}else console.log("[AudioLibrary] Cache outdated or missing, fetching fresh.")}try{const e=s(u(d,"albums")),a=await f(e);if(!a.empty){const t=a.docs.map(r=>({...r.data(),id:r.id}));console.log(`[AudioLibrary] Synced ${t.length} albums from Cloud.`),n.update(r=>({...r,availableAlbums:t,isLoadingLibrary:!1})),typeof localStorage<"u"&&(localStorage.setItem("chillchess_albums_cache",JSON.stringify(t)),localStorage.setItem("chillchess_cache_version",l));return}}catch(e){console.warn("[AudioLibrary] Connection error, keeping cached or static version:",e)}n.update(e=>e.availableAlbums.length>0?e:(console.log("[AudioLibrary] Using static fallback."),{...e,availableAlbums:o,isLoadingLibrary:!1}))}}function I(){n.update(e=>{const a=["off","one","all"],t=a.indexOf(e.repeatMode),r=a[(t+1)%a.length];return{...e,repeatMode:r}})}function k(){n.update(e=>({...e,shuffle:!e.shuffle}))}function v(e){n.update(a=>({...a,seekRequest:e}))}function x(){n.update(e=>({...e,isPlaying:!e.isPlaying}))}function L(e){n.update(a=>({...a,musicVolume:e}))}function S(e){n.update(a=>{const t=a.availableAlbums.find(r=>r.id===e);return t?{...a,playlist:t.tracks||[],currentTrackIndex:0,currentAlbumId:e,isPlaying:!0,currentAmbience:b(t.vibeId)||a.currentAmbience}:a})}function T(e){n.update(a=>({...a,playlist:e,currentTrackIndex:0,currentAlbumId:void 0,isPlaying:!0}))}function _(){n.update(e=>{if(e.playlist.length===0)return e;let a;if(e.shuffle&&e.playlist.length>1)do a=Math.floor(Math.random()*e.playlist.length);while(a===e.currentTrackIndex);else a=(e.currentTrackIndex+1)%e.playlist.length;return{...e,currentTrackIndex:a}})}function M(){n.update(e=>{if(e.playlist.length===0)return e;let a=e.currentTrackIndex-1;return a<0&&(a=e.playlist.length-1),{...e,currentTrackIndex:a}})}function b(e){switch(e){case"noir":return"rain";case"library":return"library";case"zen":return"garden";default:return null}}export{n as a,T as b,M as c,k as d,I as e,L as f,A as i,_ as n,S as p,v as s,x as t};
