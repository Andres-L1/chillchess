import{w as p}from"./Dmpml9mb.js";import{u as b}from"./C9UhFrXA.js";import{b as y,d as P,n as S,s as g,u as I}from"./CSpmTaba.js";const D={free:{id:"free",name:"Free",price:"Gratis",priceValue:0,billing:"Para siempre",features:["Acceso a selección rotativa","Widget para OBS/Streaming","Fondo Estándar","Salas de Escucha Privadas","Perfil Básico"],maxGamesDaily:1/0,canAccessPremiumVibes:!1,canCustomizeBoard:!1},pro:{id:"pro",name:"Pro",price:"€19.99",priceValue:19.99,billing:"año",features:["Catálogo Musical Completo","Salas Públicas & Host Control","Ambientes Sonoros (Lluvia, Fuego...)","Descargas Ilimitadas (WAV/MP3)","Artist Hub: Sube tu Música","Vibe Studio: Personalización Total","Interfaz Inmersiva (Ocultar UI)","Insignia de Fundador"],maxGamesDaily:1/0,canAccessPremiumVibes:!0,canCustomizeBoard:!0}};function d(t,i){const e=["none","asap-forever"];return t==="free"?e.includes(i):!0}function m(t,i){const e=D[t].maxGamesDaily;if(e===1/0)return{canPlay:!0,remaining:1/0};const a=Math.max(0,e-i);return{canPlay:a>0,remaining:a}}const u={profile:null,loading:!0,tier:"free",stripeCustomerId:void 0,stripeSubscriptionId:void 0,canAccessVibe:()=>!1,canPlayGame:()=>!1};function A(){const{subscribe:t,set:i}=p(u);let e=null;return b.subscribe(a=>{if(e&&(e(),e=null),!a.user){i(u);return}const n=y(P,"users",a.user.uid);e=S(n,async r=>{if(!r.exists()){const o={uid:a.user.uid,email:a.user.email||"",displayName:a.user.displayName||"Usuario",photoURL:a.user.photoURL||"",subscriptionTier:"free",subscriptionStatus:"active",gamesPlayedToday:0,lastGamePlayed:Date.now(),lastResetDate:new Date().toISOString().split("T")[0],createdAt:Date.now(),updatedAt:Date.now()};await g(n,o),i({profile:o,loading:!1,tier:"free",stripeCustomerId:void 0,stripeSubscriptionId:void 0,canAccessVibe:f=>d("free",f),canPlayGame:()=>m("free",0).canPlay});return}const s=r.data(),c=s.subscriptionTier||"free",l=new Date().toISOString().split("T")[0];s.lastResetDate!==l&&(await I(n,{gamesPlayedToday:0,lastResetDate:l,updatedAt:Date.now()}),s.gamesPlayedToday=0,s.lastResetDate=l),i({profile:s,loading:!1,tier:c,stripeCustomerId:s.stripeCustomerId,stripeSubscriptionId:s.stripeSubscriptionId,canAccessVibe:o=>d(c,o),canPlayGame:()=>m(c,s.gamesPlayedToday).canPlay})},r=>{console.error("Error listening to user profile:",r),i({...u,loading:!1})})}),{subscribe:t}}const v=A();export{D as T,v as u};
