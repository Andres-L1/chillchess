import{w as i}from"./BRP6Yj6K.js";import{A as l}from"./C3wcvxbl.js";import{q as c,c as o,d as u,f as s}from"./5dAqgG7A.js";const d={musicVolume:.4,ambienceVolume:.6,currentAmbience:"none",whiteNoiseVolume:.5,currentWhiteNoise:"none",isMuted:!1,availableAlbums:[],isLoadingLibrary:!0,playlist:[],currentTrackIndex:0,isPlaying:!1,activeVibe:"custom",duration:0,currentTime:0,seekRequest:null,repeatMode:"off",shuffle:!1},t=i(d);async function y(){if(typeof localStorage<"u"){const e=localStorage.getItem("chillchess_albums_cache");if(e)try{const a=JSON.parse(e);console.log("[AudioLibrary] Loaded from cache (Instant)."),t.update(n=>({...n,availableAlbums:a,isLoadingLibrary:!1}))}catch(a){console.warn("Invalid cache",a)}}try{const e=c(o(u,"albums")),a=await s(e);if(!a.empty){const n=a.docs.map(r=>({...r.data(),id:r.id}));console.log(`[AudioLibrary] Synced ${n.length} albums from Cloud.`),t.update(r=>({...r,availableAlbums:n,isLoadingLibrary:!1})),typeof localStorage<"u"&&localStorage.setItem("chillchess_albums_cache",JSON.stringify(n));return}}catch(e){console.warn("[AudioLibrary] Connection error, keeping cached or static version:",e)}t.update(e=>e.availableAlbums.length>0?e:(console.log("[AudioLibrary] Using static fallback."),{...e,availableAlbums:l,isLoadingLibrary:!1}))}function h(){t.update(e=>{const a=["off","one","all"],n=a.indexOf(e.repeatMode),r=a[(n+1)%a.length];return{...e,repeatMode:r}})}function A(){t.update(e=>({...e,shuffle:!e.shuffle}))}function k(e){t.update(a=>({...a,seekRequest:e}))}function I(){t.update(e=>({...e,isPlaying:!e.isPlaying}))}function x(e){t.update(a=>({...a,musicVolume:e}))}function L(){t.update(e=>({...e,isPlaying:!0}))}function v(e){t.update(a=>{const n=a.availableAlbums.find(r=>r.id===e);return n?{...a,playlist:n.tracks||[],currentTrackIndex:0,currentAlbumId:e,isPlaying:!0,currentAmbience:f(n.vibeId)||a.currentAmbience}:a})}function S(e){t.update(a=>({...a,playlist:e,currentTrackIndex:0,currentAlbumId:void 0,isPlaying:!0}))}function T(){t.update(e=>{if(e.playlist.length===0)return e;const a=(e.currentTrackIndex+1)%e.playlist.length;return{...e,currentTrackIndex:a}})}function P(){t.update(e=>{if(e.playlist.length===0)return e;let a=e.currentTrackIndex-1;return a<0&&(a=e.playlist.length-1),{...e,currentTrackIndex:a}})}function f(e){switch(e){case"noir":return"rain";case"library":return"library";case"zen":return"garden";default:return null}}export{t as a,S as b,P as c,A as d,h as e,x as f,y as i,T as n,v as p,k as s,I as t,L as u};
