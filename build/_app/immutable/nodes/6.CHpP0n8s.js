var rr=Object.defineProperty;var ir=(r,t,e)=>t in r?rr(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var H=(r,t,e)=>ir(r,typeof t!="symbol"?t+"":t,e);import{_ as nr}from"../chunks/CmsKOCeN.js";import{a3 as Ms,s as es,n as Dt,d as N,z as or,i as ve,p as v,q as Ae,g as E,j as I,t as R,k as ae,c as V,l as P,a as Q,D as ar,a4 as B,r as lr,m as Rt,B as Ft,u as Ke,C as Bt,v as qe,b as Ut,o as cr,a5 as fr,w as us,O as hr,G as ds}from"../chunks/CjRJOMMO.js";import{S as ts,i as ss,f as ps,d as Ls,t as $t,a as _t,e as ur,m as Ds,c as Rs,b as Ks,g as dr}from"../chunks/CrctwSd_.js";import{e as Nt}from"../chunks/YP0ceSnB.js";import{g as pr}from"../chunks/1_Ok31BQ.js";import{w as gr}from"../chunks/ChAzKz3c.js";import{m as _r,c as mr,d as vr,n as br,b as Er}from"../chunks/CRduKRiI.js";import{a as qs,u as wr,p as yr}from"../chunks/DYpIvapH.js";import{A as gs,C as _s}from"../chunks/BZb6lmNz.js";import{f as ms}from"../chunks/BYgGvtrc.js";function kr(r){return r!==null?{comment:r,variations:[]}:{variations:[]}}function Cr(r,t,e,s,i){const n={move:r,variations:i};return t&&(n.suffix=t),e&&(n.nag=e),s!==null&&(n.comment=s),n}function xr(...r){const[t,...e]=r;let s=t;for(const i of e)i!==null&&(s.variations=[i,...i.variations],i.variations=[],s=i);return t}function Sr(r,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:r,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function Ar(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}function nt(r,t,e,s){var i=Error.call(this,r);return Object.setPrototypeOf&&Object.setPrototypeOf(i,nt.prototype),i.expected=t,i.found=e,i.location=s,i.name="SyntaxError",i}Ar(nt,Error);function Vt(r,t,e){return e=e||" ",r.length>t?r:(t-=r.length,e+=e.repeat(t),r+e.slice(0,t))}nt.prototype.format=function(r){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<r.length;s++)if(r[s].source===this.location.source){e=r[s].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,a=this.location.source+":"+n.line+":"+n.column;if(e){var l=this.location.end,f=Vt("",n.line.toString().length," "),d=e[i.line-1],g=i.line===l.line?l.column:d.length+1,w=g-i.column||1;t+=`
 --> `+a+`
`+f+` |
`+n.line+" | "+d+`
`+f+" | "+Vt("",i.column-1," ")+Vt("",w,"^")}else t+=`
 at `+a}return t};nt.buildMessage=function(r,t){var e={literal:function(d){return'"'+i(d.text)+'"'},class:function(d){var g=d.parts.map(function(w){return Array.isArray(w)?n(w[0])+"-"+n(w[1]):n(w)});return"["+(d.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function s(d){return d.charCodeAt(0).toString(16).toUpperCase()}function i(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function n(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function a(d){return e[d.type](d)}function l(d){var g=d.map(a),w,p;if(g.sort(),g.length>0){for(w=1,p=1;w<g.length;w++)g[w-1]!==g[w]&&(g[p]=g[w],p++);g.length=p}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function f(d){return d?'"'+i(d)+'"':"end of input"}return"Expected "+l(r)+" but "+f(t)+" found."};function Tr(r,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,i={pgn:os},n=os,a="[",l='"',f="]",d=".",g="O-O-O",w="O-O",p="0-0-0",_="0-0",b="$",O="{",x="}",K=";",M="(",A=")",L="1-0",y="0-1",U="1/2-1/2",j="*",ce=/^[a-zA-Z]/,W=/^[^"]/,se=/^[0-9]/,be=/^[.]/,Te=/^[a-zA-Z1-8\-=]/,Be=/^[+#]/,de=/^[!?]/,Ee=/^[^}]/,Ne=/^[^\r\n]/,q=/^[ \t\r\n]/,fe=ue("tag pair"),he=X("[",!1),Ie=X('"',!1),oe=X("]",!1),we=ue("tag name"),Ue=Se([["a","z"],["A","Z"]],!1,!1),He=ue("tag value"),Ge=Se(['"'],!0,!1),ye=ue("move number"),Pe=Se([["0","9"]],!1,!1),je=X(".",!1),We=Se(["."],!1,!1),ke=ue("standard algebraic notation"),ot=X("O-O-O",!1),Ye=X("O-O",!1),at=X("0-0-0",!1),pe=X("0-0",!1),lt=Se([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),ct=Se(["+","#"],!1,!1),$e=ue("suffix annotation"),Ce=Se(["!","?"],!1,!1),ft=ue("NAG"),ie=X("$",!1),ht=ue("brace comment"),bt=X("{",!1),G=Se(["}"],!0,!1),Et=X("}",!1),Ze=ue("rest of line comment"),ge=X(";",!1),Z=Se(["\r",`
`],!0,!1),D=ue("variation"),z=X("(",!1),Je=X(")",!1),Oe=ue("game termination marker"),Me=X("1-0",!1),Xe=X("0-1",!1),et=X("1/2-1/2",!1),ut=X("*",!1),tt=ue("whitespace"),dt=Se([" ","	","\r",`
`],!1,!1),wt=function(o,h){return Sr(o,h)},st=function(o){return Object.fromEntries(o)},yt=function(o,h){return[o,h]},xe=function(o,h){return{root:o,marker:h}},kt=function(o,h){return xr(kr(o),...h.flat())},Ct=function(o,h,u,C,S){return Cr(o,h,u,C,S)},xt=function(o){return o},St=function(o){return o.replace(/[\r\n]+/g," ")},Us=function(o){return o.trim()},Vs=function(o){return o},Qs=function(o,h){return{result:o,comment:h}},c=t.peg$currPos|0,rt=[{line:1,column:1}],_e=c,At=t.peg$maxFailExpected||[],m=t.peg$silentFails|0,pt;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');n=i[t.startRule]}function X(o,h){return{type:"literal",text:o,ignoreCase:h}}function Se(o,h,u){return{type:"class",parts:o,inverted:h,ignoreCase:u}}function zs(){return{type:"end"}}function ue(o){return{type:"other",description:o}}function is(o){var h=rt[o],u;if(h)return h;if(o>=rt.length)u=rt.length-1;else for(u=o;!rt[--u];);for(h=rt[u],h={line:h.line,column:h.column};u<o;)r.charCodeAt(u)===10?(h.line++,h.column=1):h.column++,u++;return rt[o]=h,h}function ns(o,h,u){var C=is(o),S=is(h),F={source:s,start:{offset:o,line:C.line,column:C.column},end:{offset:h,line:S.line,column:S.column}};return F}function k(o){c<_e||(c>_e&&(_e=c,At=[]),At.push(o))}function Hs(o,h,u){return new nt(nt.buildMessage(o,h),o,h,u)}function os(){var o,h,u;return o=c,h=Gs(),u=Ys(),o=wt(h,u),o}function Gs(){var o,h,u;for(o=c,h=[],u=as();u!==e;)h.push(u),u=as();return u=ne(),o=st(h),o}function as(){var o,h,u,C,S,F,Ve;return m++,o=c,ne(),r.charCodeAt(c)===91?(h=a,c++):(h=e,m===0&&k(he)),h!==e?(ne(),u=js(),u!==e?(ne(),r.charCodeAt(c)===34?(C=l,c++):(C=e,m===0&&k(Ie)),C!==e?(S=Ws(),r.charCodeAt(c)===34?(F=l,c++):(F=e,m===0&&k(Ie)),F!==e?(ne(),r.charCodeAt(c)===93?(Ve=f,c++):(Ve=e,m===0&&k(oe)),Ve!==e?o=yt(u,S):(c=o,o=e)):(c=o,o=e)):(c=o,o=e)):(c=o,o=e)):(c=o,o=e),m--,o===e&&m===0&&k(fe),o}function js(){var o,h,u;if(m++,o=c,h=[],u=r.charAt(c),ce.test(u)?c++:(u=e,m===0&&k(Ue)),u!==e)for(;u!==e;)h.push(u),u=r.charAt(c),ce.test(u)?c++:(u=e,m===0&&k(Ue));else h=e;return h!==e?o=r.substring(o,c):o=h,m--,o===e&&(h=e,m===0&&k(we)),o}function Ws(){var o,h,u;for(m++,o=c,h=[],u=r.charAt(c),W.test(u)?c++:(u=e,m===0&&k(Ge));u!==e;)h.push(u),u=r.charAt(c),W.test(u)?c++:(u=e,m===0&&k(Ge));return o=r.substring(o,c),m--,h=e,m===0&&k(He),o}function Ys(){var o,h,u;return o=c,h=ls(),ne(),u=sr(),u===e&&(u=null),ne(),o=xe(h,u),o}function ls(){var o,h,u,C;for(o=c,h=qt(),h===e&&(h=null),u=[],C=cs();C!==e;)u.push(C),C=cs();return o=kt(h,u),o}function cs(){var o,h,u,C,S,F,Ve,Tt;if(o=c,ne(),Zs(),ne(),h=Js(),h!==e){for(u=Xs(),u===e&&(u=null),C=[],S=fs();S!==e;)C.push(S),S=fs();for(S=ne(),F=qt(),F===e&&(F=null),Ve=[],Tt=hs();Tt!==e;)Ve.push(Tt),Tt=hs();o=Ct(h,u,C,F,Ve)}else c=o,o=e;return o}function Zs(){var o,h,u,C,S,F;for(m++,o=c,h=[],u=r.charAt(c),se.test(u)?c++:(u=e,m===0&&k(Pe));u!==e;)h.push(u),u=r.charAt(c),se.test(u)?c++:(u=e,m===0&&k(Pe));if(r.charCodeAt(c)===46?(u=d,c++):(u=e,m===0&&k(je)),u!==e){for(C=ne(),S=[],F=r.charAt(c),be.test(F)?c++:(F=e,m===0&&k(We));F!==e;)S.push(F),F=r.charAt(c),be.test(F)?c++:(F=e,m===0&&k(We));h=[h,u,C,S],o=h}else c=o,o=e;return m--,o===e&&(h=e,m===0&&k(ye)),o}function Js(){var o,h,u,C,S,F;if(m++,o=c,h=c,r.substr(c,5)===g?(u=g,c+=5):(u=e,m===0&&k(ot)),u===e&&(r.substr(c,3)===w?(u=w,c+=3):(u=e,m===0&&k(Ye)),u===e&&(r.substr(c,5)===p?(u=p,c+=5):(u=e,m===0&&k(at)),u===e&&(r.substr(c,3)===_?(u=_,c+=3):(u=e,m===0&&k(pe)),u===e))))if(u=c,C=r.charAt(c),ce.test(C)?c++:(C=e,m===0&&k(Ue)),C!==e){if(S=[],F=r.charAt(c),Te.test(F)?c++:(F=e,m===0&&k(lt)),F!==e)for(;F!==e;)S.push(F),F=r.charAt(c),Te.test(F)?c++:(F=e,m===0&&k(lt));else S=e;S!==e?(C=[C,S],u=C):(c=u,u=e)}else c=u,u=e;return u!==e?(C=r.charAt(c),Be.test(C)?c++:(C=e,m===0&&k(ct)),C===e&&(C=null),u=[u,C],h=u):(c=h,h=e),h!==e?o=r.substring(o,c):o=h,m--,o===e&&(h=e,m===0&&k(ke)),o}function Xs(){var o,h,u;for(m++,o=c,h=[],u=r.charAt(c),de.test(u)?c++:(u=e,m===0&&k(Ce));u!==e;)h.push(u),h.length>=2?u=e:(u=r.charAt(c),de.test(u)?c++:(u=e,m===0&&k(Ce)));return h.length<1?(c=o,o=e):o=h,m--,o===e&&(h=e,m===0&&k($e)),o}function fs(){var o,h,u,C,S;if(m++,o=c,ne(),r.charCodeAt(c)===36?(h=b,c++):(h=e,m===0&&k(ie)),h!==e){if(u=c,C=[],S=r.charAt(c),se.test(S)?c++:(S=e,m===0&&k(Pe)),S!==e)for(;S!==e;)C.push(S),S=r.charAt(c),se.test(S)?c++:(S=e,m===0&&k(Pe));else C=e;C!==e?u=r.substring(u,c):u=C,u!==e?o=xt(u):(c=o,o=e)}else c=o,o=e;return m--,o===e&&m===0&&k(ft),o}function qt(){var o;return o=er(),o===e&&(o=tr()),o}function er(){var o,h,u,C,S;if(m++,o=c,r.charCodeAt(c)===123?(h=O,c++):(h=e,m===0&&k(bt)),h!==e){for(u=c,C=[],S=r.charAt(c),Ee.test(S)?c++:(S=e,m===0&&k(G));S!==e;)C.push(S),S=r.charAt(c),Ee.test(S)?c++:(S=e,m===0&&k(G));u=r.substring(u,c),r.charCodeAt(c)===125?(C=x,c++):(C=e,m===0&&k(Et)),C!==e?o=St(u):(c=o,o=e)}else c=o,o=e;return m--,o===e&&(h=e,m===0&&k(ht)),o}function tr(){var o,h,u,C,S;if(m++,o=c,r.charCodeAt(c)===59?(h=K,c++):(h=e,m===0&&k(ge)),h!==e){for(u=c,C=[],S=r.charAt(c),Ne.test(S)?c++:(S=e,m===0&&k(Z));S!==e;)C.push(S),S=r.charAt(c),Ne.test(S)?c++:(S=e,m===0&&k(Z));u=r.substring(u,c),o=Us(u)}else c=o,o=e;return m--,o===e&&(h=e,m===0&&k(Ze)),o}function hs(){var o,h,u,C;return m++,o=c,ne(),r.charCodeAt(c)===40?(h=M,c++):(h=e,m===0&&k(z)),h!==e?(u=ls(),u!==e?(ne(),r.charCodeAt(c)===41?(C=A,c++):(C=e,m===0&&k(Je)),C!==e?o=Vs(u):(c=o,o=e)):(c=o,o=e)):(c=o,o=e),m--,o===e&&m===0&&k(D),o}function sr(){var o,h,u;return m++,o=c,r.substr(c,3)===L?(h=L,c+=3):(h=e,m===0&&k(Me)),h===e&&(r.substr(c,3)===y?(h=y,c+=3):(h=e,m===0&&k(Xe)),h===e&&(r.substr(c,7)===U?(h=U,c+=7):(h=e,m===0&&k(et)),h===e&&(r.charCodeAt(c)===42?(h=j,c++):(h=e,m===0&&k(ut))))),h!==e?(ne(),u=qt(),u===e&&(u=null),o=Qs(h,u)):(c=o,o=e),m--,o===e&&(h=e,m===0&&k(Oe)),o}function ne(){var o,h;for(m++,o=[],h=r.charAt(c),q.test(h)?c++:(h=e,m===0&&k(dt));h!==e;)o.push(h),h=r.charAt(c),q.test(h)?c++:(h=e,m===0&&k(dt));return m--,h=e,m===0&&k(tt),o}if(pt=n(),t.peg$library)return{peg$result:pt,peg$currPos:c,peg$FAILED:e,peg$maxFailExpected:At,peg$maxFailPos:_e};if(pt!==e&&c===r.length)return pt;throw pt!==e&&c<r.length&&k(zs()),Hs(At,_e<r.length?r.charAt(_e):null,_e<r.length?ns(_e,_e+1):ns(_e,_e))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const Ot=0xffffffffffffffffn;function Qt(r,t){return(r<<t|r>>64n-t)&0xffffffffffffffffn}function vs(r,t){return r*t&Ot}function Nr(r){return function(){let t=BigInt(r&Ot),e=BigInt(r>>64n&Ot);const s=vs(Qt(vs(t,5n),7n),9n);return e^=t,t=(Qt(t,24n)^e^e<<16n)&Ot,e=Qt(e,37n),r=e<<64n|t,s}}const Kt=Nr(0xa187eb39cdcaed8f31c4b365b102e01en),Ir=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Kt()))),Pr=Array.from({length:8},()=>Kt()),$r=Array.from({length:16},()=>Kt()),zt=Kt(),re="w",le="b",Y="p",Yt="n",Mt="b",mt="r",Re="q",J="k",Ht="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class It{constructor(t,e){H(this,"color");H(this,"from");H(this,"to");H(this,"piece");H(this,"captured");H(this,"promotion");H(this,"flags");H(this,"san");H(this,"lan");H(this,"before");H(this,"after");const{color:s,piece:i,from:n,to:a,flags:l,captured:f,promotion:d}=e,g=ee(n),w=ee(a);this.color=s,this.piece=i,this.from=g,this.to=w,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=g+w,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const p in $)$[p]&l&&(this.flags+=Qe[p]);f&&(this.captured=f),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(Qe.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Qe.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Qe.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Qe.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Qe.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Qe.BIG_PAWN)>-1}}const te=-1,Qe={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},$={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Zt={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Or={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Mr={...Zt,...Or},T={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Gt={b:[16,32,17,15],w:[-16,-32,-17,-15]},bs={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Lr=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Dr=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Rr={p:1,n:2,b:4,r:8,q:16,k:32},Kr="pnbrqkPNBRQK",Es=[Yt,Mt,mt,Re],qr=7,Fr=6,Br=1,Ur=0,Pt={[J]:$.KSIDE_CASTLE,[Re]:$.QSIDE_CASTLE},Le={w:[{square:T.a1,flag:$.QSIDE_CASTLE},{square:T.h1,flag:$.KSIDE_CASTLE}],b:[{square:T.a8,flag:$.QSIDE_CASTLE},{square:T.h8,flag:$.KSIDE_CASTLE}]},Vr={b:Br,w:Fr},jt="--";function ze(r){return r>>4}function vt(r){return r&15}function Fs(r){return"0123456789".indexOf(r)!==-1}function ee(r){const t=vt(r),e=ze(r);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function gt(r){return r===re?le:re}function Qr(r){const t=r.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<i.length;a++){let l=0,f=!1;for(let d=0;d<i[a].length;d++)if(Fs(i[a][d])){if(f)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(i[a][d],10),f=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[a][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,f=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of n){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(i[0]+i[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function zr(r,t){const e=r.from,s=r.to,i=r.piece;let n=0,a=0,l=0;for(let f=0,d=t.length;f<d;f++){const g=t[f].from,w=t[f].to,p=t[f].piece;i===p&&e!==g&&s===w&&(n++,ze(e)===ze(g)&&a++,vt(e)===vt(g)&&l++)}return n>0?a>0&&l>0?ee(e):l>0?ee(e).charAt(1):ee(e).charAt(0):""}function De(r,t,e,s,i,n=void 0,a=$.NORMAL){const l=ze(s);if(i===Y&&(l===qr||l===Ur))for(let f=0;f<Es.length;f++){const d=Es[f];r.push({color:t,from:e,to:s,piece:i,captured:n,promotion:d,flags:a|$.PROMOTION})}else r.push({color:t,from:e,to:s,piece:i,captured:n,flags:a})}function ws(r){let t=r.charAt(0);return t>="a"&&t<="h"?r.match(/[a-h]\d.*[a-h]\d/)?void 0:Y:(t=t.toLowerCase(),t==="o"?J:t)}function Wt(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Bs{constructor(t=Ht,{skipValidation:e=!1}={}){H(this,"_board",new Array(128));H(this,"_turn",re);H(this,"_header",{});H(this,"_kings",{w:te,b:te});H(this,"_epSquare",-1);H(this,"_halfMoves",0);H(this,"_moveNumber",0);H(this,"_history",[]);H(this,"_comments",{});H(this,"_castling",{w:0,b:0});H(this,"_hash",0n);H(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:te,b:te},this._turn=re,this._castling={w:0,b:0},this._epSquare=te,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Mr},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const l=["-","-","0","1"];t=i.concat(l.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!e){const{ok:l,error:f}=Qr(t);if(!l)throw new Error(f)}const n=i[0];let a=0;this.clear({preserveHeaders:s});for(let l=0;l<n.length;l++){const f=n.charAt(l);if(f==="/")a+=8;else if(Fs(f))a+=parseInt(f,10);else{const d=f<"a"?re:le;this._put({type:f.toLowerCase(),color:d},ee(a)),a++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=$.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=$.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=$.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=$.QSIDE_CASTLE),this._epSquare=i[3]==="-"?te:T[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){let e=0,s="";for(let a=T.a8;a<=T.h1;a++){if(this._board[a]){e>0&&(s+=e,e=0);const{color:l,type:f}=this._board[a];s+=l===re?f.toUpperCase():f.toLowerCase()}else e++;a+1&136&&(e>0&&(s+=e),a!==T.h1&&(s+="/"),e=0,a+=8)}let i="";this._castling[re]&$.KSIDE_CASTLE&&(i+="K"),this._castling[re]&$.QSIDE_CASTLE&&(i+="Q"),this._castling[le]&$.KSIDE_CASTLE&&(i+="k"),this._castling[le]&$.QSIDE_CASTLE&&(i+="q"),i=i||"-";let n="-";if(this._epSquare!==te)if(t)n=ee(this._epSquare);else{const a=this._epSquare+(this._turn===re?16:-16),l=[a+1,a-1];for(const f of l){if(f&136)continue;const d=this._turn;if(this._board[f]?.color===d&&this._board[f]?.type===Y){this._makeMove({color:d,from:f,to:this._epSquare,piece:Y,captured:Y,flags:$.EP_CAPTURE});const g=!this._isKingAttacked(d);if(this._undoMove(),g){n=ee(this._epSquare);break}}}}return[s,this._turn,i,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],i={w:0,b:1}[e],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Ir[i][n][t]}_epKey(){return this._epSquare===te?0n:Pr[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return $r[t]}_computeHash(){let t=0n;for(let e=T.a8;e<=T.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=zt),t}_updateSetup(t){this._history.length>0||(t!==Ht?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Ht)}get(t){return this._board[T[t]]}findPiece(t){const e=[];for(let s=T.a8;s<=T.h1;s++){if(s&136){s+=7;continue}!this._board[s]||this._board[s]?.color!==t.color||this._board[s].color===t.color&&this._board[s].type===t.type&&e.push(ee(s))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Kr.indexOf(t.toLowerCase())===-1||!(s in T))return!1;const i=T[s];if(t==J&&!(this._kings[e]==te||this._kings[e]==i))return!1;const n=this._board[i];return n&&n.type===J&&(this._kings[n.color]=te),this._set(i,{type:t,color:e}),t===J&&(this._kings[e]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(T[t]),e&&e.type===J&&(this._kings[e.color]=te),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){this._hash^=this._castlingKey();const t=this._board[T.e1]?.type===J&&this._board[T.e1]?.color===re,e=this._board[T.e8]?.type===J&&this._board[T.e8]?.color===le;(!t||this._board[T.a1]?.type!==mt||this._board[T.a1]?.color!==re)&&(this._castling.w&=-65),(!t||this._board[T.h1]?.type!==mt||this._board[T.h1]?.color!==re)&&(this._castling.w&=-33),(!e||this._board[T.a8]?.type!==mt||this._board[T.a8]?.color!==le)&&(this._castling.b&=-65),(!e||this._board[T.h8]?.type!==mt||this._board[T.h8]?.color!==le)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===te)return;const t=this._epSquare+(this._turn===re?-16:16),e=this._epSquare+(this._turn===re?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[e]?.color!==gt(this._turn)||this._board[e]?.type!==Y){this._hash^=this._epKey(),this._epSquare=te;return}const i=n=>!(n&136)&&this._board[n]?.color===this._turn&&this._board[n]?.type===Y;s.some(i)||(this._hash^=this._epKey(),this._epSquare=te)}_attacked(t,e,s){const i=[];for(let n=T.a8;n<=T.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==t)continue;const a=this._board[n],l=n-e;if(l===0)continue;const f=l+119;if(Lr[f]&Rr[a.type]){if(a.type===Y){if(l>0&&a.color===re||l<=0&&a.color===le)if(s)i.push(ee(n));else return!0;continue}if(a.type==="n"||a.type==="k")if(s){i.push(ee(n));continue}else return!0;const d=Dr[f];let g=n+d,w=!1;for(;g!==e;){if(this._board[g]!=null){w=!0;break}g+=d}if(!w)if(s){i.push(ee(n));continue}else return!0}}return s?i:!1}attackers(t,e){return e?this._attacked(e,T[t],!0):this._attacked(this._turn,T[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(gt(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,T[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,i=0;for(let n=T.a8;n<=T.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const a=this._board[n];a&&(t[a.type]=a.type in t?t[a.type]+1:1,a.type===Mt&&e.push(i),s++)}if(s===2)return!0;if(s===3&&(t[Mt]===1||t[Yt]===1))return!0;if(s===t[Mt]+2){let n=0;const a=e.length;for(let l=0;l<a;l++)n+=e[l];if(n===0||n===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const i=this._moves({square:e,piece:s});return t?i.map(n=>new It(this,n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){const i=s?s.toLowerCase():void 0,n=e?.toLowerCase(),a=[],l=this._turn,f=gt(l);let d=T.a8,g=T.h1,w=!1;if(i)if(i in T)d=g=T[i],w=!0;else return[];for(let _=d;_<=g;_++){if(_&136){_+=7;continue}if(!this._board[_]||this._board[_].color===f)continue;const{type:b}=this._board[_];let O;if(b===Y){if(n&&n!==b)continue;O=_+Gt[l][0],this._board[O]||(De(a,l,_,O,Y),O=_+Gt[l][1],Vr[l]===ze(_)&&!this._board[O]&&De(a,l,_,O,Y,void 0,$.BIG_PAWN));for(let x=2;x<4;x++)O=_+Gt[l][x],!(O&136)&&(this._board[O]?.color===f?De(a,l,_,O,Y,this._board[O].type,$.CAPTURE):O===this._epSquare&&De(a,l,_,O,Y,Y,$.EP_CAPTURE))}else{if(n&&n!==b)continue;for(let x=0,K=bs[b].length;x<K;x++){const M=bs[b][x];for(O=_;O+=M,!(O&136);){if(!this._board[O])De(a,l,_,O,b);else{if(this._board[O].color===l)break;De(a,l,_,O,b,this._board[O].type,$.CAPTURE);break}if(b===Yt||b===J)break}}}}if((n===void 0||n===J)&&(!w||g===this._kings[l])){if(this._castling[l]&$.KSIDE_CASTLE){const _=this._kings[l],b=_+2;!this._board[_+1]&&!this._board[b]&&!this._attacked(f,this._kings[l])&&!this._attacked(f,_+1)&&!this._attacked(f,b)&&De(a,l,this._kings[l],b,J,void 0,$.KSIDE_CASTLE)}if(this._castling[l]&$.QSIDE_CASTLE){const _=this._kings[l],b=_-2;!this._board[_-1]&&!this._board[_-2]&&!this._board[_-3]&&!this._attacked(f,this._kings[l])&&!this._attacked(f,_-1)&&!this._attacked(f,b)&&De(a,l,this._kings[l],b,J,void 0,$.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return a;const p=[];for(let _=0,b=a.length;_<b;_++)this._makeMove(a[_]),this._isKingAttacked(l)||p.push(a[_]),this._undoMove();return p}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(jt,e);else if(typeof t=="object"){const n=this._moves();for(let a=0,l=n.length;a<l;a++)if(t.from===ee(n[a].from)&&t.to===ee(n[a].to)&&(!("promotion"in n[a])||t.promotion===n[a].promotion)){s=n[a];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&$.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new It(this,s);return this._makeMove(s),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){const e=this._turn,s=gt(e);if(this._push(t),t.flags&$.NULL_MOVE){e===le&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=te;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&$.EP_CAPTURE&&(this._turn===le?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===J){if(this._kings[e]=t.to,t.flags&$.KSIDE_CASTLE){const i=t.to-1,n=t.to+1;this._movePiece(n,i)}else if(t.flags&$.QSIDE_CASTLE){const i=t.to+1,n=t.to-2;this._movePiece(n,i)}this._castling[e]=0}if(this._castling[e]){for(let i=0,n=Le[e].length;i<n;i++)if(t.from===Le[e][i].square&&this._castling[e]&Le[e][i].flag){this._castling[e]^=Le[e][i].flag;break}}if(this._castling[s]){for(let i=0,n=Le[s].length;i<n;i++)if(t.to===Le[s][i].square&&this._castling[s]&Le[s][i].flag){this._castling[s]^=Le[s][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&$.BIG_PAWN){let i;e===le?i=t.to-16:i=t.to+16,!(t.to-1&136)&&this._board[t.to-1]?.type===Y&&this._board[t.to-1]?.color===s||!(t.to+1&136)&&this._board[t.to+1]?.type===Y&&this._board[t.to+1]?.color===s?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=te}else this._epSquare=te;t.piece===Y?this._halfMoves=0:t.flags&($.CAPTURE|$.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===le&&this._moveNumber++,this._turn=s,this._hash^=zt}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new It(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=zt;const s=this._turn,i=gt(s);if(e.flags&$.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&$.EP_CAPTURE){let n;s===le?n=e.to-16:n=e.to+16,this._set(n,{type:Y,color:i})}else this._set(e.to,{type:e.captured,color:i});if(e.flags&($.KSIDE_CASTLE|$.QSIDE_CASTLE)){let n,a;e.flags&$.KSIDE_CASTLE?(n=e.to+1,a=e.to-1):(n=e.to-2,a=e.to+1),this._movePiece(a,n)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let i=!1;for(const p in this._header)this._header[p]&&s.push(`[${p} "${this._header[p]}"]`+t),i=!0;i&&this._history.length&&s.push(t);const n=p=>{const _=this._comments[this.fen()];if(typeof _<"u"){const b=p.length>0?" ":"";p=`${p}${b}{${_}}`}return p},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let f="";for(a.length===0&&l.push(n(""));a.length>0;){f=n(f);const p=a.pop();if(!p)break;if(!this._history.length&&p.color==="b"){const _=`${this._moveNumber}. ...`;f=f?`${f} ${_}`:_}else p.color==="w"&&(f.length&&l.push(f),f=this._moveNumber+".");f=f+" "+this._moveToSan(p,this._moves({legal:!0})),this._makeMove(p)}if(f.length&&l.push(n(f)),l.push(this._header.Result||"*"),e===0)return s.join("")+l.join(" ");const d=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},g=function(p,_){for(const b of _.split(" "))if(b){if(p+b.length>e){for(;d();)p--;s.push(t),p=0}s.push(b),p+=b.length,s.push(" "),p++}return d()&&p--,p};let w=0;for(let p=0;p<l.length;p++){if(w+l[p].length>e&&l[p].includes("{")){w=g(w,l[p]);continue}w+l[p].length>e&&p!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),w=0):p!==0&&(s.push(" "),w++),s.push(l[p]),w+=l[p].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??Zt[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Zt[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const i=Tr(t);this.reset();const n=i.headers;let a="";for(const d in n)d.toLowerCase()==="fen"&&(a=n[d]),this.header(d,n[d]);if(!e)a&&this.load(a,{preserveHeaders:!0});else if(n.SetUp==="1"){if(!("FEN"in n))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}let l=i.root;for(;l;){if(l.move){const d=this._moveFromSan(l.move,e);if(d==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(d),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const f=i.result;f&&Object.keys(this._header).length&&this._header.Result!==f&&this.setHeader("Result",f)}_moveToSan(t,e){let s="";if(t.flags&$.KSIDE_CASTLE)s="O-O";else if(t.flags&$.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&$.NULL_MOVE)return jt;if(t.piece!==Y){const i=zr(t,e);s+=t.piece.toUpperCase()+i}t.flags&($.CAPTURE|$.EP_CAPTURE)&&(t.piece===Y&&(s+=ee(t.from)[0]),s+="x"),s+=ee(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=Wt(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==jt)return{color:this._turn,from:0,to:0,piece:"k",flags:$.NULL_MOVE};let i=ws(s),n=this._moves({legal:!0,piece:i});for(let p=0,_=n.length;p<_;p++)if(s===Wt(this._moveToSan(n[p],n)))return n[p];if(e)return null;let a,l,f,d,g,w=!1;if(l=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],f=l[2],d=l[3],g=l[4],f.length==1&&(w=!0)):(l=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],f=l[2],d=l[3],g=l[4],f.length==1&&(w=!0))),i=ws(s),n=this._moves({legal:!0,piece:a||i}),!d)return null;for(let p=0,_=n.length;p<_;p++)if(f){if((!a||a.toLowerCase()==n[p].piece)&&T[f]==n[p].from&&T[d]==n[p].to&&(!g||g.toLowerCase()==n[p].promotion))return n[p];if(w){const b=ee(n[p].from);if((!a||a.toLowerCase()==n[p].piece)&&T[d]==n[p].to&&(f==b[0]||f==b[1])&&(!g||g.toLowerCase()==n[p].promotion))return n[p]}}else if(s===Wt(this._moveToSan(n[p],n)).replace("x",""))return n[p];return null}ascii(){let t=`   +------------------------+
`;for(let e=T.a8;e<=T.h1;e++){if(vt(e)===0&&(t+=" "+"87654321"[ze(e)]+" |"),this._board[e]){const s=this._board[e].type,n=this._board[e].color===re?s.toUpperCase():s.toLowerCase();t+=" "+n+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,a=e.length;n<a;n++)this._makeMove(e[n]),this._isKingAttacked(i)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=T.a8;s<=T.h1;s++)this._board[s]==null?e.push(null):e.push({square:ee(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in T){const e=T[t];return(ze(e)+vt(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const i=e.pop();if(!i)break;t?s.push(new It(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=i=>{i in this._comments&&(e[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const i of[J,Re])e[i]!==void 0&&(e[i]?this._castling[t]|=Pt[i]:this._castling[t]&=~Pt[i]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[J]===void 0||e[J]===s[J])&&(e[Re]===void 0||e[Re]===s[Re])}getCastlingRights(t){return{[J]:(this._castling[t]&Pt[J])!==0,[Re]:(this._castling[t]&Pt[Re])!==0}}moveNumber(){return this._moveNumber}}const Hr={id:"immortal",white:"Adolf Anderssen",black:"Lionel Kieseritzky",date:"1851",event:"London (friendly)",win:"white",description:"The Immortal Game - A romantic sacrifice masterpiece.",pgn:`[Event "London"]
[Site "London ENG"]
[Date "1851.06.21"]
[EventDate "1851.05.26"]
[Round "?"]
[Result "1-0"]
[White "Adolf Anderssen"]
[Black "Lionel Kieseritzky"]
[ECO "C33"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "45"]

1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5
9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6
16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8
22.Qf6+ Nxf6 23.Be7# 1-0`},Gr={id:"opera",white:"Paul Morphy",black:"Duke Karl / Count Isouard",date:"1858",event:"Paris Opera House",win:"white",description:"The Opera Game - Development over material.",pgn:`[Event "Paris"]
[Site "Paris FRA"]
[Date "1858.??.??"]
[EventDate "?"]
[Round "?"]
[Result "1-0"]
[White "Paul Morphy"]
[Black "Duke Karl / Count Isouard"]
[ECO "C41"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "33"]

1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3
c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6
15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0`},Jt=[Hr,Gr],jr={async log(r,t,e,s){if(!(typeof window>"u"))try{await _r(mr(vr,"system_logs"),{level:r,message:t,details:e?JSON.stringify(e,Object.getOwnPropertyNames(e)):null,userId:s||null,timestamp:br(),url:window.location.href,userAgent:navigator.userAgent});const i=r==="error"?"color: red":r==="warn"?"color: orange":"color: cyan";console.log(`%c[${r.toUpperCase()}] ${t}`,i,e||"")}catch(i){console.error("Failed to log to Firestore:",i)}},info(r,t,e){this.log("info",r,t,e)},warn(r,t,e){this.log("warn",r,t,e)},error(r,t,e){this.log("error",r,t,e)}},ys={noir:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/move-self.mp3",library:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/wood/move-self.mp3",zen:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/glass/move-self.mp3",default:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/move-self.mp3"},ks={noir:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/capture.mp3",library:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/wood/capture.mp3",zen:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/glass/capture.mp3",default:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/capture.mp3"};function Lt(r=!1){try{const t=Ms(qs);if(t.isMuted)return;const e=t.activeVibe||"custom",s=e==="custom"?"noir":e,n=(r?ks[s]:ys[s])||(r?ks.default:ys.default),a=new Audio(n);a.volume=Math.min((t.musicVolume+t.ambienceVolume)/2+.2,1);const l=a.play();l!==void 0&&l.catch(f=>{})}catch(t){console.warn("SFX Error:",t)}}let me=new Bs,Xt=[];const Wr={fen:me.fen(),history:[me.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:Jt[0],lastMove:null,isLoadingGame:!1},Fe=gr(Wr);let it=null;const Yr=3e3,Cs=["DrNykterstein","Hikaru","Alireza2003","FabianoCaruana","LevonAronian","DanielNaroditsky","GothamChess"];async function rs(){Fe.update(r=>({...r,isLoadingGame:!0}));try{const r=Cs[Math.floor(Math.random()*Cs.length)];console.log(`Loading games from ${r}...`);const t=await fetch(`https://lichess.org/api/games/user/${r}?max=15&rated=true&perfType=blitz,rapid,classical&pgnInJson=true&clocks=false&evals=false&opening=true`,{headers:{Accept:"application/x-ndjson"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=(await t.text()).trim().split(`
`).filter(d=>d.length>0);if(s.length===0)throw console.warn("No games found for player, using local games"),new Error("No games found");const i=s[Math.floor(Math.random()*s.length)],n=JSON.parse(i);console.log(`Loaded game: ${n.id}`);const a=n.players?.white?.user?.name||"Unknown",l=n.players?.black?.user?.name||"Unknown",f={id:n.id,white:a,black:l,date:new Date(n.createdAt).getFullYear().toString(),event:`Lichess ${n.speed||"Blitz"}`,win:n.winner==="white"?"white":n.winner==="black"?"black":"draw",description:n.opening?.name||"Classic Game",pgn:n.pgn};xs(f)}catch(r){jr.error("Failed to load Lichess game",{error:r.message||r}),console.log("Falling back to local games database");const t=Jt[Math.floor(Math.random()*Jt.length)];xs(t)}finally{Fe.update(r=>({...r,isLoadingGame:!1}))}}function xs(r){Xr(),me=new Bs;try{me.loadPgn(r.pgn),Xt=me.history(),me.reset(),Fe.set({fen:me.fen(),history:[me.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:r,lastMove:null,isLoadingGame:!1}),Jr()}catch(t){console.error("Failed to load PGN",t)}}function Zr(){const r=Ms(Fe);if(r.currentMoveIndex>=Xt.length-1){rs();return}const t=r.currentMoveIndex+1,e=Xt[t],s=me.move(e);s&&(Fe.update(i=>({...i,fen:me.fen(),currentMoveIndex:t,lastMove:s,history:[...i.history,me.fen()]})),Lt(s.flags.includes("c")||s.flags.includes("e")))}function Jr(){it&&clearInterval(it),Fe.update(r=>({...r,isPlaying:!0})),it=setInterval(()=>{Zr()},Yr)}function Xr(){it&&clearInterval(it),it=null,Fe.update(r=>({...r,isPlaying:!1}))}rs();function ei(r){let t,e,s,i="ChillChess",n,a,l="El Santuario Visual del Ajedrecista",f,d,g="Entrar al Santuario",w,p,_="<span>Recomendamos usar auriculares</span> <br/> <span>Click para activar la experiencia sonora</span>",b,O,x,K;return{c(){t=P("div"),e=P("div"),s=P("h1"),s.textContent=i,n=Q(),a=P("p"),a.textContent=l,f=Q(),d=P("button"),d.textContent=g,w=Q(),p=P("p"),p.innerHTML=_,this.h()},l(M){t=I(M,"DIV",{class:!0});var A=R(t);e=I(A,"DIV",{class:!0});var L=R(e);s=I(L,"H1",{class:!0,"data-svelte-h":!0}),ae(s)!=="svelte-12mg5j8"&&(s.textContent=i),n=V(L),a=I(L,"P",{class:!0,"data-svelte-h":!0}),ae(a)!=="svelte-1qxucny"&&(a.textContent=l),f=V(L),d=I(L,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(d)!=="svelte-1e93jub"&&(d.textContent=g),w=V(L),p=I(L,"P",{class:!0,"data-svelte-h":!0}),ae(p)!=="svelte-15qbzbi"&&(p.innerHTML=_),L.forEach(N),A.forEach(N),this.h()},h(){E(s,"class","h1 font-bold font-cinzel text-transparent bg-clip-text bg-gradient-to-br from-primary-400 to-tertiary-400"),E(a,"class","text-xl font-light opacity-80"),E(d,"class","btn variant-filled-primary rounded-full px-8 py-4 shadow-xl text-lg font-semibold hover:scale-105 transition-transform"),E(p,"class","text-xs opacity-50 space-y-1"),E(e,"class","text-center space-y-8 animate-pulse-slow svelte-1855xwc"),E(t,"class","fixed inset-0 z-50 flex items-center justify-center bg-surface-900/90 backdrop-blur-sm")},m(M,A){ve(M,t,A),v(t,e),v(e,s),v(e,n),v(e,a),v(e,f),v(e,d),v(e,w),v(e,p),O=!0,x||(K=Ae(d,"click",r[0]),x=!0)},p:Dt,i(M){O||(M&&or(()=>{O&&(b||(b=ps(t,ms,{},!0)),b.run(1))}),O=!0)},o(M){M&&(b||(b=ps(t,ms,{},!1)),b.run(0)),O=!1},d(M){M&&N(t),M&&b&&b.end(),x=!1,K()}}}function ti(r){const t=ar();function e(){t("start")}return[e]}class si extends ts{constructor(t){super(),ss(this,t,ti,ei,es,{})}}function ri(r){let t,e,s,i,n,a;return{c(){t=P("div"),e=P("div"),s=Q(),i=P("div"),n=Q(),a=P("div"),this.h()},l(l){t=I(l,"DIV",{class:!0});var f=R(t);e=I(f,"DIV",{class:!0}),R(e).forEach(N),s=V(f),i=I(f,"DIV",{class:!0}),R(i).forEach(N),n=V(f),a=I(f,"DIV",{class:!0}),R(a).forEach(N),f.forEach(N),this.h()},h(){E(e,"class","wave absolute bottom-0 left-0 w-[200%] h-[50%] opacity-30 mix-blend-screen animate-wave-slow svelte-h0amw8"),B(e,"bg-blue-500",r[0]==="noir"),B(e,"bg-amber-600",r[0]==="library"),B(e,"bg-pink-400",r[0]==="zen"),E(i,"class","wave absolute bottom-[-10%] left-[-50%] w-[200%] h-[50%] opacity-30 mix-blend-screen animate-wave-medium delay-700 svelte-h0amw8"),B(i,"bg-purple-600",r[0]==="noir"),B(i,"bg-orange-500",r[0]==="library"),B(i,"bg-green-400",r[0]==="zen"),E(a,"class","wave absolute bottom-[-20%] left-[-20%] w-[200%] h-[60%] opacity-20 mix-blend-screen animate-wave-fast delay-1000 svelte-h0amw8"),B(a,"bg-indigo-500",r[0]==="noir"),B(a,"bg-yellow-600",r[0]==="library"),B(a,"bg-teal-400",r[0]==="zen"),E(t,"class","absolute inset-0 z-0 pointer-events-none overflow-hidden transition-opacity duration-1000"),B(t,"opacity-40",r[1]),B(t,"opacity-0",!r[1])},m(l,f){ve(l,t,f),v(t,e),v(t,s),v(t,i),v(t,n),v(t,a)},p(l,[f]){f&1&&B(e,"bg-blue-500",l[0]==="noir"),f&1&&B(e,"bg-amber-600",l[0]==="library"),f&1&&B(e,"bg-pink-400",l[0]==="zen"),f&1&&B(i,"bg-purple-600",l[0]==="noir"),f&1&&B(i,"bg-orange-500",l[0]==="library"),f&1&&B(i,"bg-green-400",l[0]==="zen"),f&1&&B(a,"bg-indigo-500",l[0]==="noir"),f&1&&B(a,"bg-yellow-600",l[0]==="library"),f&1&&B(a,"bg-teal-400",l[0]==="zen"),f&2&&B(t,"opacity-40",l[1]),f&2&&B(t,"opacity-0",!l[1])},i:Dt,o:Dt,d(l){l&&N(t)}}}function ii(r,t,e){let{vibe:s="noir"}=t,{active:i=!1}=t;return r.$$set=n=>{"vibe"in n&&e(0,s=n.vibe),"active"in n&&e(1,i=n.active)},[s,i]}class ni extends ts{constructor(t){super(),ss(this,t,ii,ri,es,{vibe:0,active:1})}}function Ss(r,t,e){const s=r.slice();return s[32]=t[e],s}function As(r,t,e){const s=r.slice();return s[35]=t[e],s}function Ts(r){let t,e;return t=new si({}),t.$on("start",r[14]),{c(){Ks(t.$$.fragment)},l(s){Rs(t.$$.fragment,s)},m(s,i){Ds(t,s,i),e=!0},p:Dt,i(s){e||(_t(t.$$.fragment,s),e=!0)},o(s){$t(t.$$.fragment,s),e=!1},d(s){Ls(t,s)}}}function oi(r){let t,e="▶ INICIAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),ae(t)!=="svelte-zgzciz"&&(t.textContent=e)},m(s,i){ve(s,t,i)},d(s){s&&N(t)}}}function ai(r){let t,e="▶ REANUDAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),ae(t)!=="svelte-1azp8oc"&&(t.textContent=e)},m(s,i){ve(s,t,i)},d(s){s&&N(t)}}}function li(r){let t,e="⏸ PAUSAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),ae(t)!=="svelte-acypbq"&&(t.textContent=e)},m(s,i){ve(s,t,i)},d(s){s&&N(t)}}}function Ns(r){let t,e,s,i="Biblioteca",n,a,l,f,d,g="✕",w,p,_,b,O=Nt(_s),x=[];for(let A=0;A<O.length;A+=1)x[A]=Is(As(r,O,A));let K=Nt(r[8]),M=[];for(let A=0;A<K.length;A+=1)M[A]=$s(Ss(r,K,A));return{c(){t=P("div"),e=P("div"),s=P("h2"),s.textContent=i,n=Q(),a=P("div"),l=P("div");for(let A=0;A<x.length;A+=1)x[A].c();f=Q(),d=P("button"),d.textContent=g,w=Q(),p=P("div");for(let A=0;A<M.length;A+=1)M[A].c();this.h()},l(A){t=I(A,"DIV",{class:!0});var L=R(t);e=I(L,"DIV",{class:!0});var y=R(e);s=I(y,"H2",{class:!0,"data-svelte-h":!0}),ae(s)!=="svelte-1kkkusu"&&(s.textContent=i),n=V(y),a=I(y,"DIV",{class:!0});var U=R(a);l=I(U,"DIV",{class:!0});var j=R(l);for(let W=0;W<x.length;W+=1)x[W].l(j);j.forEach(N),f=V(U),d=I(U,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(d)!=="svelte-15w7o1z"&&(d.textContent=g),U.forEach(N),y.forEach(N),w=V(L),p=I(L,"DIV",{class:!0});var ce=R(p);for(let W=0;W<M.length;W+=1)M[W].l(ce);ce.forEach(N),L.forEach(N),this.h()},h(){E(s,"class","text-3xl font-bold text-white"),E(l,"class","hidden md:flex gap-2"),E(d,"class","p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors"),E(a,"class","flex items-center gap-4"),E(e,"class","flex justify-between items-center mb-8 shrink-0"),E(p,"class","grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6 overflow-y-auto pb-20"),E(t,"class","absolute inset-0 z-[60] bg-black/80 backdrop-blur-xl animate-fade-in flex flex-col p-8 overflow-hidden")},m(A,L){ve(A,t,L),v(t,e),v(e,s),v(e,n),v(e,a),v(a,l);for(let y=0;y<x.length;y+=1)x[y]&&x[y].m(l,null);v(a,f),v(a,d),v(t,w),v(t,p);for(let y=0;y<M.length;y+=1)M[y]&&M[y].m(p,null);_||(b=Ae(d,"click",r[15]),_=!0)},p(A,L){if(L[0]&4){O=Nt(_s);let y;for(y=0;y<O.length;y+=1){const U=As(A,O,y);x[y]?x[y].p(U,L):(x[y]=Is(U),x[y].c(),x[y].m(l,null))}for(;y<x.length;y+=1)x[y].d(1);x.length=O.length}if(L[0]&66816){K=Nt(A[8]);let y;for(y=0;y<K.length;y+=1){const U=Ss(A,K,y);M[y]?M[y].p(U,L):(M[y]=$s(U),M[y].c(),M[y].m(p,null))}for(;y<M.length;y+=1)M[y].d(1);M.length=K.length}},d(A){A&&N(t),us(x,A),us(M,A),_=!1,b()}}}function Is(r){let t,e=r[35].label+"",s,i,n,a,l;function f(){return r[24](r[35])}return{c(){t=P("button"),s=qe(e),i=Q(),this.h()},l(d){t=I(d,"BUTTON",{class:!0});var g=R(t);s=Ke(g,e),i=V(g),g.forEach(N),this.h()},h(){E(t,"class",n="px-3 py-1 rounded-full text-xs font-medium transition-all "+(r[2]===r[35].id?"bg-white text-black":"bg-white/10 text-slate-400 hover:text-white"))},m(d,g){ve(d,t,g),v(t,s),v(t,i),a||(l=Ae(t,"click",f),a=!0)},p(d,g){r=d,g[0]&4&&n!==(n="px-3 py-1 rounded-full text-xs font-medium transition-all "+(r[2]===r[35].id?"bg-white text-black":"bg-white/10 text-slate-400 hover:text-white"))&&E(t,"class",n)},d(d){d&&N(t),a=!1,l()}}}function Ps(r){let t,e='<div class="flex gap-1 items-end h-8"><div class="w-1 bg-white animate-[bounce_1s_infinite] h-4"></div> <div class="w-1 bg-white animate-[bounce_1.2s_infinite] h-8"></div> <div class="w-1 bg-white animate-[bounce_0.8s_infinite] h-6"></div></div>';return{c(){t=P("div"),t.innerHTML=e,this.h()},l(s){t=I(s,"DIV",{class:!0,"data-svelte-h":!0}),ae(t)!=="svelte-dsz2cq"&&(t.innerHTML=e),this.h()},h(){E(t,"class","absolute inset-0 bg-black/60 flex items-center justify-center backdrop-blur-sm")},m(s,i){ve(s,t,i)},d(s){s&&N(t)}}}function $s(r){let t,e,s,i,n=r[32].title+"",a,l,f,d=r[32].artist+"",g,w,p,_,b=r[10].currentAlbumId===r[32].id&&r[10].isPlaying&&Ps();function O(){return r[25](r[32])}return{c(){t=P("button"),e=P("div"),b&&b.c(),s=Q(),i=P("h3"),a=qe(n),l=Q(),f=P("p"),g=qe(d),w=Q(),this.h()},l(x){t=I(x,"BUTTON",{class:!0});var K=R(t);e=I(K,"DIV",{class:!0,style:!0});var M=R(e);b&&b.l(M),M.forEach(N),s=V(K),i=I(K,"H3",{class:!0});var A=R(i);a=Ke(A,n),A.forEach(N),l=V(K),f=I(K,"P",{class:!0});var L=R(f);g=Ke(L,d),L.forEach(N),w=V(K),K.forEach(N),this.h()},h(){E(e,"class","w-full aspect-square rounded-lg mb-4 bg-slate-800 bg-cover bg-center shadow-lg group-hover:scale-105 transition-transform relative overflow-hidden"),ds(e,"background-image","url('"+r[32].cover+"')"),E(i,"class","font-bold truncate text-white group-hover:text-purple-400 transition-colors"),E(f,"class","text-xs text-slate-400 truncate"),E(t,"class","group text-left p-4 rounded-xl hover:bg-white/5 transition-colors border border-transparent hover:border-white/5")},m(x,K){ve(x,t,K),v(t,e),b&&b.m(e,null),v(t,s),v(t,i),v(i,a),v(t,l),v(t,f),v(f,g),v(t,w),p||(_=Ae(t,"click",O),p=!0)},p(x,K){r=x,r[10].currentAlbumId===r[32].id&&r[10].isPlaying?b||(b=Ps(),b.c(),b.m(e,null)):b&&(b.d(1),b=null),K[0]&256&&ds(e,"background-image","url('"+r[32].cover+"')"),K[0]&256&&n!==(n=r[32].title+"")&&Rt(a,n),K[0]&256&&d!==(d=r[32].artist+"")&&Rt(g,d)},d(x){x&&N(t),b&&b.d(),p=!1,_()}}}function ci(r){let t,e,s,i,n,a,l,f,d,g,w='<span class="text-xl">←</span> <span class="text-sm font-medium">Salir</span>',p,_,b='<div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div> <span class="text-xs text-slate-300 font-mono tracking-wider">ZEN MODE</span>',O,x,K='<span class="text-xl">🎵</span>',M,A,L,y,U,j,ce,W,se,be=Os(r[1])+"",Te,Be,de,Ee=r[6]?"Enfocado":"Listo",Ne,q,fe,he,Ie,oe,we,Ue,He,Ge,ye,Pe,je,We,ke,ot,Ye,at,pe,lt="↺",ct,$e,Ce,ft,ie,ht,bt,G=r[4]&&Ts(r);function Et(D,z){return D[6]?li:D[1]<D[0]&&D[1]>0?ai:oi}let Ze=Et(r),ge=Ze(r);Ce=new ni({});let Z=r[5]&&Ns(r);return{c(){G&&G.c(),t=Q(),e=P("div"),s=P("div"),i=P("div"),n=Q(),a=P("div"),l=Q(),f=P("div"),d=P("header"),g=P("a"),g.innerHTML=w,p=Q(),_=P("div"),_.innerHTML=b,O=Q(),x=P("button"),x.innerHTML=K,M=Q(),A=P("main"),L=P("div"),y=Bt("svg"),U=Bt("circle"),j=Bt("circle"),ce=Q(),W=P("div"),se=P("div"),Te=qe(be),Be=Q(),de=P("div"),Ne=qe(Ee),q=Q(),fe=P("div"),he=P("button"),ge.c(),Ie=Q(),oe=P("div"),we=P("button"),Ue=qe("25m"),Ge=Q(),ye=P("button"),Pe=qe("5m"),We=Q(),ke=P("button"),ot=qe("15m"),at=Q(),pe=P("button"),pe.textContent=lt,ct=Q(),$e=P("div"),Ks(Ce.$$.fragment),ft=Q(),Z&&Z.c(),this.h()},l(D){G&&G.l(D),t=V(D),e=I(D,"DIV",{class:!0});var z=R(e);s=I(z,"DIV",{class:!0});var Je=R(s);i=I(Je,"DIV",{class:!0}),R(i).forEach(N),n=V(Je),a=I(Je,"DIV",{class:!0}),R(a).forEach(N),Je.forEach(N),l=V(z),f=I(z,"DIV",{class:!0});var Oe=R(f);d=I(Oe,"HEADER",{class:!0});var Me=R(d);g=I(Me,"A",{href:!0,class:!0,"data-svelte-h":!0}),ae(g)!=="svelte-pcf4q9"&&(g.innerHTML=w),p=V(Me),_=I(Me,"DIV",{class:!0,"data-svelte-h":!0}),ae(_)!=="svelte-m57vlv"&&(_.innerHTML=b),O=V(Me),x=I(Me,"BUTTON",{class:!0,"data-svelte-h":!0}),ae(x)!=="svelte-1at9l1c"&&(x.innerHTML=K),Me.forEach(N),M=V(Oe),A=I(Oe,"MAIN",{class:!0});var Xe=R(A);L=I(Xe,"DIV",{class:!0});var et=R(L);y=Ft(et,"svg",{class:!0,viewBox:!0});var ut=R(y);U=Ft(ut,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0}),R(U).forEach(N),j=Ft(ut,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,class:!0}),R(j).forEach(N),ut.forEach(N),ce=V(et),W=I(et,"DIV",{class:!0});var tt=R(W);se=I(tt,"DIV",{class:!0});var dt=R(se);Te=Ke(dt,be),dt.forEach(N),Be=V(tt),de=I(tt,"DIV",{class:!0});var wt=R(de);Ne=Ke(wt,Ee),wt.forEach(N),tt.forEach(N),et.forEach(N),q=V(Xe),fe=I(Xe,"DIV",{class:!0});var st=R(fe);he=I(st,"BUTTON",{class:!0});var yt=R(he);ge.l(yt),yt.forEach(N),Ie=V(st),oe=I(st,"DIV",{class:!0});var xe=R(oe);we=I(xe,"BUTTON",{class:!0});var kt=R(we);Ue=Ke(kt,"25m"),kt.forEach(N),Ge=V(xe),ye=I(xe,"BUTTON",{class:!0});var Ct=R(ye);Pe=Ke(Ct,"5m"),Ct.forEach(N),We=V(xe),ke=I(xe,"BUTTON",{class:!0});var xt=R(ke);ot=Ke(xt,"15m"),xt.forEach(N),at=V(xe),pe=I(xe,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),ae(pe)!=="svelte-aubsks"&&(pe.textContent=lt),xe.forEach(N),st.forEach(N),Xe.forEach(N),ct=V(Oe),$e=I(Oe,"DIV",{class:!0});var St=R($e);Rs(Ce.$$.fragment,St),St.forEach(N),Oe.forEach(N),ft=V(z),Z&&Z.l(z),z.forEach(N),this.h()},h(){E(i,"class","w-full h-full opacity-30 transform scale-110 transition-all duration-1000 ease-in-out filter blur-sm brightness-75 grayscale-[0.3]"),B(i,"blur-md",!r[6]),B(i,"blur-lg",r[6]),B(i,"scale-125",r[6]),E(a,"class","absolute inset-0 bg-radial-gradient from-transparent via-[#0B1120]/60 to-[#0B1120] pointer-events-none svelte-tvh61h"),E(s,"class","absolute inset-0 z-0 pointer-events-none select-none overflow-hidden"),E(g,"href","/"),E(g,"class","flex items-center gap-2 opacity-50 hover:opacity-100 transition-opacity z-50"),E(_,"class","flex items-center gap-2 bg-white/5 backdrop-blur-md rounded-full px-4 py-2 border border-white/10 shadow-lg"),E(x,"class","p-2 opacity-50 hover:opacity-100 transition-opacity z-50"),E(d,"class","p-6 flex justify-between items-center animate-fade-in-down"),E(U,"cx","50"),E(U,"cy","50"),E(U,"r","45"),E(U,"fill","none"),E(U,"stroke","currentColor"),E(U,"stroke-width","2"),E(U,"class","text-white/5"),E(j,"cx","50"),E(j,"cy","50"),E(j,"r","45"),E(j,"fill","none"),E(j,"stroke","currentColor"),E(j,"stroke-width","2"),E(j,"stroke-dasharray","283"),E(j,"stroke-dashoffset",r[9]),E(j,"stroke-linecap","round"),E(j,"class","text-white filter drop-shadow-[0_0_10px_rgba(255,255,255,0.5)] transition-all duration-1000 ease-linear"),E(y,"class","w-72 h-72 md:w-96 md:h-96 transform -rotate-90 drop-shadow-2xl"),E(y,"viewBox","0 0 100 100"),E(se,"class","font-mono text-6xl md:text-8xl font-light tracking-tighter text-white drop-shadow-lg tabular-nums select-none"),E(de,"class","text-slate-400 text-sm tracking-[0.2em] mt-2 uppercase opacity-60 font-medium"),E(W,"class","absolute inset-0 flex flex-col items-center justify-center"),E(L,"class","relative group"),E(he,"class","group relative px-10 py-4 bg-white text-black rounded-full font-bold tracking-widest hover:scale-105 transition-all shadow-[0_0_30px_rgba(255,255,255,0.1)] hover:shadow-[0_0_40px_rgba(255,255,255,0.3)] active:scale-95 flex items-center gap-3 z-50"),E(we,"class",He="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(r[7]==="focus"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")),E(ye,"class",je="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(r[7]==="short"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")),E(ke,"class",Ye="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(r[7]==="long"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")),E(pe,"class","p-2 text-slate-600 hover:text-red-400 transition-colors ml-2"),E(pe,"title","Reset"),E(oe,"class","flex items-center gap-4 z-50"),E(fe,"class","mt-12 flex flex-col items-center gap-6 animate-fade-in-up"),E(A,"class","flex-1 flex flex-col items-center justify-center p-4"),E($e,"class","h-24 w-full flex items-end justify-center pb-4 opacity-30 hover:opacity-100 transition-opacity"),E(f,"class","relative z-10 w-full h-full flex flex-col"),E(e,"class","relative w-screen h-screen bg-[#0B1120] overflow-hidden flex flex-col text-white font-poppins selection:bg-purple-500/30")},m(D,z){G&&G.m(D,z),ve(D,t,z),ve(D,e,z),v(e,s),v(s,i),r[20](i),v(s,n),v(s,a),v(e,l),v(e,f),v(f,d),v(d,g),v(d,p),v(d,_),v(d,O),v(d,x),v(f,M),v(f,A),v(A,L),v(L,y),v(y,U),v(y,j),v(L,ce),v(L,W),v(W,se),v(se,Te),v(W,Be),v(W,de),v(de,Ne),v(A,q),v(A,fe),v(fe,he),ge.m(he,null),v(fe,Ie),v(fe,oe),v(oe,we),v(we,Ue),v(oe,Ge),v(oe,ye),v(ye,Pe),v(oe,We),v(oe,ke),v(ke,ot),v(oe,at),v(oe,pe),v(f,ct),v(f,$e),Ds(Ce,$e,null),v(e,ft),Z&&Z.m(e,null),ie=!0,ht||(bt=[Ae(x,"click",r[15]),Ae(he,"click",r[12]),Ae(we,"click",r[21]),Ae(ye,"click",r[22]),Ae(ke,"click",r[23]),Ae(pe,"click",r[13])],ht=!0)},p(D,z){D[4]?G?(G.p(D,z),z[0]&16&&_t(G,1)):(G=Ts(D),G.c(),_t(G,1),G.m(t.parentNode,t)):G&&(dr(),$t(G,1,1,()=>{G=null}),ur()),(!ie||z[0]&64)&&B(i,"blur-md",!D[6]),(!ie||z[0]&64)&&B(i,"blur-lg",D[6]),(!ie||z[0]&64)&&B(i,"scale-125",D[6]),(!ie||z[0]&512)&&E(j,"stroke-dashoffset",D[9]),(!ie||z[0]&2)&&be!==(be=Os(D[1])+"")&&Rt(Te,be),(!ie||z[0]&64)&&Ee!==(Ee=D[6]?"Enfocado":"Listo")&&Rt(Ne,Ee),Ze!==(Ze=Et(D))&&(ge.d(1),ge=Ze(D),ge&&(ge.c(),ge.m(he,null))),(!ie||z[0]&128&&He!==(He="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(D[7]==="focus"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")))&&E(we,"class",He),(!ie||z[0]&128&&je!==(je="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(D[7]==="short"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")))&&E(ye,"class",je),(!ie||z[0]&128&&Ye!==(Ye="px-4 py-2 rounded-lg text-sm font-medium transition-all "+(D[7]==="long"?"bg-white/10 text-white border border-white/20":"text-slate-500 hover:text-slate-300 hover:bg-white/5")))&&E(ke,"class",Ye),D[5]?Z?Z.p(D,z):(Z=Ns(D),Z.c(),Z.m(e,null)):Z&&(Z.d(1),Z=null)},i(D){ie||(_t(G),_t(Ce.$$.fragment,D),ie=!0)},o(D){$t(G),$t(Ce.$$.fragment,D),ie=!1},d(D){D&&(N(t),N(e)),G&&G.d(D),r[20](null),ge.d(),Ls(Ce),Z&&Z.d(),ht=!1,lr(bt)}}}function Os(r){const t=Math.floor(r/60),e=r%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}function fi(r,t,e){let s,i,n,a,l;Ut(r,Fe,q=>e(18,n=q)),Ut(r,Er,q=>e(19,a=q)),Ut(r,qs,q=>e(10,l=q));let f,d,g=!0,w=!1,p=!1,_=25*60,b=_,O,x="focus";function K(q){L(),e(7,x=q),q==="focus"&&e(0,_=25*60),q==="short"&&e(0,_=5*60),q==="long"&&e(0,_=15*60),e(1,b=_)}function M(){p?L():A()}function A(){b<=0&&e(1,b=_),e(6,p=!0),O=setInterval(()=>{b>0?e(1,b--,b):U()},1e3)}function L(){e(6,p=!1),clearInterval(O)}function y(){L(),e(1,b=_)}function U(){L(),Lt(!0),setTimeout(()=>Lt(!0),500),setTimeout(()=>Lt(!0),1e3)}function j(){e(4,g=!1),wr()}function ce(){e(5,w=!w)}function W(q){yr(q),e(5,w=!1)}let se="all";cr(async()=>{const{Chessboard:q,BORDER_TYPE:fe}=await nr(async()=>{const{Chessboard:he,BORDER_TYPE:Ie}=await import("../chunks/B02hmuqp.js");return{Chessboard:he,BORDER_TYPE:Ie}},[],import.meta.url);e(17,d=new q(f,{position:n.fen,style:{cssClass:"default",showCoordinates:!1,borderType:fe.none},responsive:!0,animationDuration:800,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}})),n.history.length===0&&rs()}),fr(()=>{d&&d.destroy(),L()});function be(q){hr[q?"unshift":"push"](()=>{f=q,e(3,f)})}const Te=()=>K("focus"),Be=()=>K("short"),de=()=>K("long"),Ee=q=>e(2,se=q.id),Ne=q=>W(q.id);return r.$$.update=()=>{r.$$.dirty[0]&3&&e(9,s=(_-b)/_*283),r.$$.dirty[0]&524288&&(a.loading||a.user||pr("/")),r.$$.dirty[0]&393216&&d&&n.fen&&d.setPosition(n.fen,!0),r.$$.dirty[0]&4&&e(8,i=se==="all"?gs:gs.filter(q=>q.category===se))},[_,b,se,f,g,w,p,x,i,s,l,K,M,y,j,ce,W,d,n,a,be,Te,Be,de,Ee,Ne]}class yi extends ts{constructor(t){super(),ss(this,t,fi,ci,es,{},null,[-1,-1])}}export{yi as component};
