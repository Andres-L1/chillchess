var Gs=Object.defineProperty;var zs=(r,t,e)=>t in r?Gs(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var H=(r,t,e)=>zs(r,typeof t!="symbol"?t+"":t,e);import{_ as Ws}from"../chunks/CmsKOCeN.js";import{a4 as ws,s as Es,n as ts,d as S,B as q,i as oe,p as b,g as v,j as I,t as D,c as V,l as P,a as Q,r as Ys,q as xe,k as he,C as Pt,u as Le,D as Mt,v as De,b as Ot,o as Zs,a5 as Js,x as ss,P as Xs,m as Bt,H as rs}from"../chunks/DuEcKkfz.js";import{S as ks,i as xs,d as er,t as tr,a as sr,m as rr,c as ir,b as nr}from"../chunks/CXtFNhqh.js";import{e as xt}from"../chunks/BxItBZY0.js";import{g as or}from"../chunks/C-ljIkse.js";import{w as ar}from"../chunks/E95olI4G.js";import{n as lr,c as cr,d as fr,p as hr}from"../chunks/DtVK9R3Z.js";import{a as ys,C as is,u as ur,p as dr}from"../chunks/CA9CvuXV.js";import{u as pr}from"../chunks/CZVmiJFr.js";function gr(r){return r!==null?{comment:r,variations:[]}:{variations:[]}}function _r(r,t,e,s,i){const n={move:r,variations:i};return t&&(n.suffix=t),e&&(n.nag=e),s!==null&&(n.comment=s),n}function mr(...r){const[t,...e]=r;let s=t;for(const i of e)i!==null&&(s.variations=[i,...i.variations],i.variations=[],s=i);return t}function vr(r,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:r,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function br(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}function tt(r,t,e,s){var i=Error.call(this,r);return Object.setPrototypeOf&&Object.setPrototypeOf(i,tt.prototype),i.expected=t,i.found=e,i.location=s,i.name="SyntaxError",i}br(tt,Error);function Lt(r,t,e){return e=e||" ",r.length>t?r:(t-=r.length,e+=e.repeat(t),r+e.slice(0,t))}tt.prototype.format=function(r){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<r.length;s++)if(r[s].source===this.location.source){e=r[s].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,l=this.location.source+":"+n.line+":"+n.column;if(e){var o=this.location.end,c=Lt("",n.line.toString().length," "),p=e[i.line-1],g=i.line===o.line?o.column:p.length+1,w=g-i.column||1;t+=`
 --> `+l+`
`+c+` |
`+n.line+" | "+p+`
`+c+" | "+Lt("",i.column-1," ")+Lt("",w,"^")}else t+=`
 at `+l}return t};tt.buildMessage=function(r,t){var e={literal:function(p){return'"'+i(p.text)+'"'},class:function(p){var g=p.parts.map(function(w){return Array.isArray(w)?n(w[0])+"-"+n(w[1]):n(w)});return"["+(p.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function i(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function n(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function l(p){return e[p.type](p)}function o(p){var g=p.map(l),w,d;if(g.sort(),g.length>0){for(w=1,d=1;w<g.length;w++)g[w-1]!==g[w]&&(g[d]=g[w],d++);g.length=d}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function c(p){return p?'"'+i(p)+'"':"end of input"}return"Expected "+o(r)+" but "+c(t)+" found."};function wr(r,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,i={pgn:Wt},n=Wt,l="[",o='"',c="]",p=".",g="O-O-O",w="O-O",d="0-0-0",_="0-0",k="$",T="{",O="}",F=";",$="(",A=")",U="1-0",E="0-1",R="1/2-1/2",me="*",z=/^[a-zA-Z]/,te=/^[^"]/,re=/^[0-9]/,ae=/^[.]/,Ce=/^[a-zA-Z1-8\-=]/,Y=/^[+#]/,le=/^[!?]/,Se=/^[^}]/,K=/^[^\r\n]/,ue=/^[ \t\r\n]/,de=_e("tag pair"),Re=J("[",!1),Ke=J('"',!1),st=J("]",!1),Ee=_e("tag name"),Fe=ke([["a","z"],["A","Z"]],!1,!1),je=_e("tag value"),He=ke(['"'],!0,!1),qe=_e("move number"),Ae=ke([["0","9"]],!1,!1),ve=J(".",!1),rt=ke(["."],!1,!1),it=_e("standard algebraic notation"),Te=J("O-O-O",!1),ye=J("O-O",!1),nt=J("0-0-0",!1),Ge=J("0-0",!1),ie=ke([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),ot=ke(["+","#"],!1,!1),pt=_e("suffix annotation"),at=ke(["!","?"],!1,!1),ze=_e("NAG"),ce=J("$",!1),gt=_e("brace comment"),We=J("{",!1),pe=ke(["}"],!0,!1),Z=J("}",!1),L=_e("rest of line comment"),j=J(";",!1),Be=ke(["\r",`
`],!0,!1),Ne=_e("variation"),Ie=J("(",!1),Ye=J(")",!1),Ze=_e("game termination marker"),lt=J("1-0",!1),_t=J("0-1",!1),Je=J("1/2-1/2",!1),mt=J("*",!1),ge=_e("whitespace"),ct=ke([" ","	","\r",`
`],!1,!1),vt=function(a,h){return vr(a,h)},bt=function(a){return Object.fromEntries(a)},wt=function(a,h){return[a,h]},As=function(a,h){return{root:a,marker:h}},Ts=function(a,h){return mr(gr(a),...h.flat())},Ns=function(a,h,u,y,C){return _r(a,h,u,y,C)},Is=function(a){return a},Ps=function(a){return a.replace(/[\r\n]+/g," ")},Ms=function(a){return a.trim()},Os=function(a){return a},Ls=function(a,h){return{result:a,comment:h}},f=t.peg$currPos|0,Xe=[{line:1,column:1}],be=f,Et=t.peg$maxFailExpected||[],m=t.peg$silentFails|0,ft;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');n=i[t.startRule]}function J(a,h){return{type:"literal",text:a,ignoreCase:h}}function ke(a,h,u){return{type:"class",parts:a,inverted:h,ignoreCase:u}}function Ds(){return{type:"end"}}function _e(a){return{type:"other",description:a}}function Gt(a){var h=Xe[a],u;if(h)return h;if(a>=Xe.length)u=Xe.length-1;else for(u=a;!Xe[--u];);for(h=Xe[u],h={line:h.line,column:h.column};u<a;)r.charCodeAt(u)===10?(h.line++,h.column=1):h.column++,u++;return Xe[a]=h,h}function zt(a,h,u){var y=Gt(a),C=Gt(h),B={source:s,start:{offset:a,line:y.line,column:y.column},end:{offset:h,line:C.line,column:C.column}};return B}function x(a){f<be||(f>be&&(be=f,Et=[]),Et.push(a))}function $s(a,h,u){return new tt(tt.buildMessage(a,h),a,h,u)}function Wt(){var a,h,u;return a=f,h=Rs(),u=qs(),a=vt(h,u),a}function Rs(){var a,h,u;for(a=f,h=[],u=Yt();u!==e;)h.push(u),u=Yt();return u=ne(),a=bt(h),a}function Yt(){var a,h,u,y,C,B,Ue;return m++,a=f,ne(),r.charCodeAt(f)===91?(h=l,f++):(h=e,m===0&&x(Re)),h!==e?(ne(),u=Ks(),u!==e?(ne(),r.charCodeAt(f)===34?(y=o,f++):(y=e,m===0&&x(Ke)),y!==e?(C=Fs(),r.charCodeAt(f)===34?(B=o,f++):(B=e,m===0&&x(Ke)),B!==e?(ne(),r.charCodeAt(f)===93?(Ue=c,f++):(Ue=e,m===0&&x(st)),Ue!==e?a=wt(u,C):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e)):(f=a,a=e),m--,a===e&&m===0&&x(de),a}function Ks(){var a,h,u;if(m++,a=f,h=[],u=r.charAt(f),z.test(u)?f++:(u=e,m===0&&x(Fe)),u!==e)for(;u!==e;)h.push(u),u=r.charAt(f),z.test(u)?f++:(u=e,m===0&&x(Fe));else h=e;return h!==e?a=r.substring(a,f):a=h,m--,a===e&&(h=e,m===0&&x(Ee)),a}function Fs(){var a,h,u;for(m++,a=f,h=[],u=r.charAt(f),te.test(u)?f++:(u=e,m===0&&x(He));u!==e;)h.push(u),u=r.charAt(f),te.test(u)?f++:(u=e,m===0&&x(He));return a=r.substring(a,f),m--,h=e,m===0&&x(je),a}function qs(){var a,h,u;return a=f,h=Zt(),ne(),u=Hs(),u===e&&(u=null),ne(),a=As(h,u),a}function Zt(){var a,h,u,y;for(a=f,h=It(),h===e&&(h=null),u=[],y=Jt();y!==e;)u.push(y),y=Jt();return a=Ts(h,u),a}function Jt(){var a,h,u,y,C,B,Ue,kt;if(a=f,ne(),Bs(),ne(),h=Us(),h!==e){for(u=Vs(),u===e&&(u=null),y=[],C=Xt();C!==e;)y.push(C),C=Xt();for(C=ne(),B=It(),B===e&&(B=null),Ue=[],kt=es();kt!==e;)Ue.push(kt),kt=es();a=Ns(h,u,y,B,Ue)}else f=a,a=e;return a}function Bs(){var a,h,u,y,C,B;for(m++,a=f,h=[],u=r.charAt(f),re.test(u)?f++:(u=e,m===0&&x(Ae));u!==e;)h.push(u),u=r.charAt(f),re.test(u)?f++:(u=e,m===0&&x(Ae));if(r.charCodeAt(f)===46?(u=p,f++):(u=e,m===0&&x(ve)),u!==e){for(y=ne(),C=[],B=r.charAt(f),ae.test(B)?f++:(B=e,m===0&&x(rt));B!==e;)C.push(B),B=r.charAt(f),ae.test(B)?f++:(B=e,m===0&&x(rt));h=[h,u,y,C],a=h}else f=a,a=e;return m--,a===e&&(h=e,m===0&&x(qe)),a}function Us(){var a,h,u,y,C,B;if(m++,a=f,h=f,r.substr(f,5)===g?(u=g,f+=5):(u=e,m===0&&x(Te)),u===e&&(r.substr(f,3)===w?(u=w,f+=3):(u=e,m===0&&x(ye)),u===e&&(r.substr(f,5)===d?(u=d,f+=5):(u=e,m===0&&x(nt)),u===e&&(r.substr(f,3)===_?(u=_,f+=3):(u=e,m===0&&x(Ge)),u===e))))if(u=f,y=r.charAt(f),z.test(y)?f++:(y=e,m===0&&x(Fe)),y!==e){if(C=[],B=r.charAt(f),Ce.test(B)?f++:(B=e,m===0&&x(ie)),B!==e)for(;B!==e;)C.push(B),B=r.charAt(f),Ce.test(B)?f++:(B=e,m===0&&x(ie));else C=e;C!==e?(y=[y,C],u=y):(f=u,u=e)}else f=u,u=e;return u!==e?(y=r.charAt(f),Y.test(y)?f++:(y=e,m===0&&x(ot)),y===e&&(y=null),u=[u,y],h=u):(f=h,h=e),h!==e?a=r.substring(a,f):a=h,m--,a===e&&(h=e,m===0&&x(it)),a}function Vs(){var a,h,u;for(m++,a=f,h=[],u=r.charAt(f),le.test(u)?f++:(u=e,m===0&&x(at));u!==e;)h.push(u),h.length>=2?u=e:(u=r.charAt(f),le.test(u)?f++:(u=e,m===0&&x(at)));return h.length<1?(f=a,a=e):a=h,m--,a===e&&(h=e,m===0&&x(pt)),a}function Xt(){var a,h,u,y,C;if(m++,a=f,ne(),r.charCodeAt(f)===36?(h=k,f++):(h=e,m===0&&x(ce)),h!==e){if(u=f,y=[],C=r.charAt(f),re.test(C)?f++:(C=e,m===0&&x(Ae)),C!==e)for(;C!==e;)y.push(C),C=r.charAt(f),re.test(C)?f++:(C=e,m===0&&x(Ae));else y=e;y!==e?u=r.substring(u,f):u=y,u!==e?a=Is(u):(f=a,a=e)}else f=a,a=e;return m--,a===e&&m===0&&x(ze),a}function It(){var a;return a=Qs(),a===e&&(a=js()),a}function Qs(){var a,h,u,y,C;if(m++,a=f,r.charCodeAt(f)===123?(h=T,f++):(h=e,m===0&&x(We)),h!==e){for(u=f,y=[],C=r.charAt(f),Se.test(C)?f++:(C=e,m===0&&x(pe));C!==e;)y.push(C),C=r.charAt(f),Se.test(C)?f++:(C=e,m===0&&x(pe));u=r.substring(u,f),r.charCodeAt(f)===125?(y=O,f++):(y=e,m===0&&x(Z)),y!==e?a=Ps(u):(f=a,a=e)}else f=a,a=e;return m--,a===e&&(h=e,m===0&&x(gt)),a}function js(){var a,h,u,y,C;if(m++,a=f,r.charCodeAt(f)===59?(h=F,f++):(h=e,m===0&&x(j)),h!==e){for(u=f,y=[],C=r.charAt(f),K.test(C)?f++:(C=e,m===0&&x(Be));C!==e;)y.push(C),C=r.charAt(f),K.test(C)?f++:(C=e,m===0&&x(Be));u=r.substring(u,f),a=Ms(u)}else f=a,a=e;return m--,a===e&&(h=e,m===0&&x(L)),a}function es(){var a,h,u,y;return m++,a=f,ne(),r.charCodeAt(f)===40?(h=$,f++):(h=e,m===0&&x(Ie)),h!==e?(u=Zt(),u!==e?(ne(),r.charCodeAt(f)===41?(y=A,f++):(y=e,m===0&&x(Ye)),y!==e?a=Os(u):(f=a,a=e)):(f=a,a=e)):(f=a,a=e),m--,a===e&&m===0&&x(Ne),a}function Hs(){var a,h,u;return m++,a=f,r.substr(f,3)===U?(h=U,f+=3):(h=e,m===0&&x(lt)),h===e&&(r.substr(f,3)===E?(h=E,f+=3):(h=e,m===0&&x(_t)),h===e&&(r.substr(f,7)===R?(h=R,f+=7):(h=e,m===0&&x(Je)),h===e&&(r.charCodeAt(f)===42?(h=me,f++):(h=e,m===0&&x(mt))))),h!==e?(ne(),u=It(),u===e&&(u=null),a=Ls(h,u)):(f=a,a=e),m--,a===e&&(h=e,m===0&&x(Ze)),a}function ne(){var a,h;for(m++,a=[],h=r.charAt(f),ue.test(h)?f++:(h=e,m===0&&x(ct));h!==e;)a.push(h),h=r.charAt(f),ue.test(h)?f++:(h=e,m===0&&x(ct));return m--,h=e,m===0&&x(ge),a}if(ft=n(),t.peg$library)return{peg$result:ft,peg$currPos:f,peg$FAILED:e,peg$maxFailExpected:Et,peg$maxFailPos:be};if(ft!==e&&f===r.length)return ft;throw ft!==e&&f<r.length&&x(Ds()),$s(Et,be<r.length?r.charAt(be):null,be<r.length?zt(be,be+1):zt(be,be))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const St=0xffffffffffffffffn;function Dt(r,t){return(r<<t|r>>64n-t)&0xffffffffffffffffn}function ns(r,t){return r*t&St}function Er(r){return function(){let t=BigInt(r&St),e=BigInt(r>>64n&St);const s=ns(Dt(ns(t,5n),7n),9n);return e^=t,t=(Dt(t,24n)^e^e<<16n)&St,e=Dt(e,37n),r=e<<64n|t,s}}const Nt=Er(0xa187eb39cdcaed8f31c4b365b102e01en),kr=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>Nt()))),xr=Array.from({length:8},()=>Nt()),yr=Array.from({length:16},()=>Nt()),$t=Nt(),se="w",fe="b",G="p",Ut="n",At="b",ut="r",Oe="q",W="k",Rt="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class yt{constructor(t,e){H(this,"color");H(this,"from");H(this,"to");H(this,"piece");H(this,"captured");H(this,"promotion");H(this,"flags");H(this,"san");H(this,"lan");H(this,"before");H(this,"after");const{color:s,piece:i,from:n,to:l,flags:o,captured:c,promotion:p}=e,g=X(n),w=X(l);this.color=s,this.piece=i,this.from=g,this.to=w,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=g+w,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const d in M)M[d]&o&&(this.flags+=Ve[d]);c&&(this.captured=c),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(Ve.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ve.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ve.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ve.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ve.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ve.BIG_PAWN)>-1}}const ee=-1,Ve={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},M={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Vt={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Cr={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Sr={...Vt,...Cr},N={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Kt={b:[16,32,17,15],w:[-16,-32,-17,-15]},os={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Ar=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Tr=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Nr={p:1,n:2,b:4,r:8,q:16,k:32},Ir="pnbrqkPNBRQK",as=[Ut,At,ut,Oe],Pr=7,Mr=6,Or=1,Lr=0,Ct={[W]:M.KSIDE_CASTLE,[Oe]:M.QSIDE_CASTLE},Pe={w:[{square:N.a1,flag:M.QSIDE_CASTLE},{square:N.h1,flag:M.KSIDE_CASTLE}],b:[{square:N.a8,flag:M.QSIDE_CASTLE},{square:N.h8,flag:M.KSIDE_CASTLE}]},Dr={b:Or,w:Mr},Ft="--";function Qe(r){return r>>4}function dt(r){return r&15}function Cs(r){return"0123456789".indexOf(r)!==-1}function X(r){const t=dt(r),e=Qe(r);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function ht(r){return r===se?fe:se}function $r(r){const t=r.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let l=0;l<i.length;l++){let o=0,c=!1;for(let p=0;p<i[l].length;p++)if(Cs(i[l][p])){if(c)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};o+=parseInt(i[l][p],10),c=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[l][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};o+=1,c=!1}if(o!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:l,regex:o}of n){if(!o.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${l} king`};if((t[0].match(o)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${l} kings`}}return Array.from(i[0]+i[7]).some(l=>l.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Rr(r,t){const e=r.from,s=r.to,i=r.piece;let n=0,l=0,o=0;for(let c=0,p=t.length;c<p;c++){const g=t[c].from,w=t[c].to,d=t[c].piece;i===d&&e!==g&&s===w&&(n++,Qe(e)===Qe(g)&&l++,dt(e)===dt(g)&&o++)}return n>0?l>0&&o>0?X(e):o>0?X(e).charAt(1):X(e).charAt(0):""}function Me(r,t,e,s,i,n=void 0,l=M.NORMAL){const o=Qe(s);if(i===G&&(o===Pr||o===Lr))for(let c=0;c<as.length;c++){const p=as[c];r.push({color:t,from:e,to:s,piece:i,captured:n,promotion:p,flags:l|M.PROMOTION})}else r.push({color:t,from:e,to:s,piece:i,captured:n,flags:l})}function ls(r){let t=r.charAt(0);return t>="a"&&t<="h"?r.match(/[a-h]\d.*[a-h]\d/)?void 0:G:(t=t.toLowerCase(),t==="o"?W:t)}function qt(r){return r.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Ss{constructor(t=Rt,{skipValidation:e=!1}={}){H(this,"_board",new Array(128));H(this,"_turn",se);H(this,"_header",{});H(this,"_kings",{w:ee,b:ee});H(this,"_epSquare",-1);H(this,"_halfMoves",0);H(this,"_moveNumber",0);H(this,"_history",[]);H(this,"_comments",{});H(this,"_castling",{w:0,b:0});H(this,"_hash",0n);H(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:ee,b:ee},this._turn=se,this._castling={w:0,b:0},this._epSquare=ee,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Sr},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const o=["-","-","0","1"];t=i.concat(o.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!e){const{ok:o,error:c}=$r(t);if(!o)throw new Error(c)}const n=i[0];let l=0;this.clear({preserveHeaders:s});for(let o=0;o<n.length;o++){const c=n.charAt(o);if(c==="/")l+=8;else if(Cs(c))l+=parseInt(c,10);else{const p=c<"a"?se:fe;this._put({type:c.toLowerCase(),color:p},X(l)),l++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=M.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=M.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=M.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=M.QSIDE_CASTLE),this._epSquare=i[3]==="-"?ee:N[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){let e=0,s="";for(let l=N.a8;l<=N.h1;l++){if(this._board[l]){e>0&&(s+=e,e=0);const{color:o,type:c}=this._board[l];s+=o===se?c.toUpperCase():c.toLowerCase()}else e++;l+1&136&&(e>0&&(s+=e),l!==N.h1&&(s+="/"),e=0,l+=8)}let i="";this._castling[se]&M.KSIDE_CASTLE&&(i+="K"),this._castling[se]&M.QSIDE_CASTLE&&(i+="Q"),this._castling[fe]&M.KSIDE_CASTLE&&(i+="k"),this._castling[fe]&M.QSIDE_CASTLE&&(i+="q"),i=i||"-";let n="-";if(this._epSquare!==ee)if(t)n=X(this._epSquare);else{const l=this._epSquare+(this._turn===se?16:-16),o=[l+1,l-1];for(const c of o){if(c&136)continue;const p=this._turn;if(this._board[c]?.color===p&&this._board[c]?.type===G){this._makeMove({color:p,from:c,to:this._epSquare,piece:G,captured:G,flags:M.EP_CAPTURE});const g=!this._isKingAttacked(p);if(this._undoMove(),g){n=X(this._epSquare);break}}}}return[s,this._turn,i,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],i={w:0,b:1}[e],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return kr[i][n][t]}_epKey(){return this._epSquare===ee?0n:xr[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return yr[t]}_computeHash(){let t=0n;for(let e=N.a8;e<=N.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=$t),t}_updateSetup(t){this._history.length>0||(t!==Rt?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Rt)}get(t){return this._board[N[t]]}findPiece(t){const e=[];for(let s=N.a8;s<=N.h1;s++){if(s&136){s+=7;continue}!this._board[s]||this._board[s]?.color!==t.color||this._board[s].color===t.color&&this._board[s].type===t.type&&e.push(X(s))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Ir.indexOf(t.toLowerCase())===-1||!(s in N))return!1;const i=N[s];if(t==W&&!(this._kings[e]==ee||this._kings[e]==i))return!1;const n=this._board[i];return n&&n.type===W&&(this._kings[n.color]=ee),this._set(i,{type:t,color:e}),t===W&&(this._kings[e]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(N[t]),e&&e.type===W&&(this._kings[e.color]=ee),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){this._hash^=this._castlingKey();const t=this._board[N.e1]?.type===W&&this._board[N.e1]?.color===se,e=this._board[N.e8]?.type===W&&this._board[N.e8]?.color===fe;(!t||this._board[N.a1]?.type!==ut||this._board[N.a1]?.color!==se)&&(this._castling.w&=-65),(!t||this._board[N.h1]?.type!==ut||this._board[N.h1]?.color!==se)&&(this._castling.w&=-33),(!e||this._board[N.a8]?.type!==ut||this._board[N.a8]?.color!==fe)&&(this._castling.b&=-65),(!e||this._board[N.h8]?.type!==ut||this._board[N.h8]?.color!==fe)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){if(this._epSquare===ee)return;const t=this._epSquare+(this._turn===se?-16:16),e=this._epSquare+(this._turn===se?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||this._board[e]?.color!==ht(this._turn)||this._board[e]?.type!==G){this._hash^=this._epKey(),this._epSquare=ee;return}const i=n=>!(n&136)&&this._board[n]?.color===this._turn&&this._board[n]?.type===G;s.some(i)||(this._hash^=this._epKey(),this._epSquare=ee)}_attacked(t,e,s){const i=[];for(let n=N.a8;n<=N.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==t)continue;const l=this._board[n],o=n-e;if(o===0)continue;const c=o+119;if(Ar[c]&Nr[l.type]){if(l.type===G){if(o>0&&l.color===se||o<=0&&l.color===fe)if(s)i.push(X(n));else return!0;continue}if(l.type==="n"||l.type==="k")if(s){i.push(X(n));continue}else return!0;const p=Tr[c];let g=n+p,w=!1;for(;g!==e;){if(this._board[g]!=null){w=!0;break}g+=p}if(!w)if(s){i.push(X(n));continue}else return!0}}return s?i:!1}attackers(t,e){return e?this._attacked(e,N[t],!0):this._attacked(this._turn,N[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(ht(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,N[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,i=0;for(let n=N.a8;n<=N.h1;n++){if(i=(i+1)%2,n&136){n+=7;continue}const l=this._board[n];l&&(t[l.type]=l.type in t?t[l.type]+1:1,l.type===At&&e.push(i),s++)}if(s===2)return!0;if(s===3&&(t[At]===1||t[Ut]===1))return!0;if(s===t[At]+2){let n=0;const l=e.length;for(let o=0;o<l;o++)n+=e[o];if(n===0||n===l)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const i=this._moves({square:e,piece:s});return t?i.map(n=>new yt(this,n)):i.map(n=>this._moveToSan(n,i))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){const i=s?s.toLowerCase():void 0,n=e?.toLowerCase(),l=[],o=this._turn,c=ht(o);let p=N.a8,g=N.h1,w=!1;if(i)if(i in N)p=g=N[i],w=!0;else return[];for(let _=p;_<=g;_++){if(_&136){_+=7;continue}if(!this._board[_]||this._board[_].color===c)continue;const{type:k}=this._board[_];let T;if(k===G){if(n&&n!==k)continue;T=_+Kt[o][0],this._board[T]||(Me(l,o,_,T,G),T=_+Kt[o][1],Dr[o]===Qe(_)&&!this._board[T]&&Me(l,o,_,T,G,void 0,M.BIG_PAWN));for(let O=2;O<4;O++)T=_+Kt[o][O],!(T&136)&&(this._board[T]?.color===c?Me(l,o,_,T,G,this._board[T].type,M.CAPTURE):T===this._epSquare&&Me(l,o,_,T,G,G,M.EP_CAPTURE))}else{if(n&&n!==k)continue;for(let O=0,F=os[k].length;O<F;O++){const $=os[k][O];for(T=_;T+=$,!(T&136);){if(!this._board[T])Me(l,o,_,T,k);else{if(this._board[T].color===o)break;Me(l,o,_,T,k,this._board[T].type,M.CAPTURE);break}if(k===Ut||k===W)break}}}}if((n===void 0||n===W)&&(!w||g===this._kings[o])){if(this._castling[o]&M.KSIDE_CASTLE){const _=this._kings[o],k=_+2;!this._board[_+1]&&!this._board[k]&&!this._attacked(c,this._kings[o])&&!this._attacked(c,_+1)&&!this._attacked(c,k)&&Me(l,o,this._kings[o],k,W,void 0,M.KSIDE_CASTLE)}if(this._castling[o]&M.QSIDE_CASTLE){const _=this._kings[o],k=_-2;!this._board[_-1]&&!this._board[_-2]&&!this._board[_-3]&&!this._attacked(c,this._kings[o])&&!this._attacked(c,_-1)&&!this._attacked(c,k)&&Me(l,o,this._kings[o],k,W,void 0,M.QSIDE_CASTLE)}}if(!t||this._kings[o]===-1)return l;const d=[];for(let _=0,k=l.length;_<k;_++)this._makeMove(l[_]),this._isKingAttacked(o)||d.push(l[_]),this._undoMove();return d}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(Ft,e);else if(typeof t=="object"){const n=this._moves();for(let l=0,o=n.length;l<o;l++)if(t.from===X(n[l].from)&&t.to===X(n[l].to)&&(!("promotion"in n[l])||t.promotion===n[l].promotion)){s=n[l];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&M.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new yt(this,s);return this._makeMove(s),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){const e=this._turn,s=ht(e);if(this._push(t),t.flags&M.NULL_MOVE){e===fe&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=ee;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&M.EP_CAPTURE&&(this._turn===fe?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===W){if(this._kings[e]=t.to,t.flags&M.KSIDE_CASTLE){const i=t.to-1,n=t.to+1;this._movePiece(n,i)}else if(t.flags&M.QSIDE_CASTLE){const i=t.to+1,n=t.to-2;this._movePiece(n,i)}this._castling[e]=0}if(this._castling[e]){for(let i=0,n=Pe[e].length;i<n;i++)if(t.from===Pe[e][i].square&&this._castling[e]&Pe[e][i].flag){this._castling[e]^=Pe[e][i].flag;break}}if(this._castling[s]){for(let i=0,n=Pe[s].length;i<n;i++)if(t.to===Pe[s][i].square&&this._castling[s]&Pe[s][i].flag){this._castling[s]^=Pe[s][i].flag;break}}if(this._hash^=this._castlingKey(),t.flags&M.BIG_PAWN){let i;e===fe?i=t.to-16:i=t.to+16,!(t.to-1&136)&&this._board[t.to-1]?.type===G&&this._board[t.to-1]?.color===s||!(t.to+1&136)&&this._board[t.to+1]?.type===G&&this._board[t.to+1]?.color===s?(this._epSquare=i,this._hash^=this._epKey()):this._epSquare=ee}else this._epSquare=ee;t.piece===G?this._halfMoves=0:t.flags&(M.CAPTURE|M.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===fe&&this._moveNumber++,this._turn=s,this._hash^=$t}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new yt(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=$t;const s=this._turn,i=ht(s);if(e.flags&M.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&M.EP_CAPTURE){let n;s===fe?n=e.to-16:n=e.to+16,this._set(n,{type:G,color:i})}else this._set(e.to,{type:e.captured,color:i});if(e.flags&(M.KSIDE_CASTLE|M.QSIDE_CASTLE)){let n,l;e.flags&M.KSIDE_CASTLE?(n=e.to+1,l=e.to-1):(n=e.to-2,l=e.to+1),this._movePiece(l,n)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let i=!1;for(const d in this._header)this._header[d]&&s.push(`[${d} "${this._header[d]}"]`+t),i=!0;i&&this._history.length&&s.push(t);const n=d=>{const _=this._comments[this.fen()];if(typeof _<"u"){const k=d.length>0?" ":"";d=`${d}${k}{${_}}`}return d},l=[];for(;this._history.length>0;)l.push(this._undoMove());const o=[];let c="";for(l.length===0&&o.push(n(""));l.length>0;){c=n(c);const d=l.pop();if(!d)break;if(!this._history.length&&d.color==="b"){const _=`${this._moveNumber}. ...`;c=c?`${c} ${_}`:_}else d.color==="w"&&(c.length&&o.push(c),c=this._moveNumber+".");c=c+" "+this._moveToSan(d,this._moves({legal:!0})),this._makeMove(d)}if(c.length&&o.push(n(c)),o.push(this._header.Result||"*"),e===0)return s.join("")+o.join(" ");const p=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},g=function(d,_){for(const k of _.split(" "))if(k){if(d+k.length>e){for(;p();)d--;s.push(t),d=0}s.push(k),d+=k.length,s.push(" "),d++}return p()&&d--,d};let w=0;for(let d=0;d<o.length;d++){if(w+o[d].length>e&&o[d].includes("{")){w=g(w,o[d]);continue}w+o[d].length>e&&d!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),w=0):d!==0&&(s.push(" "),w++),s.push(o[d]),w+=o[d].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??Vt[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Vt[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const i=wr(t);this.reset();const n=i.headers;let l="";for(const p in n)p.toLowerCase()==="fen"&&(l=n[p]),this.header(p,n[p]);if(!e)l&&this.load(l,{preserveHeaders:!0});else if(n.SetUp==="1"){if(!("FEN"in n))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}let o=i.root;for(;o;){if(o.move){const p=this._moveFromSan(o.move,e);if(p==null)throw new Error(`Invalid move in PGN: ${o.move}`);this._makeMove(p),this._incPositionCount()}o.comment!==void 0&&(this._comments[this.fen()]=o.comment),o=o.variations[0]}const c=i.result;c&&Object.keys(this._header).length&&this._header.Result!==c&&this.setHeader("Result",c)}_moveToSan(t,e){let s="";if(t.flags&M.KSIDE_CASTLE)s="O-O";else if(t.flags&M.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&M.NULL_MOVE)return Ft;if(t.piece!==G){const i=Rr(t,e);s+=t.piece.toUpperCase()+i}t.flags&(M.CAPTURE|M.EP_CAPTURE)&&(t.piece===G&&(s+=X(t.from)[0]),s+="x"),s+=X(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=qt(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==Ft)return{color:this._turn,from:0,to:0,piece:"k",flags:M.NULL_MOVE};let i=ls(s),n=this._moves({legal:!0,piece:i});for(let d=0,_=n.length;d<_;d++)if(s===qt(this._moveToSan(n[d],n)))return n[d];if(e)return null;let l,o,c,p,g,w=!1;if(o=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),o?(l=o[1],c=o[2],p=o[3],g=o[4],c.length==1&&(w=!0)):(o=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),o&&(l=o[1],c=o[2],p=o[3],g=o[4],c.length==1&&(w=!0))),i=ls(s),n=this._moves({legal:!0,piece:l||i}),!p)return null;for(let d=0,_=n.length;d<_;d++)if(c){if((!l||l.toLowerCase()==n[d].piece)&&N[c]==n[d].from&&N[p]==n[d].to&&(!g||g.toLowerCase()==n[d].promotion))return n[d];if(w){const k=X(n[d].from);if((!l||l.toLowerCase()==n[d].piece)&&N[p]==n[d].to&&(c==k[0]||c==k[1])&&(!g||g.toLowerCase()==n[d].promotion))return n[d]}}else if(s===qt(this._moveToSan(n[d],n)).replace("x",""))return n[d];return null}ascii(){let t=`   +------------------------+
`;for(let e=N.a8;e<=N.h1;e++){if(dt(e)===0&&(t+=" "+"87654321"[Qe(e)]+" |"),this._board[e]){const s=this._board[e].type,n=this._board[e].color===se?s.toUpperCase():s.toLowerCase();t+=" "+n+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const i=this._turn;for(let n=0,l=e.length;n<l;n++)this._makeMove(e[n]),this._isKingAttacked(i)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=N.a8;s<=N.h1;s++)this._board[s]==null?e.push(null):e.push({square:X(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in N){const e=N[t];return(Qe(e)+dt(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const i=e.pop();if(!i)break;t?s.push(new yt(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=i=>{i in this._comments&&(e[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const i of[W,Oe])e[i]!==void 0&&(e[i]?this._castling[t]|=Ct[i]:this._castling[t]&=~Ct[i]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[W]===void 0||e[W]===s[W])&&(e[Oe]===void 0||e[Oe]===s[Oe])}getCastlingRights(t){return{[W]:(this._castling[t]&Ct[W])!==0,[Oe]:(this._castling[t]&Ct[Oe])!==0}}moveNumber(){return this._moveNumber}}const Kr={id:"immortal",white:"Adolf Anderssen",black:"Lionel Kieseritzky",date:"1851",event:"London (friendly)",win:"white",description:"The Immortal Game - A romantic sacrifice masterpiece.",pgn:`[Event "London"]
[Site "London ENG"]
[Date "1851.06.21"]
[EventDate "1851.05.26"]
[Round "?"]
[Result "1-0"]
[White "Adolf Anderssen"]
[Black "Lionel Kieseritzky"]
[ECO "C33"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "45"]

1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5
9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6
16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8
22.Qf6+ Nxf6 23.Be7# 1-0`},Fr={id:"opera",white:"Paul Morphy",black:"Duke Karl / Count Isouard",date:"1858",event:"Paris Opera House",win:"white",description:"The Opera Game - Development over material.",pgn:`[Event "Paris"]
[Site "Paris FRA"]
[Date "1858.??.??"]
[EventDate "?"]
[Round "?"]
[Result "1-0"]
[White "Paul Morphy"]
[Black "Duke Karl / Count Isouard"]
[ECO "C41"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "33"]

1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3
c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6
15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0`},Qt=[Kr,Fr],qr={async log(r,t,e,s){if(!(typeof window>"u"))try{await lr(cr(fr,"system_logs"),{level:r,message:t,details:e?JSON.stringify(e,Object.getOwnPropertyNames(e)):null,userId:s||null,timestamp:hr(),url:window.location.href,userAgent:navigator.userAgent});const i=r==="error"?"color: red":r==="warn"?"color: orange":"color: cyan";console.log(`%c[${r.toUpperCase()}] ${t}`,i,e||"")}catch(i){console.error("Failed to log to Firestore:",i)}},info(r,t,e){this.log("info",r,t,e)},warn(r,t,e){this.log("warn",r,t,e)},error(r,t,e){this.log("error",r,t,e)}},cs={noir:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/move-self.mp3",library:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/wood/move-self.mp3",zen:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/glass/move-self.mp3",default:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/move-self.mp3"},fs={noir:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/capture.mp3",library:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/wood/capture.mp3",zen:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/glass/capture.mp3",default:"https://images.chesscomfiles.com/chess-themes/sounds/_Common/standard/capture.mp3"};function Tt(r=!1){try{const t=ws(ys);if(t.isMuted)return;const e=t.activeVibe||"custom",s=e==="custom"?"noir":e,n=(r?fs[s]:cs[s])||(r?fs.default:cs.default),l=new Audio(n);l.volume=Math.min((t.musicVolume+t.ambienceVolume)/2+.2,1);const o=l.play();o!==void 0&&o.catch(c=>{})}catch(t){console.warn("SFX Error:",t)}}let we=new Ss,jt=[];const Br={fen:we.fen(),history:[we.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:Qt[0],lastMove:null,isLoadingGame:!1},$e=ar(Br);let et=null;const Ur=3e3,hs=["DrNykterstein","Hikaru","Alireza2003","FabianoCaruana","LevonAronian","DanielNaroditsky","GothamChess"];async function Ht(){$e.update(r=>({...r,isLoadingGame:!0}));try{const r=hs[Math.floor(Math.random()*hs.length)];console.log(`Loading games from ${r}...`);const t=await fetch(`https://lichess.org/api/games/user/${r}?max=15&rated=true&perfType=blitz,rapid,classical&pgnInJson=true&clocks=false&evals=false&opening=true`,{headers:{Accept:"application/x-ndjson"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=(await t.text()).trim().split(`
`).filter(p=>p.length>0);if(s.length===0)throw console.warn("No games found for player, using local games"),new Error("No games found");const i=s[Math.floor(Math.random()*s.length)],n=JSON.parse(i);console.log(`Loaded game: ${n.id}`);const l=n.players?.white?.user?.name||"Unknown",o=n.players?.black?.user?.name||"Unknown",c={id:n.id,white:l,black:o,date:new Date(n.createdAt).getFullYear().toString(),event:`Lichess ${n.speed||"Blitz"}`,win:n.winner==="white"?"white":n.winner==="black"?"black":"draw",description:n.opening?.name||"Classic Game",pgn:n.pgn};us(c)}catch(r){qr.error("Failed to load Lichess game",{error:r.message||r}),console.log("Falling back to local games database");const t=Qt[Math.floor(Math.random()*Qt.length)];us(t)}finally{$e.update(r=>({...r,isLoadingGame:!1}))}}function us(r){jr(),we=new Ss;try{we.loadPgn(r.pgn),jt=we.history(),we.reset(),$e.set({fen:we.fen(),history:[we.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:r,lastMove:null,isLoadingGame:!1}),Qr()}catch(t){console.error("Failed to load PGN",t)}}function Vr(){const r=ws($e);if(r.currentMoveIndex>=jt.length-1){Ht();return}const t=r.currentMoveIndex+1,e=jt[t],s=we.move(e);s&&($e.update(i=>({...i,fen:we.fen(),currentMoveIndex:t,lastMove:s,history:[...i.history,we.fen()]})),Tt(s.flags.includes("c")||s.flags.includes("e")))}function Qr(){et&&clearInterval(et),$e.update(r=>({...r,isPlaying:!0})),et=setInterval(()=>{Vr()},Ur)}function jr(){et&&clearInterval(et),et=null,$e.update(r=>({...r,isPlaying:!1}))}Ht();function Hr(r){let t,e,s,i,n,l;return{c(){t=P("div"),e=P("div"),s=Q(),i=P("div"),n=Q(),l=P("div"),this.h()},l(o){t=I(o,"DIV",{class:!0});var c=D(t);e=I(c,"DIV",{class:!0}),D(e).forEach(S),s=V(c),i=I(c,"DIV",{class:!0}),D(i).forEach(S),n=V(c),l=I(c,"DIV",{class:!0}),D(l).forEach(S),c.forEach(S),this.h()},h(){v(e,"class","wave absolute bottom-0 left-0 w-[200%] h-[50%] opacity-30 mix-blend-screen animate-wave-slow svelte-h0amw8"),q(e,"bg-blue-500",r[0]==="noir"),q(e,"bg-amber-600",r[0]==="library"),q(e,"bg-pink-400",r[0]==="zen"),v(i,"class","wave absolute bottom-[-10%] left-[-50%] w-[200%] h-[50%] opacity-30 mix-blend-screen animate-wave-medium delay-700 svelte-h0amw8"),q(i,"bg-purple-600",r[0]==="noir"),q(i,"bg-orange-500",r[0]==="library"),q(i,"bg-green-400",r[0]==="zen"),v(l,"class","wave absolute bottom-[-20%] left-[-20%] w-[200%] h-[60%] opacity-20 mix-blend-screen animate-wave-fast delay-1000 svelte-h0amw8"),q(l,"bg-indigo-500",r[0]==="noir"),q(l,"bg-yellow-600",r[0]==="library"),q(l,"bg-teal-400",r[0]==="zen"),v(t,"class","absolute inset-0 z-0 pointer-events-none overflow-hidden transition-opacity duration-1000"),q(t,"opacity-40",r[1]),q(t,"opacity-0",!r[1])},m(o,c){oe(o,t,c),b(t,e),b(t,s),b(t,i),b(t,n),b(t,l)},p(o,[c]){c&1&&q(e,"bg-blue-500",o[0]==="noir"),c&1&&q(e,"bg-amber-600",o[0]==="library"),c&1&&q(e,"bg-pink-400",o[0]==="zen"),c&1&&q(i,"bg-purple-600",o[0]==="noir"),c&1&&q(i,"bg-orange-500",o[0]==="library"),c&1&&q(i,"bg-green-400",o[0]==="zen"),c&1&&q(l,"bg-indigo-500",o[0]==="noir"),c&1&&q(l,"bg-yellow-600",o[0]==="library"),c&1&&q(l,"bg-teal-400",o[0]==="zen"),c&2&&q(t,"opacity-40",o[1]),c&2&&q(t,"opacity-0",!o[1])},i:ts,o:ts,d(o){o&&S(t)}}}function Gr(r,t,e){let{vibe:s="noir"}=t,{active:i=!1}=t;return r.$$set=n=>{"vibe"in n&&e(0,s=n.vibe),"active"in n&&e(1,i=n.active)},[s,i]}class zr extends ks{constructor(t){super(),xs(this,t,Gr,Hr,Es,{vibe:0,active:1})}}function ds(r,t,e){const s=r.slice();return s[30]=t[e],s}function ps(r,t,e){const s=r.slice();return s[33]=t[e],s}function Wr(r){let t,e=bs(r[1])+"",s,i,n,l="ENFOQUE";return{c(){t=P("div"),s=De(e),i=Q(),n=P("div"),n.textContent=l,this.h()},l(o){t=I(o,"DIV",{class:!0});var c=D(t);s=Le(c,e),c.forEach(S),i=V(o),n=I(o,"DIV",{class:!0,"data-svelte-h":!0}),he(n)!=="svelte-6disgl"&&(n.textContent=l),this.h()},h(){v(t,"class","font-mono text-5xl md:text-8xl font-light tracking-tighter text-white drop-shadow-lg tabular-nums select-none"),v(n,"class","text-slate-400 text-sm tracking-[0.2em] mt-2 md:mt-4 uppercase opacity-60 font-medium animate-pulse")},m(o,c){oe(o,t,c),b(t,s),oe(o,i,c),oe(o,n,c)},p(o,c){c[0]&2&&e!==(e=bs(o[1])+"")&&Bt(s,e)},d(o){o&&(S(t),S(i),S(n))}}}function Yr(r){let t,e,s,i,n,l="m",o,c,p="Click para editar",g,w;return{c(){t=P("div"),e=P("input"),i=Q(),n=P("span"),n.textContent=l,o=Q(),c=P("div"),c.textContent=p,this.h()},l(d){t=I(d,"DIV",{class:!0});var _=D(t);e=I(_,"INPUT",{type:!0,min:!0,max:!0,class:!0}),i=V(_),n=I(_,"SPAN",{class:!0,"data-svelte-h":!0}),he(n)!=="svelte-jnfkkk"&&(n.textContent=l),o=V(_),c=I(_,"DIV",{class:!0,"data-svelte-h":!0}),he(c)!=="svelte-1pqq2v0"&&(c.textContent=p),_.forEach(S),this.h()},h(){v(e,"type","number"),v(e,"min","1"),v(e,"max","180"),e.value=s=Math.floor(r[1]/60),v(e,"class","font-mono text-5xl md:text-8xl font-light tracking-tighter text-white bg-transparent text-center w-[1.5em] focus:outline-none focus:border-b-2 focus:border-white/20 appearance-none m-0 p-0 selection:bg-white/20 hover:scale-105 transition-transform cursor-pointer svelte-17v6fcc"),v(n,"class","text-2xl text-slate-500 font-medium absolute -right-6 top-2 md:top-8 md:-right-8 opacity-0 group-hover/input:opacity-100 transition-opacity"),v(c,"class","absolute -bottom-6 text-xs text-slate-500 opacity-0 group-hover/input:opacity-100 transition-opacity whitespace-nowrap"),v(t,"class","flex items-baseline justify-center relative group/input")},m(d,_){oe(d,t,_),b(t,e),b(t,i),b(t,n),b(t,o),b(t,c),g||(w=xe(e,"input",r[19]),g=!0)},p(d,_){_[0]&2&&s!==(s=Math.floor(d[1]/60))&&e.value!==s&&(e.value=s)},d(d){d&&S(t),g=!1,w()}}}function Zr(r){let t,e="INICIAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),he(t)!=="svelte-4l85vh"&&(t.textContent=e)},m(s,i){oe(s,t,i)},d(s){s&&S(t)}}}function Jr(r){let t,e="REANUDAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),he(t)!=="svelte-5mx2ci"&&(t.textContent=e)},m(s,i){oe(s,t,i)},d(s){s&&S(t)}}}function Xr(r){let t,e="PAUSAR";return{c(){t=P("span"),t.textContent=e},l(s){t=I(s,"SPAN",{"data-svelte-h":!0}),he(t)!=="svelte-164zjmm"&&(t.textContent=e)},m(s,i){oe(s,t,i)},d(s){s&&S(t)}}}function gs(r){let t,e,s,i="Biblioteca",n,l,o,c,p,g="âœ•",w,d,_,k,T=xt(is),O=[];for(let A=0;A<T.length;A+=1)O[A]=_s(ps(r,T,A));let F=xt(r[8]),$=[];for(let A=0;A<F.length;A+=1)$[A]=vs(ds(r,F,A));return{c(){t=P("div"),e=P("div"),s=P("h2"),s.textContent=i,n=Q(),l=P("div"),o=P("div");for(let A=0;A<O.length;A+=1)O[A].c();c=Q(),p=P("button"),p.textContent=g,w=Q(),d=P("div");for(let A=0;A<$.length;A+=1)$[A].c();this.h()},l(A){t=I(A,"DIV",{class:!0});var U=D(t);e=I(U,"DIV",{class:!0});var E=D(e);s=I(E,"H2",{class:!0,"data-svelte-h":!0}),he(s)!=="svelte-1kkkusu"&&(s.textContent=i),n=V(E),l=I(E,"DIV",{class:!0});var R=D(l);o=I(R,"DIV",{class:!0});var me=D(o);for(let te=0;te<O.length;te+=1)O[te].l(me);me.forEach(S),c=V(R),p=I(R,"BUTTON",{class:!0,"data-svelte-h":!0}),he(p)!=="svelte-5oitxt"&&(p.textContent=g),R.forEach(S),E.forEach(S),w=V(U),d=I(U,"DIV",{class:!0});var z=D(d);for(let te=0;te<$.length;te+=1)$[te].l(z);z.forEach(S),U.forEach(S),this.h()},h(){v(s,"class","text-3xl font-bold text-white"),v(o,"class","flex gap-2 overflow-x-auto pb-2 md:pb-0 no-scrollbar max-w-[200px] md:max-w-none"),v(p,"class","p-2 bg-white/10 rounded-full hover:bg-white/20 transition-colors shrink-0"),v(l,"class","flex items-center gap-4 w-full md:w-auto justify-between md:justify-end"),v(e,"class","flex justify-between items-center mb-8 shrink-0"),v(d,"class","grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 md:gap-6 overflow-y-auto pb-24 md:pb-20"),v(t,"class","absolute inset-0 z-[60] bg-black/80 backdrop-blur-xl animate-fade-in flex flex-col p-4 md:p-8 overflow-hidden")},m(A,U){oe(A,t,U),b(t,e),b(e,s),b(e,n),b(e,l),b(l,o);for(let E=0;E<O.length;E+=1)O[E]&&O[E].m(o,null);b(l,c),b(l,p),b(t,w),b(t,d);for(let E=0;E<$.length;E+=1)$[E]&&$[E].m(d,null);_||(k=xe(p,"click",r[13]),_=!0)},p(A,U){if(U[0]&4){T=xt(is);let E;for(E=0;E<T.length;E+=1){const R=ps(A,T,E);O[E]?O[E].p(R,U):(O[E]=_s(R),O[E].c(),O[E].m(o,null))}for(;E<O.length;E+=1)O[E].d(1);O.length=T.length}if(U[0]&16648){F=xt(A[8]);let E;for(E=0;E<F.length;E+=1){const R=ds(A,F,E);$[E]?$[E].p(R,U):($[E]=vs(R),$[E].c(),$[E].m(d,null))}for(;E<$.length;E+=1)$[E].d(1);$.length=F.length}},d(A){A&&S(t),ss(O,A),ss($,A),_=!1,k()}}}function _s(r){let t,e=r[33].label+"",s,i,n,l,o;function c(){return r[23](r[33])}return{c(){t=P("button"),s=De(e),i=Q(),this.h()},l(p){t=I(p,"BUTTON",{class:!0});var g=D(t);s=Le(g,e),i=V(g),g.forEach(S),this.h()},h(){v(t,"class",n="px-3 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap flex-shrink-0 "+(r[2]===r[33].id?"bg-white text-black":"bg-white/10 text-slate-400 hover:text-white"))},m(p,g){oe(p,t,g),b(t,s),b(t,i),l||(o=xe(t,"click",c),l=!0)},p(p,g){r=p,g[0]&4&&n!==(n="px-3 py-1 rounded-full text-xs font-medium transition-all whitespace-nowrap flex-shrink-0 "+(r[2]===r[33].id?"bg-white text-black":"bg-white/10 text-slate-400 hover:text-white"))&&v(t,"class",n)},d(p){p&&S(t),l=!1,o()}}}function ms(r){let t,e='<div class="flex gap-1 items-end h-8"><div class="w-1 bg-white animate-[bounce_1s_infinite] h-4"></div> <div class="w-1 bg-white animate-[bounce_1.2s_infinite] h-8"></div> <div class="w-1 bg-white animate-[bounce_0.8s_infinite] h-6"></div></div>';return{c(){t=P("div"),t.innerHTML=e,this.h()},l(s){t=I(s,"DIV",{class:!0,"data-svelte-h":!0}),he(t)!=="svelte-dsz2cq"&&(t.innerHTML=e),this.h()},h(){v(t,"class","absolute inset-0 bg-black/60 flex items-center justify-center backdrop-blur-sm")},m(s,i){oe(s,t,i)},d(s){s&&S(t)}}}function vs(r){let t,e,s,i,n=r[30].title+"",l,o,c,p=r[30].artist+"",g,w,d,_,k=r[3].currentAlbumId===r[30].id&&r[3].isPlaying&&ms();function T(){return r[24](r[30])}return{c(){t=P("button"),e=P("div"),k&&k.c(),s=Q(),i=P("h3"),l=De(n),o=Q(),c=P("p"),g=De(p),w=Q(),this.h()},l(O){t=I(O,"BUTTON",{class:!0});var F=D(t);e=I(F,"DIV",{class:!0,style:!0});var $=D(e);k&&k.l($),$.forEach(S),s=V(F),i=I(F,"H3",{class:!0});var A=D(i);l=Le(A,n),A.forEach(S),o=V(F),c=I(F,"P",{class:!0});var U=D(c);g=Le(U,p),U.forEach(S),w=V(F),F.forEach(S),this.h()},h(){v(e,"class","w-full aspect-square rounded-lg mb-4 bg-slate-800 bg-cover bg-center shadow-lg group-hover:scale-105 transition-transform relative overflow-hidden"),rs(e,"background-image","url('"+r[30].cover+"')"),v(i,"class","font-bold truncate text-white group-hover:text-purple-400 transition-colors"),v(c,"class","text-xs text-slate-400 truncate"),v(t,"class","group text-left p-4 rounded-xl hover:bg-white/5 transition-colors border border-transparent hover:border-white/5")},m(O,F){oe(O,t,F),b(t,e),k&&k.m(e,null),b(t,s),b(t,i),b(i,l),b(t,o),b(t,c),b(c,g),b(t,w),d||(_=xe(t,"click",T),d=!0)},p(O,F){r=O,r[3].currentAlbumId===r[30].id&&r[3].isPlaying?k||(k=ms(),k.c(),k.m(e,null)):k&&(k.d(1),k=null),F[0]&256&&rs(e,"background-image","url('"+r[30].cover+"')"),F[0]&256&&n!==(n=r[30].title+"")&&Bt(l,n),F[0]&256&&p!==(p=r[30].artist+"")&&Bt(g,p)},d(O){O&&S(t),k&&k.d(),d=!1,_()}}}function ei(r){let t,e,s,i,n,l,o,c,p,g='<span class="text-xl">â†</span> <span class="text-sm font-medium">Salir</span>',w,d,_='<div class="w-2 h-2 rounded-full bg-green-400 animate-pulse"></div> <span class="text-xs text-slate-300 font-mono tracking-wider">ZEN MODE</span>',k,T,O='<span class="text-xl">ðŸŽµ</span>',F,$,A,U,E,R,me,z,te,re,ae,Ce,Y,le,Se,K,ue,de,Re,Ke,st,Ee,Fe,je,He,qe,Ae,ve,rt='<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>',it,Te,ye,nt,Ge,ie,ot,pt;function at(L,j){return L[6]?Wr:Yr}let ze=at(r),ce=ze(r);function gt(L,j){return L[6]?Xr:L[1]<L[0]&&L[1]>0?Jr:Zr}let We=gt(r),pe=We(r);ye=new zr({});let Z=r[5]&&gs(r);return{c(){t=P("div"),e=P("div"),s=P("div"),i=Q(),n=P("div"),l=Q(),o=P("div"),c=P("header"),p=P("a"),p.innerHTML=g,w=Q(),d=P("div"),d.innerHTML=_,k=Q(),T=P("button"),T.innerHTML=O,F=Q(),$=P("main"),A=P("div"),U=Mt("svg"),E=Mt("circle"),R=Mt("circle"),me=Q(),z=P("div"),ce.c(),te=Q(),re=P("div"),ae=P("button"),pe.c(),Ce=Q(),Y=P("div"),le=P("button"),Se=De("25m"),ue=Q(),de=P("button"),Re=De("5m"),st=Q(),Ee=P("button"),Fe=De("15m"),He=Q(),qe=P("div"),Ae=Q(),ve=P("button"),ve.innerHTML=rt,it=Q(),Te=P("div"),nr(ye.$$.fragment),nt=Q(),Z&&Z.c(),Ge=De("\r\n```"),this.h()},l(L){t=I(L,"DIV",{class:!0});var j=D(t);e=I(j,"DIV",{class:!0});var Be=D(e);s=I(Be,"DIV",{class:!0}),D(s).forEach(S),i=V(Be),n=I(Be,"DIV",{class:!0}),D(n).forEach(S),Be.forEach(S),l=V(j),o=I(j,"DIV",{class:!0});var Ne=D(o);c=I(Ne,"HEADER",{class:!0});var Ie=D(c);p=I(Ie,"A",{href:!0,class:!0,"data-svelte-h":!0}),he(p)!=="svelte-z42cpc"&&(p.innerHTML=g),w=V(Ie),d=I(Ie,"DIV",{class:!0,"data-svelte-h":!0}),he(d)!=="svelte-m57vlv"&&(d.innerHTML=_),k=V(Ie),T=I(Ie,"BUTTON",{class:!0,"data-svelte-h":!0}),he(T)!=="svelte-1bqbxgv"&&(T.innerHTML=O),Ie.forEach(S),F=V(Ne),$=I(Ne,"MAIN",{class:!0});var Ye=D($);A=I(Ye,"DIV",{class:!0});var Ze=D(A);U=Pt(Ze,"svg",{class:!0,viewBox:!0});var lt=D(U);E=Pt(lt,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,class:!0}),D(E).forEach(S),R=Pt(lt,"circle",{cx:!0,cy:!0,r:!0,fill:!0,stroke:!0,"stroke-width":!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,class:!0}),D(R).forEach(S),lt.forEach(S),me=V(Ze),z=I(Ze,"DIV",{class:!0});var _t=D(z);ce.l(_t),_t.forEach(S),Ze.forEach(S),te=V(Ye),re=I(Ye,"DIV",{class:!0});var Je=D(re);ae=I(Je,"BUTTON",{class:!0});var mt=D(ae);pe.l(mt),mt.forEach(S),Ce=V(Je),Y=I(Je,"DIV",{class:!0});var ge=D(Y);le=I(ge,"BUTTON",{class:!0});var ct=D(le);Se=Le(ct,"25m"),ct.forEach(S),ue=V(ge),de=I(ge,"BUTTON",{class:!0});var vt=D(de);Re=Le(vt,"5m"),vt.forEach(S),st=V(ge),Ee=I(ge,"BUTTON",{class:!0});var bt=D(Ee);Fe=Le(bt,"15m"),bt.forEach(S),He=V(ge),qe=I(ge,"DIV",{class:!0}),D(qe).forEach(S),Ae=V(ge),ve=I(ge,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),he(ve)!=="svelte-jvwnse"&&(ve.innerHTML=rt),ge.forEach(S),Je.forEach(S),Ye.forEach(S),it=V(Ne),Te=I(Ne,"DIV",{class:!0});var wt=D(Te);ir(ye.$$.fragment,wt),wt.forEach(S),Ne.forEach(S),nt=V(j),Z&&Z.l(j),j.forEach(S),Ge=Le(L,"\r\n```"),this.h()},h(){v(s,"class","w-full h-full opacity-30 transform scale-110 transition-all duration-1000 ease-in-out filter blur-sm brightness-75 grayscale-[0.3]"),q(s,"blur-md",!r[6]),q(s,"blur-lg",r[6]),q(s,"scale-125",r[6]),v(n,"class","absolute inset-0 bg-radial-gradient from-transparent via-[#0B1120]/60 to-[#0B1120] pointer-events-none svelte-17v6fcc"),v(e,"class","absolute inset-0 z-0 pointer-events-none select-none overflow-hidden"),v(p,"href","/"),v(p,"class","flex items-center gap-2 opacity-50 hover:opacity-100 transition-opacity z-50 text-white"),v(d,"class","flex items-center gap-2 bg-white/5 backdrop-blur-md rounded-full px-4 py-2 border border-white/10 shadow-lg"),v(T,"class","p-2 opacity-50 hover:opacity-100 transition-opacity z-50 text-white"),v(c,"class","p-4 md:p-6 flex justify-between items-center animate-fade-in-down shrink-0"),v(E,"cx","50"),v(E,"cy","50"),v(E,"r","45"),v(E,"fill","none"),v(E,"stroke","currentColor"),v(E,"stroke-width","1.5"),v(E,"class","text-white/5"),v(R,"cx","50"),v(R,"cy","50"),v(R,"r","45"),v(R,"fill","none"),v(R,"stroke","currentColor"),v(R,"stroke-width","1.5"),v(R,"stroke-dasharray","283"),v(R,"stroke-dashoffset",r[9]),v(R,"stroke-linecap","round"),v(R,"class","text-white filter drop-shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-all duration-1000 ease-linear"),q(R,"text-green-400",r[6]),v(U,"class","w-auto h-auto max-w-[80vw] max-h-[40vh] md:max-h-[50vh] aspect-square transform -rotate-90 drop-shadow-2xl text-white"),v(U,"viewBox","0 0 100 100"),v(z,"class","absolute inset-0 flex flex-col items-center justify-center z-10"),v(A,"class","relative group flex items-center justify-center"),v(ae,"class","group relative px-8 py-4 md:px-10 md:py-5 bg-white text-black rounded-full font-bold tracking-[0.2em] hover:scale-105 transition-all shadow-[0_0_30px_rgba(255,255,255,0.1)] hover:shadow-[0_0_50px_rgba(255,255,255,0.4)] active:scale-95 flex items-center gap-3 z-50 text-sm md:text-base border border-transparent hover:border-white/50 w-full md:w-auto justify-center"),v(le,"class",K="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(r[7]==="focus"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-white hover:bg-white/5")),v(de,"class",Ke="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(r[7]==="short"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-white hover:bg-white/5")),v(Ee,"class",je="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(r[7]==="long"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-slate-300 hover:bg-white/5")),v(qe,"class","w-px h-6 bg-white/10 mx-1 shrink-0"),v(ve,"class","p-2 text-slate-500 hover:text-red-400 transition-colors rounded-full hover:bg-red-500/10 shrink-0"),v(ve,"title","Reiniciar"),v(Y,"class","flex items-center justify-center gap-2 md:gap-3 z-50 bg-black/20 backdrop-blur-sm p-1.5 md:p-2 rounded-2xl border border-white/5 w-auto max-w-full overflow-x-auto no-scrollbar"),v(re,"class","flex flex-col items-center gap-6 md:gap-8 animate-fade-in-up w-full max-w-md"),v($,"class","flex-1 flex flex-col items-center justify-evenly p-4 min-h-0"),v(Te,"class","h-24 w-full flex items-end justify-center pb-4 opacity-20 hover:opacity-100 transition-opacity"),v(o,"class","relative z-10 w-full h-full flex flex-col overflow-hidden"),v(t,"class","relative w-screen h-[100dvh] bg-[#0B1120] overflow-hidden flex flex-col text-white font-poppins selection:bg-purple-500/30")},m(L,j){oe(L,t,j),b(t,e),b(e,s),r[18](s),b(e,i),b(e,n),b(t,l),b(t,o),b(o,c),b(c,p),b(c,w),b(c,d),b(c,k),b(c,T),b(o,F),b(o,$),b($,A),b(A,U),b(U,E),b(U,R),b(A,me),b(A,z),ce.m(z,null),b($,te),b($,re),b(re,ae),pe.m(ae,null),b(re,Ce),b(re,Y),b(Y,le),b(le,Se),b(Y,ue),b(Y,de),b(de,Re),b(Y,st),b(Y,Ee),b(Ee,Fe),b(Y,He),b(Y,qe),b(Y,Ae),b(Y,ve),b(o,it),b(o,Te),rr(ye,Te,null),b(t,nt),Z&&Z.m(t,null),oe(L,Ge,j),ie=!0,ot||(pt=[xe(T,"click",r[13]),xe(ae,"click",r[11]),xe(le,"click",r[20]),xe(de,"click",r[21]),xe(Ee,"click",r[22]),xe(ve,"click",r[12])],ot=!0)},p(L,j){(!ie||j[0]&64)&&q(s,"blur-md",!L[6]),(!ie||j[0]&64)&&q(s,"blur-lg",L[6]),(!ie||j[0]&64)&&q(s,"scale-125",L[6]),(!ie||j[0]&512)&&v(R,"stroke-dashoffset",L[9]),(!ie||j[0]&64)&&q(R,"text-green-400",L[6]),ze===(ze=at(L))&&ce?ce.p(L,j):(ce.d(1),ce=ze(L),ce&&(ce.c(),ce.m(z,null))),We!==(We=gt(L))&&(pe.d(1),pe=We(L),pe&&(pe.c(),pe.m(ae,null))),(!ie||j[0]&128&&K!==(K="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(L[7]==="focus"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-white hover:bg-white/5")))&&v(le,"class",K),(!ie||j[0]&128&&Ke!==(Ke="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(L[7]==="short"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-white hover:bg-white/5")))&&v(de,"class",Ke),(!ie||j[0]&128&&je!==(je="px-3 py-1.5 md:px-4 md:py-2 rounded-lg text-[10px] md:text-xs font-bold uppercase tracking-wider transition-all whitespace-nowrap "+(L[7]==="long"?"bg-white text-black shadow-lg":"text-slate-500 hover:text-slate-300 hover:bg-white/5")))&&v(Ee,"class",je),L[5]?Z?Z.p(L,j):(Z=gs(L),Z.c(),Z.m(t,null)):Z&&(Z.d(1),Z=null)},i(L){ie||(sr(ye.$$.fragment,L),ie=!0)},o(L){tr(ye.$$.fragment,L),ie=!1},d(L){L&&(S(t),S(Ge)),r[18](null),ce.d(),pe.d(),er(ye),Z&&Z.d(),ot=!1,Ys(pt)}}}function bs(r){const t=Math.floor(r/60),e=r%60;return`${t.toString().padStart(2,"0")}:${e.toString().padStart(2,"0")}`}function ti(r,t,e){let s,i,n,l,o;Ot(r,$e,K=>e(16,n=K)),Ot(r,ys,K=>e(3,l=K)),Ot(r,pr,K=>e(17,o=K));let c,p,g=!1,w=!1,d=25*60,_=d,k,T="focus";function O(K){A(),e(7,T=K),K==="focus"&&e(0,d=25*60),K==="short"&&e(0,d=5*60),K==="long"&&e(0,d=15*60),e(1,_=d)}function F(){w?A():(ur(),$())}function $(){_<=0&&e(1,_=d),e(6,w=!0),k=setInterval(()=>{_>0?e(1,_--,_):E()},1e3)}function A(){e(6,w=!1),clearInterval(k)}function U(){A(),T==="focus"&&e(0,d=25*60),T==="short"&&e(0,d=5*60),T==="long"&&e(0,d=15*60),e(1,_=d)}function E(){A(),Tt(!0),setTimeout(()=>Tt(!0),500),setTimeout(()=>Tt(!0),1e3)}function R(){e(5,g=!g)}function me(K){dr(K),e(5,g=!1)}let z="all";Zs(async()=>{const{Chessboard:K,BORDER_TYPE:ue}=await Ws(async()=>{const{Chessboard:de,BORDER_TYPE:Re}=await import("../chunks/B02hmuqp.js");return{Chessboard:de,BORDER_TYPE:Re}},[],import.meta.url);e(15,p=new K(c,{position:n.fen,style:{cssClass:"default",showCoordinates:!1,borderType:ue.none},responsive:!0,animationDuration:800,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}})),n.history.length===0&&Ht()}),Js(()=>{p&&p.destroy(),A()});function te(K){Xs[K?"unshift":"push"](()=>{c=K,e(4,c)})}const re=K=>{const ue=parseInt(K.currentTarget.value);ue>0&&ue<=180&&(e(1,_=ue*60),e(0,d=_),e(7,T="custom"))},ae=()=>O("focus"),Ce=()=>O("short"),Y=()=>O("long"),le=K=>e(2,z=K.id),Se=K=>me(K.id);return r.$$.update=()=>{r.$$.dirty[0]&3&&e(9,s=(d-_)/d*283),r.$$.dirty[0]&131072&&(o.loading||o.user||or("/")),r.$$.dirty[0]&98304&&p&&n.fen&&p.setPosition(n.fen,!0),r.$$.dirty[0]&12&&e(8,i=z==="all"?l.availableAlbums:l.availableAlbums.filter(K=>K.category===z))},[d,_,z,l,c,g,w,T,i,s,O,F,U,R,me,p,n,o,te,re,ae,Ce,Y,le,Se]}class ui extends ks{constructor(t){super(),xs(this,t,ti,ei,Es,{},null,[-1,-1])}}export{ui as component};
