var rr=Object.defineProperty;var ir=(i,t,e)=>t in i?rr(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var U=(i,t,e)=>ir(i,typeof t!="symbol"?t+"":t,e);import{_ as nr}from"../chunks/C1FmrZbK.js";import{A as ar,O as $s,s as Ms,n as jt,d as A,B as or,i as Se,b as p,P as je,r as g,c as y,e as $,Q,g as O,h as x,j as D,R as lr,S as us,k as ks,v as As,y as cr,a as rt,T as Ks,u as ur,f as Ee,t as Ce,o as fr,U as hr}from"../chunks/Cj_gOvkl.js";import{S as Os,i as Ds,f as qs,d as Hs,t as ds,a as Gt,c as dr,m as zs,e as Ws,b as Ys,g as pr}from"../chunks/t-oyX_jB.js";import{w as _r}from"../chunks/J2oobD_V.js";import{a as Zs,s as gr,b as mr,u as vr,c as br}from"../chunks/BM9eA6VO.js";function Vs(i,{delay:t=0,duration:e=400,easing:s=ar}={}){const r=+getComputedStyle(i).opacity;return{delay:t,duration:e,easing:s,css:n=>`opacity: ${n*r}`}}function yr(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function xr(i,t,e,s,r){const n={move:i,variations:r};return t&&(n.suffix=t),e&&(n.nag=e),s!==null&&(n.comment=s),n}function Er(...i){const[t,...e]=i;let s=t;for(const r of e)r!==null&&(s.variations=[r,...r.variations],r.variations=[],s=r);return t}function Cr(i,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:i,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function wr(i,t){function e(){this.constructor=i}e.prototype=t.prototype,i.prototype=new e}function Pt(i,t,e,s){var r=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(r,Pt.prototype),r.expected=t,r.found=e,r.location=s,r.name="SyntaxError",r}wr(Pt,Error);function bs(i,t,e){return e=e||" ",i.length>t?i:(t-=i.length,e+=e.repeat(t),i+e.slice(0,t))}Pt.prototype.format=function(i){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<i.length;s++)if(i[s].source===this.location.source){e=i[s].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,o=this.location.source+":"+n.line+":"+n.column;if(e){var l=this.location.end,d=bs("",n.line.toString().length," "),h=e[r.line-1],v=r.line===l.line?l.column:h.length+1,E=v-r.column||1;t+=`
 --> `+o+`
`+d+` |
`+n.line+" | "+h+`
`+d+" | "+bs("",r.column-1," ")+bs("",E,"^")}else t+=`
 at `+o}return t};Pt.buildMessage=function(i,t){var e={literal:function(h){return'"'+r(h.text)+'"'},class:function(h){var v=h.parts.map(function(E){return Array.isArray(E)?n(E[0])+"-"+n(E[1]):n(E)});return"["+(h.inverted?"^":"")+v.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(h){return h.description}};function s(h){return h.charCodeAt(0).toString(16).toUpperCase()}function r(h){return h.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+s(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+s(v)})}function n(h){return h.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(v){return"\\x0"+s(v)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(v){return"\\x"+s(v)})}function o(h){return e[h.type](h)}function l(h){var v=h.map(o),E,_;if(v.sort(),v.length>0){for(E=1,_=1;E<v.length;E++)v[E-1]!==v[E]&&(v[_]=v[E],_++);v.length=_}switch(v.length){case 1:return v[0];case 2:return v[0]+" or "+v[1];default:return v.slice(0,-1).join(", ")+", or "+v[v.length-1]}}function d(h){return h?'"'+r(h)+'"':"end of input"}return"Expected "+l(i)+" but "+d(t)+" found."};function Sr(i,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,r={pgn:Et},n=Et,o="[",l='"',d="]",h=".",v="O-O-O",E="O-O",_="0-0-0",L="0-0",b="$",T="{",k="}",M=";",q="(",J=")",V="1-0",ee="0-1",oe="1/2-1/2",it="*",le=/^[a-zA-Z]/,ke=/^[^"]/,de=/^[0-9]/,ie=/^[.]/,pe=/^[a-zA-Z1-8\-=]/,ce=/^[+#]/,te=/^[!?]/,se=/^[^}]/,Me=/^[^\r\n]/,Oe=/^[ \t\r\n]/,B=he("tag pair"),z=F("[",!1),Ae=F('"',!1),nt=F("]",!1),ue=he("tag name"),_e=W([["a","z"],["A","Z"]],!1,!1),De=he("tag value"),Le=W(['"'],!0,!1),Pe=he("move number"),Ne=W([["0","9"]],!1,!1),He=F(".",!1),_t=W(["."],!1,!1),Ie=he("standard algebraic notation"),ze=F("O-O-O",!1),zt=F("O-O",!1),Nt=F("0-0-0",!1),We=F("0-0",!1),It=W([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),gt=W(["+","#"],!1,!1),Tt=he("suffix annotation"),Re=W(["!","?"],!1,!1),Ye=he("NAG"),Wt=F("$",!1),$t=he("brace comment"),Te=F("{",!1),$e=W(["}"],!0,!1),Yt=F("}",!1),Mt=he("rest of line comment"),ve=F(";",!1),ft=W(["\r",`
`],!0,!1),mt=he("variation"),Ot=F("(",!1),Ke=F(")",!1),Zt=he("game termination marker"),Dt=F("1-0",!1),be=F("0-1",!1),Ze=F("1/2-1/2",!1),Jt=F("*",!1),Lt=he("whitespace"),at=W([" ","	","\r",`
`],!1,!1),vt=function(a,c){return Cr(a,c)},bt=function(a){return Object.fromEntries(a)},Rt=function(a,c){return[a,c]},Fe=function(a,c){return{root:a,marker:c}},Be=function(a,c){return Er(yr(a),...c.flat())},Ue=function(a,c,f,w,S){return xr(a,c,f,w,S)},Je=function(a){return a},Xt=function(a){return a.replace(/[\r\n]+/g," ")},Kt=function(a){return a.trim()},Xe=function(a){return a},ht=function(a,c){return{result:a,comment:c}},u=t.peg$currPos|0,Ge=[{line:1,column:1}],fe=u,ne=t.peg$maxFailExpected||[],m=t.peg$silentFails|0,et;if(t.startRule){if(!(t.startRule in r))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');n=r[t.startRule]}function F(a,c){return{type:"literal",text:a,ignoreCase:c}}function W(a,c,f){return{type:"class",parts:a,inverted:c,ignoreCase:f}}function tt(){return{type:"end"}}function he(a){return{type:"other",description:a}}function yt(a){var c=Ge[a],f;if(c)return c;if(a>=Ge.length)f=Ge.length-1;else for(f=a;!Ge[--f];);for(c=Ge[f],c={line:c.line,column:c.column};f<a;)i.charCodeAt(f)===10?(c.line++,c.column=1):c.column++,f++;return Ge[a]=c,c}function Qe(a,c,f){var w=yt(a),S=yt(c),K={source:s,start:{offset:a,line:w.line,column:w.column},end:{offset:c,line:S.line,column:S.column}};return K}function C(a){u<fe||(u>fe&&(fe=u,ne=[]),ne.push(a))}function xt(a,c,f){return new Pt(Pt.buildMessage(a,c),a,c,f)}function Et(){var a,c,f;return a=u,c=qt(),f=Vt(),a=vt(c,f),a}function qt(){var a,c,f;for(a=u,c=[],f=ge();f!==e;)c.push(f),f=ge();return f=j(),a=bt(c),a}function ge(){var a,c,f,w,S,K,me;return m++,a=u,j(),i.charCodeAt(u)===91?(c=o,u++):(c=e,m===0&&C(z)),c!==e?(j(),f=Ct(),f!==e?(j(),i.charCodeAt(u)===34?(w=l,u++):(w=e,m===0&&C(Ae)),w!==e?(S=Y(),i.charCodeAt(u)===34?(K=l,u++):(K=e,m===0&&C(Ae)),K!==e?(j(),i.charCodeAt(u)===93?(me=d,u++):(me=e,m===0&&C(nt)),me!==e?a=Rt(f,S):(u=a,a=e)):(u=a,a=e)):(u=a,a=e)):(u=a,a=e)):(u=a,a=e),m--,a===e&&m===0&&C(B),a}function Ct(){var a,c,f;if(m++,a=u,c=[],f=i.charAt(u),le.test(f)?u++:(f=e,m===0&&C(_e)),f!==e)for(;f!==e;)c.push(f),f=i.charAt(u),le.test(f)?u++:(f=e,m===0&&C(_e));else c=e;return c!==e?a=i.substring(a,u):a=c,m--,a===e&&(c=e,m===0&&C(ue)),a}function Y(){var a,c,f;for(m++,a=u,c=[],f=i.charAt(u),ke.test(f)?u++:(f=e,m===0&&C(Le));f!==e;)c.push(f),f=i.charAt(u),ke.test(f)?u++:(f=e,m===0&&C(Le));return a=i.substring(a,u),m--,c=e,m===0&&C(De),a}function Vt(){var a,c,f;return a=u,c=Ft(),j(),f=St(),f===e&&(f=null),j(),a=Fe(c,f),a}function Ft(){var a,c,f,w;for(a=u,c=ot(),c===e&&(c=null),f=[],w=G();w!==e;)f.push(w),w=G();return a=Be(c,f),a}function G(){var a,c,f,w,S,K,me,st;if(a=u,j(),es(),j(),c=wt(),c!==e){for(f=ye(),f===e&&(f=null),w=[],S=Bt();S!==e;)w.push(S),S=Bt();for(S=j(),K=ot(),K===e&&(K=null),me=[],st=R();st!==e;)me.push(st),st=R();a=Ue(c,f,w,K,me)}else u=a,a=e;return a}function es(){var a,c,f,w,S,K;for(m++,a=u,c=[],f=i.charAt(u),de.test(f)?u++:(f=e,m===0&&C(Ne));f!==e;)c.push(f),f=i.charAt(u),de.test(f)?u++:(f=e,m===0&&C(Ne));if(i.charCodeAt(u)===46?(f=h,u++):(f=e,m===0&&C(He)),f!==e){for(w=j(),S=[],K=i.charAt(u),ie.test(K)?u++:(K=e,m===0&&C(_t));K!==e;)S.push(K),K=i.charAt(u),ie.test(K)?u++:(K=e,m===0&&C(_t));c=[c,f,w,S],a=c}else u=a,a=e;return m--,a===e&&(c=e,m===0&&C(Pe)),a}function wt(){var a,c,f,w,S,K;if(m++,a=u,c=u,i.substr(u,5)===v?(f=v,u+=5):(f=e,m===0&&C(ze)),f===e&&(i.substr(u,3)===E?(f=E,u+=3):(f=e,m===0&&C(zt)),f===e&&(i.substr(u,5)===_?(f=_,u+=5):(f=e,m===0&&C(Nt)),f===e&&(i.substr(u,3)===L?(f=L,u+=3):(f=e,m===0&&C(We)),f===e))))if(f=u,w=i.charAt(u),le.test(w)?u++:(w=e,m===0&&C(_e)),w!==e){if(S=[],K=i.charAt(u),pe.test(K)?u++:(K=e,m===0&&C(It)),K!==e)for(;K!==e;)S.push(K),K=i.charAt(u),pe.test(K)?u++:(K=e,m===0&&C(It));else S=e;S!==e?(w=[w,S],f=w):(u=f,f=e)}else u=f,f=e;return f!==e?(w=i.charAt(u),ce.test(w)?u++:(w=e,m===0&&C(gt)),w===e&&(w=null),f=[f,w],c=f):(u=c,c=e),c!==e?a=i.substring(a,u):a=c,m--,a===e&&(c=e,m===0&&C(Ie)),a}function ye(){var a,c,f;for(m++,a=u,c=[],f=i.charAt(u),te.test(f)?u++:(f=e,m===0&&C(Re));f!==e;)c.push(f),c.length>=2?f=e:(f=i.charAt(u),te.test(f)?u++:(f=e,m===0&&C(Re)));return c.length<1?(u=a,a=e):a=c,m--,a===e&&(c=e,m===0&&C(Tt)),a}function Bt(){var a,c,f,w,S;if(m++,a=u,j(),i.charCodeAt(u)===36?(c=b,u++):(c=e,m===0&&C(Wt)),c!==e){if(f=u,w=[],S=i.charAt(u),de.test(S)?u++:(S=e,m===0&&C(Ne)),S!==e)for(;S!==e;)w.push(S),S=i.charAt(u),de.test(S)?u++:(S=e,m===0&&C(Ne));else w=e;w!==e?f=i.substring(f,u):f=w,f!==e?a=Je(f):(u=a,a=e)}else u=a,a=e;return m--,a===e&&m===0&&C(Ye),a}function ot(){var a;return a=qe(),a===e&&(a=N()),a}function qe(){var a,c,f,w,S;if(m++,a=u,i.charCodeAt(u)===123?(c=T,u++):(c=e,m===0&&C(Te)),c!==e){for(f=u,w=[],S=i.charAt(u),se.test(S)?u++:(S=e,m===0&&C($e));S!==e;)w.push(S),S=i.charAt(u),se.test(S)?u++:(S=e,m===0&&C($e));f=i.substring(f,u),i.charCodeAt(u)===125?(w=k,u++):(w=e,m===0&&C(Yt)),w!==e?a=Xt(f):(u=a,a=e)}else u=a,a=e;return m--,a===e&&(c=e,m===0&&C($t)),a}function N(){var a,c,f,w,S;if(m++,a=u,i.charCodeAt(u)===59?(c=M,u++):(c=e,m===0&&C(ve)),c!==e){for(f=u,w=[],S=i.charAt(u),Me.test(S)?u++:(S=e,m===0&&C(ft));S!==e;)w.push(S),S=i.charAt(u),Me.test(S)?u++:(S=e,m===0&&C(ft));f=i.substring(f,u),a=Kt(f)}else u=a,a=e;return m--,a===e&&(c=e,m===0&&C(Mt)),a}function R(){var a,c,f,w;return m++,a=u,j(),i.charCodeAt(u)===40?(c=q,u++):(c=e,m===0&&C(Ot)),c!==e?(f=Ft(),f!==e?(j(),i.charCodeAt(u)===41?(w=J,u++):(w=e,m===0&&C(Ke)),w!==e?a=Xe(f):(u=a,a=e)):(u=a,a=e)):(u=a,a=e),m--,a===e&&m===0&&C(mt),a}function St(){var a,c,f;return m++,a=u,i.substr(u,3)===V?(c=V,u+=3):(c=e,m===0&&C(Dt)),c===e&&(i.substr(u,3)===ee?(c=ee,u+=3):(c=e,m===0&&C(be)),c===e&&(i.substr(u,7)===oe?(c=oe,u+=7):(c=e,m===0&&C(Ze)),c===e&&(i.charCodeAt(u)===42?(c=it,u++):(c=e,m===0&&C(Jt))))),c!==e?(j(),f=ot(),f===e&&(f=null),a=ht(c,f)):(u=a,a=e),m--,a===e&&(c=e,m===0&&C(Zt)),a}function j(){var a,c;for(m++,a=[],c=i.charAt(u),Oe.test(c)?u++:(c=e,m===0&&C(at));c!==e;)a.push(c),c=i.charAt(u),Oe.test(c)?u++:(c=e,m===0&&C(at));return m--,c=e,m===0&&C(Lt),a}if(et=n(),t.peg$library)return{peg$result:et,peg$currPos:u,peg$FAILED:e,peg$maxFailExpected:ne,peg$maxFailPos:fe};if(et!==e&&u===i.length)return et;throw et!==e&&u<i.length&&C(tt()),xt(ne,fe<i.length?i.charAt(fe):null,fe<i.length?Qe(fe,fe+1):Qe(fe,fe))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const ps=0xffffffffffffffffn;function ys(i,t){return(i<<t|i>>64n-t)&0xffffffffffffffffn}function Fs(i,t){return i*t&ps}function kr(i){return function(){let t=BigInt(i&ps),e=BigInt(i>>64n&ps);const s=Fs(ys(Fs(t,5n),7n),9n);return e^=t,t=(ys(t,24n)^e^e<<16n)&ps,e=ys(e,37n),i=e<<64n|t,s}}const gs=kr(0xa187eb39cdcaed8f31c4b365b102e01en),Ar=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>gs()))),Pr=Array.from({length:8},()=>gs()),Nr=Array.from({length:16},()=>gs()),xs=gs(),ae="w",xe="b",H="p",Ps="n",_s="b",Qt="r",ut="q",Z="k",Es="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class fs{constructor(t,e){U(this,"color");U(this,"from");U(this,"to");U(this,"piece");U(this,"captured");U(this,"promotion");U(this,"flags");U(this,"san");U(this,"lan");U(this,"before");U(this,"after");const{color:s,piece:r,from:n,to:o,flags:l,captured:d,promotion:h}=e,v=X(n),E=X(o);this.color=s,this.piece=r,this.from=v,this.to=E,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=v+E,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const _ in I)I[_]&l&&(this.flags+=dt[_]);d&&(this.captured=d),h&&(this.promotion=h,this.lan+=h)}isCapture(){return this.flags.indexOf(dt.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(dt.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(dt.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(dt.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(dt.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(dt.BIG_PAWN)>-1}}const re=-1,dt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},I={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Ns={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Ir={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Tr={...Ns,...Ir},P={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Cs={b:[16,32,17,15],w:[-16,-32,-17,-15]},Bs={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},$r=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Mr=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Or={p:1,n:2,b:4,r:8,q:16,k:32},Dr="pnbrqkPNBRQK",Us=[Ps,_s,Qt,ut],Lr=7,Rr=6,Kr=1,qr=0,hs={[Z]:I.KSIDE_CASTLE,[ut]:I.QSIDE_CASTLE},lt={w:[{square:P.a1,flag:I.QSIDE_CASTLE},{square:P.h1,flag:I.KSIDE_CASTLE}],b:[{square:P.a8,flag:I.QSIDE_CASTLE},{square:P.h8,flag:I.KSIDE_CASTLE}]},Vr={b:Kr,w:Rr},ws="--";function pt(i){return i>>4}function Ht(i){return i&15}function Js(i){return"0123456789".indexOf(i)!==-1}function X(i){const t=Ht(i),e=pt(i);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function Ut(i){return i===ae?xe:ae}function Fr(i){const t=i.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=t[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let l=0,d=!1;for(let h=0;h<r[o].length;h++)if(Js(r[o][h])){if(d)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(r[o][h],10),d=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][h]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,d=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:l}of n){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Br(i,t){const e=i.from,s=i.to,r=i.piece;let n=0,o=0,l=0;for(let d=0,h=t.length;d<h;d++){const v=t[d].from,E=t[d].to,_=t[d].piece;r===_&&e!==v&&s===E&&(n++,pt(e)===pt(v)&&o++,Ht(e)===Ht(v)&&l++)}return n>0?o>0&&l>0?X(e):l>0?X(e).charAt(1):X(e).charAt(0):""}function ct(i,t,e,s,r,n=void 0,o=I.NORMAL){const l=pt(s);if(r===H&&(l===Lr||l===qr))for(let d=0;d<Us.length;d++){const h=Us[d];i.push({color:t,from:e,to:s,piece:r,captured:n,promotion:h,flags:o|I.PROMOTION})}else i.push({color:t,from:e,to:s,piece:r,captured:n,flags:o})}function Gs(i){let t=i.charAt(0);return t>="a"&&t<="h"?i.match(/[a-h]\d.*[a-h]\d/)?void 0:H:(t=t.toLowerCase(),t==="o"?Z:t)}function Ss(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Xs{constructor(t=Es,{skipValidation:e=!1}={}){U(this,"_board",new Array(128));U(this,"_turn",ae);U(this,"_header",{});U(this,"_kings",{w:re,b:re});U(this,"_epSquare",-1);U(this,"_halfMoves",0);U(this,"_moveNumber",0);U(this,"_history",[]);U(this,"_comments",{});U(this,"_castling",{w:0,b:0});U(this,"_hash",0n);U(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:re,b:re},this._turn=ae,this._castling={w:0,b:0},this._epSquare=re,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Tr},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let r=t.split(/\s+/);if(r.length>=2&&r.length<6){const l=["-","-","0","1"];t=r.concat(l.slice(-(6-r.length))).join(" ")}if(r=t.split(/\s+/),!e){const{ok:l,error:d}=Fr(t);if(!l)throw new Error(d)}const n=r[0];let o=0;this.clear({preserveHeaders:s});for(let l=0;l<n.length;l++){const d=n.charAt(l);if(d==="/")o+=8;else if(Js(d))o+=parseInt(d,10);else{const h=d<"a"?ae:xe;this._put({type:d.toLowerCase(),color:h},X(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=I.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=I.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=I.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=I.QSIDE_CASTLE),this._epSquare=r[3]==="-"?re:P[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var o,l;let e=0,s="";for(let d=P.a8;d<=P.h1;d++){if(this._board[d]){e>0&&(s+=e,e=0);const{color:h,type:v}=this._board[d];s+=h===ae?v.toUpperCase():v.toLowerCase()}else e++;d+1&136&&(e>0&&(s+=e),d!==P.h1&&(s+="/"),e=0,d+=8)}let r="";this._castling[ae]&I.KSIDE_CASTLE&&(r+="K"),this._castling[ae]&I.QSIDE_CASTLE&&(r+="Q"),this._castling[xe]&I.KSIDE_CASTLE&&(r+="k"),this._castling[xe]&I.QSIDE_CASTLE&&(r+="q"),r=r||"-";let n="-";if(this._epSquare!==re)if(t)n=X(this._epSquare);else{const d=this._epSquare+(this._turn===ae?16:-16),h=[d+1,d-1];for(const v of h){if(v&136)continue;const E=this._turn;if(((o=this._board[v])==null?void 0:o.color)===E&&((l=this._board[v])==null?void 0:l.type)===H){this._makeMove({color:E,from:v,to:this._epSquare,piece:H,captured:H,flags:I.EP_CAPTURE});const _=!this._isKingAttacked(E);if(this._undoMove(),_){n=X(this._epSquare);break}}}}return[s,this._turn,r,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],r={w:0,b:1}[e],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Ar[r][n][t]}_epKey(){return this._epSquare===re?0n:Pr[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Nr[t]}_computeHash(){let t=0n;for(let e=P.a8;e<=P.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=xs),t}_updateSetup(t){this._history.length>0||(t!==Es?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Es)}get(t){return this._board[P[t]]}findPiece(t){var s;const e=[];for(let r=P.a8;r<=P.h1;r++){if(r&136){r+=7;continue}!this._board[r]||((s=this._board[r])==null?void 0:s.color)!==t.color||this._board[r].color===t.color&&this._board[r].type===t.type&&e.push(X(r))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Dr.indexOf(t.toLowerCase())===-1||!(s in P))return!1;const r=P[s];if(t==Z&&!(this._kings[e]==re||this._kings[e]==r))return!1;const n=this._board[r];return n&&n.type===Z&&(this._kings[n.color]=re),this._set(r,{type:t,color:e}),t===Z&&(this._kings[e]=r),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(P[t]),e&&e.type===Z&&(this._kings[e.color]=re),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var s,r,n,o,l,d,h,v,E,_,L,b;this._hash^=this._castlingKey();const t=((s=this._board[P.e1])==null?void 0:s.type)===Z&&((r=this._board[P.e1])==null?void 0:r.color)===ae,e=((n=this._board[P.e8])==null?void 0:n.type)===Z&&((o=this._board[P.e8])==null?void 0:o.color)===xe;(!t||((l=this._board[P.a1])==null?void 0:l.type)!==Qt||((d=this._board[P.a1])==null?void 0:d.color)!==ae)&&(this._castling.w&=-65),(!t||((h=this._board[P.h1])==null?void 0:h.type)!==Qt||((v=this._board[P.h1])==null?void 0:v.color)!==ae)&&(this._castling.w&=-33),(!e||((E=this._board[P.a8])==null?void 0:E.type)!==Qt||((_=this._board[P.a8])==null?void 0:_.color)!==xe)&&(this._castling.b&=-65),(!e||((L=this._board[P.h8])==null?void 0:L.type)!==Qt||((b=this._board[P.h8])==null?void 0:b.color)!==xe)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var n,o;if(this._epSquare===re)return;const t=this._epSquare+(this._turn===ae?-16:16),e=this._epSquare+(this._turn===ae?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((n=this._board[e])==null?void 0:n.color)!==Ut(this._turn)||((o=this._board[e])==null?void 0:o.type)!==H){this._hash^=this._epKey(),this._epSquare=re;return}const r=l=>{var d,h;return!(l&136)&&((d=this._board[l])==null?void 0:d.color)===this._turn&&((h=this._board[l])==null?void 0:h.type)===H};s.some(r)||(this._hash^=this._epKey(),this._epSquare=re)}_attacked(t,e,s){const r=[];for(let n=P.a8;n<=P.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==t)continue;const o=this._board[n],l=n-e;if(l===0)continue;const d=l+119;if($r[d]&Or[o.type]){if(o.type===H){if(l>0&&o.color===ae||l<=0&&o.color===xe)if(s)r.push(X(n));else return!0;continue}if(o.type==="n"||o.type==="k")if(s){r.push(X(n));continue}else return!0;const h=Mr[d];let v=n+h,E=!1;for(;v!==e;){if(this._board[v]!=null){E=!0;break}v+=h}if(!E)if(s){r.push(X(n));continue}else return!0}}return s?r:!1}attackers(t,e){return e?this._attacked(e,P[t],!0):this._attacked(this._turn,P[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(Ut(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,P[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,r=0;for(let n=P.a8;n<=P.h1;n++){if(r=(r+1)%2,n&136){n+=7;continue}const o=this._board[n];o&&(t[o.type]=o.type in t?t[o.type]+1:1,o.type===_s&&e.push(r),s++)}if(s===2)return!0;if(s===3&&(t[_s]===1||t[Ps]===1))return!0;if(s===t[_s]+2){let n=0;const o=e.length;for(let l=0;l<o;l++)n+=e[l];if(n===0||n===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const r=this._moves({square:e,piece:s});return t?r.map(n=>new fs(this,n)):r.map(n=>this._moveToSan(n,r))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){var L;const r=s?s.toLowerCase():void 0,n=e==null?void 0:e.toLowerCase(),o=[],l=this._turn,d=Ut(l);let h=P.a8,v=P.h1,E=!1;if(r)if(r in P)h=v=P[r],E=!0;else return[];for(let b=h;b<=v;b++){if(b&136){b+=7;continue}if(!this._board[b]||this._board[b].color===d)continue;const{type:T}=this._board[b];let k;if(T===H){if(n&&n!==T)continue;k=b+Cs[l][0],this._board[k]||(ct(o,l,b,k,H),k=b+Cs[l][1],Vr[l]===pt(b)&&!this._board[k]&&ct(o,l,b,k,H,void 0,I.BIG_PAWN));for(let M=2;M<4;M++)k=b+Cs[l][M],!(k&136)&&(((L=this._board[k])==null?void 0:L.color)===d?ct(o,l,b,k,H,this._board[k].type,I.CAPTURE):k===this._epSquare&&ct(o,l,b,k,H,H,I.EP_CAPTURE))}else{if(n&&n!==T)continue;for(let M=0,q=Bs[T].length;M<q;M++){const J=Bs[T][M];for(k=b;k+=J,!(k&136);){if(!this._board[k])ct(o,l,b,k,T);else{if(this._board[k].color===l)break;ct(o,l,b,k,T,this._board[k].type,I.CAPTURE);break}if(T===Ps||T===Z)break}}}}if((n===void 0||n===Z)&&(!E||v===this._kings[l])){if(this._castling[l]&I.KSIDE_CASTLE){const b=this._kings[l],T=b+2;!this._board[b+1]&&!this._board[T]&&!this._attacked(d,this._kings[l])&&!this._attacked(d,b+1)&&!this._attacked(d,T)&&ct(o,l,this._kings[l],T,Z,void 0,I.KSIDE_CASTLE)}if(this._castling[l]&I.QSIDE_CASTLE){const b=this._kings[l],T=b-2;!this._board[b-1]&&!this._board[b-2]&&!this._board[b-3]&&!this._attacked(d,this._kings[l])&&!this._attacked(d,b-1)&&!this._attacked(d,T)&&ct(o,l,this._kings[l],T,Z,void 0,I.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return o;const _=[];for(let b=0,T=o.length;b<T;b++)this._makeMove(o[b]),this._isKingAttacked(l)||_.push(o[b]),this._undoMove();return _}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(ws,e);else if(typeof t=="object"){const n=this._moves();for(let o=0,l=n.length;o<l;o++)if(t.from===X(n[o].from)&&t.to===X(n[o].to)&&(!("promotion"in n[o])||t.promotion===n[o].promotion)){s=n[o];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&I.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new fs(this,s);return this._makeMove(s),this._incPositionCount(),r}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){var r,n,o,l;const e=this._turn,s=Ut(e);if(this._push(t),t.flags&I.NULL_MOVE){e===xe&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=re;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&I.EP_CAPTURE&&(this._turn===xe?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===Z){if(this._kings[e]=t.to,t.flags&I.KSIDE_CASTLE){const d=t.to-1,h=t.to+1;this._movePiece(h,d)}else if(t.flags&I.QSIDE_CASTLE){const d=t.to+1,h=t.to-2;this._movePiece(h,d)}this._castling[e]=0}if(this._castling[e]){for(let d=0,h=lt[e].length;d<h;d++)if(t.from===lt[e][d].square&&this._castling[e]&lt[e][d].flag){this._castling[e]^=lt[e][d].flag;break}}if(this._castling[s]){for(let d=0,h=lt[s].length;d<h;d++)if(t.to===lt[s][d].square&&this._castling[s]&lt[s][d].flag){this._castling[s]^=lt[s][d].flag;break}}if(this._hash^=this._castlingKey(),t.flags&I.BIG_PAWN){let d;e===xe?d=t.to-16:d=t.to+16,!(t.to-1&136)&&((r=this._board[t.to-1])==null?void 0:r.type)===H&&((n=this._board[t.to-1])==null?void 0:n.color)===s||!(t.to+1&136)&&((o=this._board[t.to+1])==null?void 0:o.type)===H&&((l=this._board[t.to+1])==null?void 0:l.color)===s?(this._epSquare=d,this._hash^=this._epKey()):this._epSquare=re}else this._epSquare=re;t.piece===H?this._halfMoves=0:t.flags&(I.CAPTURE|I.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===xe&&this._moveNumber++,this._turn=s,this._hash^=xs}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new fs(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=xs;const s=this._turn,r=Ut(s);if(e.flags&I.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&I.EP_CAPTURE){let n;s===xe?n=e.to-16:n=e.to+16,this._set(n,{type:H,color:r})}else this._set(e.to,{type:e.captured,color:r});if(e.flags&(I.KSIDE_CASTLE|I.QSIDE_CASTLE)){let n,o;e.flags&I.KSIDE_CASTLE?(n=e.to+1,o=e.to-1):(n=e.to-2,o=e.to+1),this._movePiece(o,n)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let r=!1;for(const _ in this._header)this._header[_]&&s.push(`[${_} "${this._header[_]}"]`+t),r=!0;r&&this._history.length&&s.push(t);const n=_=>{const L=this._comments[this.fen()];if(typeof L<"u"){const b=_.length>0?" ":"";_=`${_}${b}{${L}}`}return _},o=[];for(;this._history.length>0;)o.push(this._undoMove());const l=[];let d="";for(o.length===0&&l.push(n(""));o.length>0;){d=n(d);const _=o.pop();if(!_)break;if(!this._history.length&&_.color==="b"){const L=`${this._moveNumber}. ...`;d=d?`${d} ${L}`:L}else _.color==="w"&&(d.length&&l.push(d),d=this._moveNumber+".");d=d+" "+this._moveToSan(_,this._moves({legal:!0})),this._makeMove(_)}if(d.length&&l.push(n(d)),l.push(this._header.Result||"*"),e===0)return s.join("")+l.join(" ");const h=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},v=function(_,L){for(const b of L.split(" "))if(b){if(_+b.length>e){for(;h();)_--;s.push(t),_=0}s.push(b),_+=b.length,s.push(" "),_++}return h()&&_--,_};let E=0;for(let _=0;_<l.length;_++){if(E+l[_].length>e&&l[_].includes("{")){E=v(E,l[_]);continue}E+l[_].length>e&&_!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),E=0):_!==0&&(s.push(" "),E++),s.push(l[_]),E+=l[_].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??Ns[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Ns[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const r=Sr(t);this.reset();const n=r.headers;let o="";for(const h in n)h.toLowerCase()==="fen"&&(o=n[h]),this.header(h,n[h]);if(!e)o&&this.load(o,{preserveHeaders:!0});else if(n.SetUp==="1"){if(!("FEN"in n))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}let l=r.root;for(;l;){if(l.move){const h=this._moveFromSan(l.move,e);if(h==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(h),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const d=r.result;d&&Object.keys(this._header).length&&this._header.Result!==d&&this.setHeader("Result",d)}_moveToSan(t,e){let s="";if(t.flags&I.KSIDE_CASTLE)s="O-O";else if(t.flags&I.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&I.NULL_MOVE)return ws;if(t.piece!==H){const r=Br(t,e);s+=t.piece.toUpperCase()+r}t.flags&(I.CAPTURE|I.EP_CAPTURE)&&(t.piece===H&&(s+=X(t.from)[0]),s+="x"),s+=X(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=Ss(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==ws)return{color:this._turn,from:0,to:0,piece:"k",flags:I.NULL_MOVE};let r=Gs(s),n=this._moves({legal:!0,piece:r});for(let _=0,L=n.length;_<L;_++)if(s===Ss(this._moveToSan(n[_],n)))return n[_];if(e)return null;let o,l,d,h,v,E=!1;if(l=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(o=l[1],d=l[2],h=l[3],v=l[4],d.length==1&&(E=!0)):(l=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(o=l[1],d=l[2],h=l[3],v=l[4],d.length==1&&(E=!0))),r=Gs(s),n=this._moves({legal:!0,piece:o||r}),!h)return null;for(let _=0,L=n.length;_<L;_++)if(d){if((!o||o.toLowerCase()==n[_].piece)&&P[d]==n[_].from&&P[h]==n[_].to&&(!v||v.toLowerCase()==n[_].promotion))return n[_];if(E){const b=X(n[_].from);if((!o||o.toLowerCase()==n[_].piece)&&P[h]==n[_].to&&(d==b[0]||d==b[1])&&(!v||v.toLowerCase()==n[_].promotion))return n[_]}}else if(s===Ss(this._moveToSan(n[_],n)).replace("x",""))return n[_];return null}ascii(){let t=`   +------------------------+
`;for(let e=P.a8;e<=P.h1;e++){if(Ht(e)===0&&(t+=" "+"87654321"[pt(e)]+" |"),this._board[e]){const s=this._board[e].type,n=this._board[e].color===ae?s.toUpperCase():s.toLowerCase();t+=" "+n+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const r=this._turn;for(let n=0,o=e.length;n<o;n++)this._makeMove(e[n]),this._isKingAttacked(r)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=P.a8;s<=P.h1;s++)this._board[s]==null?e.push(null):e.push({square:X(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in P){const e=P[t];return(pt(e)+Ht(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const r=e.pop();if(!r)break;t?s.push(new fs(this,r)):s.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=r=>{r in this._comments&&(e[r]=this._comments[r])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const r=t.pop();if(!r)break;this._makeMove(r),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const r of[Z,ut])e[r]!==void 0&&(e[r]?this._castling[t]|=hs[r]:this._castling[t]&=~hs[r]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[Z]===void 0||e[Z]===s[Z])&&(e[ut]===void 0||e[ut]===s[ut])}getCastlingRights(t){return{[Z]:(this._castling[t]&hs[Z])!==0,[ut]:(this._castling[t]&hs[ut])!==0}}moveNumber(){return this._moveNumber}}const Ur={id:"immortal",white:"Adolf Anderssen",black:"Lionel Kieseritzky",date:"1851",event:"London (friendly)",win:"white",description:"The Immortal Game - A romantic sacrifice masterpiece.",pgn:`[Event "London"]
[Site "London ENG"]
[Date "1851.06.21"]
[EventDate "1851.05.26"]
[Round "?"]
[Result "1-0"]
[White "Adolf Anderssen"]
[Black "Lionel Kieseritzky"]
[ECO "C33"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "45"]

1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5
9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6
16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8
22.Qf6+ Nxf6 23.Be7# 1-0`},Gr={id:"opera",white:"Paul Morphy",black:"Duke Karl / Count Isouard",date:"1858",event:"Paris Opera House",win:"white",description:"The Opera Game - Development over material.",pgn:`[Event "Paris"]
[Site "Paris FRA"]
[Date "1858.??.??"]
[EventDate "?"]
[Round "?"]
[Result "1-0"]
[White "Paul Morphy"]
[Black "Duke Karl / Count Isouard"]
[ECO "C41"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "33"]

1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3
c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6
15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0`},Is=[Ur,Gr];let we=new Xs,Ts=[];const Qr={fen:we.fen(),history:[we.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:Is[0],lastMove:null,isLoadingGame:!1},Ve=_r(Qr);let At=null;const jr=3e3;async function Ls(){var i;Ve.update(t=>({...t,isLoadingGame:!0}));try{const s=(await(await fetch("https://lichess.org/api/games/user/DrNykterstein?max=1&rated=true&perfType=blitz&opening=true&clocks=false&evals=false&pgnInJson=true",{headers:{Accept:"application/x-ndjson"}})).text()).trim().split(`
`),r=JSON.parse(s[0]),n={id:r.id,white:r.players.white.user.name,black:r.players.black.user.name,date:new Date(r.createdAt).getFullYear().toString(),event:`Lichess ${r.speed} ‚Ä¢ ${r.perf}`,win:r.winner==="white"?"white":r.winner==="black"?"black":"draw",description:`${((i=r.opening)==null?void 0:i.name)||"Classic Opening"}`,pgn:r.pgn};Qs(n)}catch(t){console.error("Failed to load Lichess game:",t),Qs(Is[Math.floor(Math.random()*Is.length)])}finally{Ve.update(t=>({...t,isLoadingGame:!1}))}}function Qs(i){sr(),we=new Xs;try{we.loadPgn(i.pgn),Ts=we.history(),we.reset(),Ve.set({fen:we.fen(),history:[we.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:i,lastMove:null,isLoadingGame:!1}),tr()}catch(t){console.error("Failed to load PGN",t)}}function er(){const i=$s(Ve);if(i.currentMoveIndex>=Ts.length-1){Ls();return}const t=i.currentMoveIndex+1,e=Ts[t],s=we.move(e);s&&Ve.update(r=>({...r,fen:we.fen(),currentMoveIndex:t,lastMove:s,history:[...r.history,we.fen()]}))}function Hr(){if($s(Ve).currentMoveIndex<0)return;we.undo()&&Ve.update(e=>{const s=e.history.slice(0,-1);return{...e,fen:we.fen(),currentMoveIndex:e.currentMoveIndex-1,lastMove:null,history:s}})}function zr(){$s(Ve).isPlaying?sr():tr()}function tr(){At&&clearInterval(At),Ve.update(i=>({...i,isPlaying:!0})),At=setInterval(()=>{er()},jr)}function sr(){At&&clearInterval(At),At=null,Ve.update(i=>({...i,isPlaying:!1}))}Ls();function Wr(i){let t,e,s,r="ChillChess",n,o,l="El Santuario Visual del Ajedrecista",d,h,v="Entrar al Santuario",E,_,L="<span>Recomendamos usar auriculares</span> <br/> <span>Click para activar la experiencia sonora</span>",b,T,k,M;return{c(){t=x("div"),e=x("div"),s=x("h1"),s.textContent=r,n=D(),o=x("p"),o.textContent=l,d=D(),h=x("button"),h.textContent=v,E=D(),_=x("p"),_.innerHTML=L,this.h()},l(q){t=y(q,"DIV",{class:!0});var J=$(t);e=y(J,"DIV",{class:!0});var V=$(e);s=y(V,"H1",{class:!0,"data-svelte-h":!0}),Q(s)!=="svelte-12mg5j8"&&(s.textContent=r),n=O(V),o=y(V,"P",{class:!0,"data-svelte-h":!0}),Q(o)!=="svelte-1qxucny"&&(o.textContent=l),d=O(V),h=y(V,"BUTTON",{class:!0,"data-svelte-h":!0}),Q(h)!=="svelte-1e93jub"&&(h.textContent=v),E=O(V),_=y(V,"P",{class:!0,"data-svelte-h":!0}),Q(_)!=="svelte-15qbzbi"&&(_.innerHTML=L),V.forEach(A),J.forEach(A),this.h()},h(){g(s,"class","h1 font-bold font-cinzel text-transparent bg-clip-text bg-gradient-to-br from-primary-400 to-tertiary-400"),g(o,"class","text-xl font-light opacity-80"),g(h,"class","btn variant-filled-primary rounded-full px-8 py-4 shadow-xl text-lg font-semibold hover:scale-105 transition-transform"),g(_,"class","text-xs opacity-50 space-y-1"),g(e,"class","text-center space-y-8 animate-pulse-slow svelte-1855xwc"),g(t,"class","fixed inset-0 z-50 flex items-center justify-center bg-surface-900/90 backdrop-blur-sm")},m(q,J){Se(q,t,J),p(t,e),p(e,s),p(e,n),p(e,o),p(e,d),p(e,h),p(e,E),p(e,_),T=!0,k||(M=je(h,"click",i[0]),k=!0)},p:jt,i(q){T||(q&&or(()=>{T&&(b||(b=qs(t,Vs,{},!0)),b.run(1))}),T=!0)},o(q){q&&(b||(b=qs(t,Vs,{},!1)),b.run(0)),T=!1},d(q){q&&A(t),q&&b&&b.end(),k=!1,M()}}}function Yr(i){const t=lr();function e(){t("start")}return[e]}class Zr extends Os{constructor(t){super(),Ds(this,t,Yr,Wr,Ms,{})}}function Jr(i){let t,e,s,r,n;return{c(){t=x("audio"),s=D(),r=x("audio"),this.h()},l(o){t=y(o,"AUDIO",{src:!0,preload:!0}),$(t).forEach(A),s=O(o),r=y(o,"AUDIO",{src:!0,preload:!0}),$(r).forEach(A),this.h()},h(){us(t.src,e=i[3].music[i[2].currentMusic])||g(t,"src",e),t.loop=!0,g(t,"preload","auto"),us(r.src,n=i[3].ambience[i[2].currentAmbience])||g(r,"src",n),r.loop=!0,g(r,"preload","auto")},m(o,l){Se(o,t,l),i[4](t),Se(o,s,l),Se(o,r,l),i[5](r)},p(o,[l]){l&4&&!us(t.src,e=o[3].music[o[2].currentMusic])&&g(t,"src",e),l&4&&!us(r.src,n=o[3].ambience[o[2].currentAmbience])&&g(r,"src",n)},i:jt,o:jt,d(o){o&&(A(t),A(s),A(r)),i[4](null),i[5](null)}}}function Xr(i,t,e){let s;ks(i,Zs,h=>e(2,s=h));const r={music:{lofi:"/assets/audio/music/lofi.mp3",jazz:"/assets/audio/music/jazz.mp3",piano:"/assets/audio/music/piano.mp3",flute:"/assets/audio/music/flute.mp3",none:""},ambience:{rain:"/assets/audio/ambience/rain.mp3",library:"/assets/audio/ambience/library.mp3",garden:"/assets/audio/ambience/garden.mp3",none:""}};let n,o;function l(h){As[h?"unshift":"push"](()=>{n=h,e(0,n),e(2,s)})}function d(h){As[h?"unshift":"push"](()=>{o=h,e(1,o),e(2,s)})}return i.$$.update=()=>{if(i.$$.dirty&5&&n){e(0,n.volume=s.isMuted?0:s.musicVolume,n);const h=r.music[s.currentMusic];n.src!==h&&h&&(e(0,n.src=h,n),s.isPlaying&&n.play().catch(console.error)),s.isPlaying&&s.currentMusic!=="none"&&n.paused?n.play().catch(console.error):(!s.isPlaying||s.currentMusic==="none")&&n.pause()}if(i.$$.dirty&6&&o){e(1,o.volume=s.isMuted?0:s.ambienceVolume,o);const h=r.ambience[s.currentAmbience];o.src!==h&&h&&(e(1,o.src=h,o),s.isPlaying&&o.play().catch(console.error)),s.isPlaying&&s.currentAmbience!=="none"&&o.paused?o.play().catch(console.error):(!s.isPlaying||s.currentAmbience==="none")&&o.pause()}},[n,o,s,r,l,d]}class ei extends Os{constructor(t){super(),Ds(this,t,Xr,Jr,Ms,{})}}function js(i){let t,e;return t=new Zr({}),t.$on("start",i[4]),{c(){Ys(t.$$.fragment)},l(s){Ws(t.$$.fragment,s)},m(s,r){zs(t,s,r),e=!0},p:jt,i(s){e||(Gt(t.$$.fragment,s),e=!0)},o(s){ds(t.$$.fragment,s),e=!1},d(s){Hs(t,s)}}}function ti(i){let t,e,s,r=i[0].currentGame.event+"",n,o,l,d=i[0].currentGame.date+"",h,v,E,_=i[0].currentGame.description+"",L,b,T,k,M,q="White",J,V,ee=i[0].currentGame.white+"",oe,it,le,ke="‚öîÔ∏è",de,ie,pe,ce="Black",te,se,Me=i[0].currentGame.black+"",Oe;return{c(){t=x("div"),e=x("div"),s=x("h2"),n=Ce(r),o=D(),l=x("span"),h=Ce(d),v=D(),E=x("p"),L=Ce(_),b=D(),T=x("div"),k=x("div"),M=x("p"),M.textContent=q,J=D(),V=x("p"),oe=Ce(ee),it=D(),le=x("div"),le.textContent=ke,de=D(),ie=x("div"),pe=x("p"),pe.textContent=ce,te=D(),se=x("p"),Oe=Ce(Me),this.h()},l(B){t=y(B,"DIV",{class:!0});var z=$(t);e=y(z,"DIV",{class:!0});var Ae=$(e);s=y(Ae,"H2",{class:!0});var nt=$(s);n=Ee(nt,r),nt.forEach(A),o=O(Ae),l=y(Ae,"SPAN",{class:!0});var ue=$(l);h=Ee(ue,d),ue.forEach(A),Ae.forEach(A),v=O(z),E=y(z,"P",{class:!0});var _e=$(E);L=Ee(_e,_),_e.forEach(A),z.forEach(A),b=O(B),T=y(B,"DIV",{class:!0});var De=$(T);k=y(De,"DIV",{class:!0});var Le=$(k);M=y(Le,"P",{class:!0,"data-svelte-h":!0}),Q(M)!=="svelte-zs45ez"&&(M.textContent=q),J=O(Le),V=y(Le,"P",{class:!0});var Pe=$(V);oe=Ee(Pe,ee),Pe.forEach(A),Le.forEach(A),it=O(De),le=y(De,"DIV",{class:!0,"data-svelte-h":!0}),Q(le)!=="svelte-mki9wq"&&(le.textContent=ke),de=O(De),ie=y(De,"DIV",{class:!0});var Ne=$(ie);pe=y(Ne,"P",{class:!0,"data-svelte-h":!0}),Q(pe)!=="svelte-1ylektp"&&(pe.textContent=ce),te=O(Ne),se=y(Ne,"P",{class:!0});var He=$(se);Oe=Ee(He,Me),He.forEach(A),Ne.forEach(A),De.forEach(A),this.h()},h(){g(s,"class","text-xl font-semibold text-primary-300 font-poppins leading-tight"),g(l,"class","text-xs px-3 py-1.5 bg-primary-500/20 text-primary-200 rounded-full whitespace-nowrap"),g(e,"class","flex items-start justify-between gap-3"),g(E,"class","text-sm text-tertiary-300 font-light"),g(t,"class","space-y-3"),g(M,"class","text-xs text-tertiary-400 mb-1.5 uppercase tracking-wide"),g(V,"class","text-base font-medium text-tertiary-100"),g(k,"class","text-center flex-1"),g(le,"class","text-primary-400 text-2xl px-4"),g(pe,"class","text-xs text-tertiary-400 mb-1.5 uppercase tracking-wide"),g(se,"class","text-base font-medium text-tertiary-100"),g(ie,"class","text-center flex-1"),g(T,"class","flex items-center justify-between pt-4 border-t border-tertiary-700/30")},m(B,z){Se(B,t,z),p(t,e),p(e,s),p(s,n),p(e,o),p(e,l),p(l,h),p(t,v),p(t,E),p(E,L),Se(B,b,z),Se(B,T,z),p(T,k),p(k,M),p(k,J),p(k,V),p(V,oe),p(T,it),p(T,le),p(T,de),p(T,ie),p(ie,pe),p(ie,te),p(ie,se),p(se,Oe)},p(B,z){z&1&&r!==(r=B[0].currentGame.event+"")&&rt(n,r),z&1&&d!==(d=B[0].currentGame.date+"")&&rt(h,d),z&1&&_!==(_=B[0].currentGame.description+"")&&rt(L,_),z&1&&ee!==(ee=B[0].currentGame.white+"")&&rt(oe,ee),z&1&&Me!==(Me=B[0].currentGame.black+"")&&rt(Oe,Me)},d(B){B&&(A(t),A(b),A(T))}}}function si(i){let t,e='<div class="h-5 bg-tertiary-700/30 rounded-2xl w-3/4 loading-shimmer"></div> <div class="h-4 bg-tertiary-700/30 rounded-2xl w-1/2 loading-shimmer"></div>';return{c(){t=x("div"),t.innerHTML=e,this.h()},l(s){t=y(s,"DIV",{class:!0,"data-svelte-h":!0}),Q(t)!=="svelte-gdnzo5"&&(t.innerHTML=e),this.h()},h(){g(t,"class","animate-pulse space-y-3")},m(s,r){Se(s,t,r)},p:jt,d(s){s&&A(t)}}}function ri(i){let t;return{c(){t=Ce("‚ñ∂Ô∏è")},l(e){t=Ee(e,"‚ñ∂Ô∏è")},m(e,s){Se(e,t,s)},d(e){e&&A(t)}}}function ii(i){let t;return{c(){t=Ce("‚è∏Ô∏è")},l(e){t=Ee(e,"‚è∏Ô∏è")},m(e,s){Se(e,t,s)},d(e){e&&A(t)}}}function ni(i){let t,e,s,r,n,o,l,d,h,v,E,_,L,b,T='<h1 class="text-6xl font-bold font-poppins bg-clip-text text-transparent bg-gradient-to-r from-primary-300 via-secondary-300 to-primary-400 drop-shadow-2xl">ChillChess</h1> <p class="text-base text-tertiary-200 mt-2 font-light tracking-widest">visual sanctuary</p>',k,M,q,J,V,ee,oe,it="Atmosphere",le,ke,de=i[3].activeVibe+"",ie,pe,ce,te,se,Me="üåßÔ∏è",Oe,B,z="Noir",Ae,nt,ue,_e,De="üìö",Le,Pe,Ne="Library",He,_t,Ie,ze,zt="üå∏",Nt,We,It="Zen",gt,Tt,Re,Ye,Wt="Playback",$t,Te,$e,Yt="‚èÆÔ∏è",Mt,ve,ft,mt,Ot,Ke,Zt="‚è≠Ô∏è",Dt,be,Ze,Jt="üîÑ",Lt,at=i[0].isLoadingGame?"Loading new game...":"New Random Game",vt,bt,Rt,Fe,Be,Ue,Je,Xt=`<span class="text-xl">üåßÔ∏è</span>
                        Ambience`,Kt,Xe,ht=Math.round(i[3].ambienceVolume*100)+"",u,Ge,fe,ne,m,et,F,W,tt,he=`<span class="text-xl">üéµ</span>
                        Music`,yt,Qe,C=Math.round(i[3].musicVolume*100)+"",xt,Et,qt,ge,Ct,Y,Vt,Ft,G=i[2]&&js(i);e=new ei({});function es(N,R){return N[0].isLoadingGame?si:ti}let wt=es(i),ye=wt(i);function Bt(N,R){return N[0].isPlaying?ii:ri}let ot=Bt(i),qe=ot(i);return{c(){G&&G.c(),t=D(),Ys(e.$$.fragment),s=D(),r=x("div"),n=x("div"),o=x("div"),l=x("div"),d=D(),h=x("div"),v=x("div"),E=D(),_=x("div"),L=D(),b=x("div"),b.innerHTML=T,k=D(),M=x("div"),q=x("div"),ye.c(),J=D(),V=x("div"),ee=x("div"),oe=x("p"),oe.textContent=it,le=D(),ke=x("span"),ie=Ce(de),pe=D(),ce=x("div"),te=x("button"),se=x("div"),se.textContent=Me,Oe=D(),B=x("div"),B.textContent=z,nt=D(),ue=x("button"),_e=x("div"),_e.textContent=De,Le=D(),Pe=x("div"),Pe.textContent=Ne,_t=D(),Ie=x("button"),ze=x("div"),ze.textContent=zt,Nt=D(),We=x("div"),We.textContent=It,Tt=D(),Re=x("div"),Ye=x("p"),Ye.textContent=Wt,$t=D(),Te=x("div"),$e=x("button"),$e.textContent=Yt,Mt=D(),ve=x("button"),qe.c(),Ot=D(),Ke=x("button"),Ke.textContent=Zt,Dt=D(),be=x("button"),Ze=x("span"),Ze.textContent=Jt,Lt=D(),vt=Ce(at),Rt=D(),Fe=x("div"),Be=x("div"),Ue=x("div"),Je=x("span"),Je.innerHTML=Xt,Kt=D(),Xe=x("span"),u=Ce(ht),Ge=Ce("%"),fe=D(),ne=x("input"),et=D(),F=x("div"),W=x("div"),tt=x("span"),tt.innerHTML=he,yt=D(),Qe=x("span"),xt=Ce(C),Et=Ce("%"),qt=D(),ge=x("input"),this.h()},l(N){G&&G.l(N),t=O(N),Ws(e.$$.fragment,N),s=O(N),r=y(N,"DIV",{class:!0});var R=$(r);n=y(R,"DIV",{class:!0});var St=$(n);o=y(St,"DIV",{class:!0});var j=$(o);l=y(j,"DIV",{class:!0}),$(l).forEach(A),d=O(j),h=y(j,"DIV",{class:!0});var a=$(h);v=y(a,"DIV",{class:!0,style:!0}),$(v).forEach(A),E=O(a),_=y(a,"DIV",{class:!0}),$(_).forEach(A),a.forEach(A),j.forEach(A),L=O(St),b=y(St,"DIV",{class:!0,"data-svelte-h":!0}),Q(b)!=="svelte-1nfd6xx"&&(b.innerHTML=T),St.forEach(A),k=O(R),M=y(R,"DIV",{class:!0});var c=$(M);q=y(c,"DIV",{class:!0});var f=$(q);ye.l(f),f.forEach(A),J=O(c),V=y(c,"DIV",{class:!0});var w=$(V);ee=y(w,"DIV",{class:!0});var S=$(ee);oe=y(S,"P",{class:!0,"data-svelte-h":!0}),Q(oe)!=="svelte-1afeg5u"&&(oe.textContent=it),le=O(S),ke=y(S,"SPAN",{class:!0});var K=$(ke);ie=Ee(K,de),K.forEach(A),S.forEach(A),pe=O(w),ce=y(w,"DIV",{class:!0});var me=$(ce);te=y(me,"BUTTON",{class:!0});var st=$(te);se=y(st,"DIV",{class:!0,"data-svelte-h":!0}),Q(se)!=="svelte-6qvkq"&&(se.textContent=Me),Oe=O(st),B=y(st,"DIV",{class:!0,"data-svelte-h":!0}),Q(B)!=="svelte-1t76eqq"&&(B.textContent=z),st.forEach(A),nt=O(me),ue=y(me,"BUTTON",{class:!0});var ts=$(ue);_e=y(ts,"DIV",{class:!0,"data-svelte-h":!0}),Q(_e)!=="svelte-1s3agov"&&(_e.textContent=De),Le=O(ts),Pe=y(ts,"DIV",{class:!0,"data-svelte-h":!0}),Q(Pe)!=="svelte-m0foih"&&(Pe.textContent=Ne),ts.forEach(A),_t=O(me),Ie=y(me,"BUTTON",{class:!0});var ss=$(Ie);ze=y(ss,"DIV",{class:!0,"data-svelte-h":!0}),Q(ze)!=="svelte-1mjxwxy"&&(ze.textContent=zt),Nt=O(ss),We=y(ss,"DIV",{class:!0,"data-svelte-h":!0}),Q(We)!=="svelte-1sez1a3"&&(We.textContent=It),ss.forEach(A),me.forEach(A),w.forEach(A),Tt=O(c),Re=y(c,"DIV",{class:!0});var rs=$(Re);Ye=y(rs,"P",{class:!0,"data-svelte-h":!0}),Q(Ye)!=="svelte-l3tn2z"&&(Ye.textContent=Wt),$t=O(rs),Te=y(rs,"DIV",{class:!0});var kt=$(Te);$e=y(kt,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Q($e)!=="svelte-aeyt23"&&($e.textContent=Yt),Mt=O(kt),ve=y(kt,"BUTTON",{class:!0,title:!0});var Rs=$(ve);qe.l(Rs),Rs.forEach(A),Ot=O(kt),Ke=y(kt,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Q(Ke)!=="svelte-rn8f7k"&&(Ke.textContent=Zt),kt.forEach(A),rs.forEach(A),Dt=O(c),be=y(c,"BUTTON",{class:!0});var is=$(be);Ze=y(is,"SPAN",{class:!0,"data-svelte-h":!0}),Q(Ze)!=="svelte-19glm38"&&(Ze.textContent=Jt),Lt=O(is),vt=Ee(is,at),is.forEach(A),Rt=O(c),Fe=y(c,"DIV",{class:!0});var ns=$(Fe);Be=y(ns,"DIV",{class:!0});var as=$(Be);Ue=y(as,"DIV",{class:!0});var os=$(Ue);Je=y(os,"SPAN",{class:!0,"data-svelte-h":!0}),Q(Je)!=="svelte-175ymv"&&(Je.innerHTML=Xt),Kt=O(os),Xe=y(os,"SPAN",{class:!0});var ms=$(Xe);u=Ee(ms,ht),Ge=Ee(ms,"%"),ms.forEach(A),os.forEach(A),fe=O(as),ne=y(as,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),as.forEach(A),et=O(ns),F=y(ns,"DIV",{class:!0});var ls=$(F);W=y(ls,"DIV",{class:!0});var cs=$(W);tt=y(cs,"SPAN",{class:!0,"data-svelte-h":!0}),Q(tt)!=="svelte-fmbx75"&&(tt.innerHTML=he),yt=O(cs),Qe=y(cs,"SPAN",{class:!0});var vs=$(Qe);xt=Ee(vs,C),Et=Ee(vs,"%"),vs.forEach(A),cs.forEach(A),qt=O(ls),ge=y(ls,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ls.forEach(A),ns.forEach(A),c.forEach(A),R.forEach(A),this.h()},h(){g(l,"class","absolute inset-0 bg-gradient-to-br from-primary-400/30 via-secondary-400/20 to-tertiary-400/30 blur-3xl -z-10 scale-110 animate-pulse"),g(v,"class","absolute inset-0 opacity-5 pointer-events-none"),ur(v,"background-image",`url('data:image/svg+xml,%3Csvg width="100" height="100" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="noise"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="4" /%3E%3C/filter%3E%3Crect width="100" height="100" filter="url(%23noise)" opacity="0.5"/%3E%3C/svg%3E');`),g(_,"class","w-full h-full board-container rounded-2xl overflow-hidden shadow-inner"),g(h,"class","glass-strong p-6 rounded-3xl shadow-2xl glow-warm h-full relative overflow-hidden"),g(o,"class","relative w-full max-w-[min(75vh,85vw)] aspect-square"),g(b,"class","absolute top-12 left-12"),g(n,"class","flex-1 flex items-center justify-center p-12 relative"),g(q,"class","glass p-8 rounded-3xl space-y-4 border border-primary-400/15 glow-soft"),g(oe,"class","text-sm font-medium text-primary-300 uppercase tracking-widest"),g(ke,"class","text-xs text-tertiary-400 capitalize"),g(ee,"class","flex items-center justify-between px-1"),g(se,"class","text-3xl mb-2"),g(B,"class","text-xs font-light"),g(te,"class",Ae="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(i[3].activeVibe==="noir"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")),g(_e,"class","text-3xl mb-2"),g(Pe,"class","text-xs font-light"),g(ue,"class",He="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(i[3].activeVibe==="library"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")),g(ze,"class","text-3xl mb-2"),g(We,"class","text-xs font-light"),g(Ie,"class",gt="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(i[3].activeVibe==="zen"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")),g(ce,"class","grid grid-cols-3 gap-3"),g(V,"class","space-y-4"),g(Ye,"class","text-sm font-medium text-primary-300 uppercase tracking-widest px-1"),g($e,"class","btn-premium w-14 h-14 rounded-2xl glass hover:glass-strong flex items-center justify-center text-2xl transition-all hover:scale-110 active:scale-95 text-tertiary-200"),g($e,"title","Previous Move"),g(ve,"class",ft="btn-premium w-20 h-20 rounded-3xl bg-gradient-to-br from-primary-500 to-secondary-500 hover:from-primary-400 hover:to-secondary-400 flex items-center justify-center text-3xl shadow-2xl transition-all hover:scale-110 active:scale-95 "+(i[0].isPlaying?"animate-breathe":"")),g(ve,"title",mt=i[0].isPlaying?"Pause":"Play"),g(Ke,"class","btn-premium w-14 h-14 rounded-2xl glass hover:glass-strong flex items-center justify-center text-2xl transition-all hover:scale-110 active:scale-95 text-tertiary-200"),g(Ke,"title","Next Move"),g(Te,"class","flex justify-center items-center gap-4"),g(Re,"class","space-y-4"),g(Ze,"class","mr-2 text-xl"),be.disabled=bt=i[0].isLoadingGame,g(be,"class","btn-premium w-full py-4 rounded-2xl glass hover:glass-strong text-base font-light text-tertiary-200 hover:text-primary-300 transition-all disabled:opacity-50 disabled:cursor-not-allowed"),g(Je,"class","text-tertiary-300 flex items-center gap-2 font-light"),g(Xe,"class","text-primary-400 font-mono text-sm tabular-nums"),g(Ue,"class","flex items-center justify-between text-sm px-1"),g(ne,"type","range"),g(ne,"min","0"),g(ne,"max","1"),g(ne,"step","0.01"),ne.value=m=i[3].ambienceVolume,g(ne,"class","w-full"),g(Be,"class","space-y-3"),g(tt,"class","text-tertiary-300 flex items-center gap-2 font-light"),g(Qe,"class","text-primary-400 font-mono text-sm tabular-nums"),g(W,"class","flex items-center justify-between text-sm px-1"),g(ge,"type","range"),g(ge,"min","0"),g(ge,"max","1"),g(ge,"step","0.01"),ge.value=Ct=i[3].musicVolume,g(ge,"class","w-full"),g(F,"class","space-y-3"),g(Fe,"class","space-y-6 mt-auto pt-6 border-t border-tertiary-700/20"),g(M,"class","w-full md:w-[420px] glass-strong border-l border-primary-400/10 p-10 flex flex-col gap-8 backdrop-blur-2xl z-20 shadow-2xl"),g(r,"class","h-full flex flex-col md:flex-row transition-opacity duration-1000"),Ks(r,"opacity-50",i[2])},m(N,R){G&&G.m(N,R),Se(N,t,R),zs(e,N,R),Se(N,s,R),Se(N,r,R),p(r,n),p(n,o),p(o,l),p(o,d),p(o,h),p(h,v),p(h,E),p(h,_),i[7](_),p(n,L),p(n,b),p(r,k),p(r,M),p(M,q),ye.m(q,null),p(M,J),p(M,V),p(V,ee),p(ee,oe),p(ee,le),p(ee,ke),p(ke,ie),p(V,pe),p(V,ce),p(ce,te),p(te,se),p(te,Oe),p(te,B),p(ce,nt),p(ce,ue),p(ue,_e),p(ue,Le),p(ue,Pe),p(ce,_t),p(ce,Ie),p(Ie,ze),p(Ie,Nt),p(Ie,We),p(M,Tt),p(M,Re),p(Re,Ye),p(Re,$t),p(Re,Te),p(Te,$e),p(Te,Mt),p(Te,ve),qe.m(ve,null),p(Te,Ot),p(Te,Ke),p(M,Dt),p(M,be),p(be,Ze),p(be,Lt),p(be,vt),p(M,Rt),p(M,Fe),p(Fe,Be),p(Be,Ue),p(Ue,Je),p(Ue,Kt),p(Ue,Xe),p(Xe,u),p(Xe,Ge),p(Be,fe),p(Be,ne),p(Fe,et),p(Fe,F),p(F,W),p(W,tt),p(W,yt),p(W,Qe),p(Qe,xt),p(Qe,Et),p(F,qt),p(F,ge),Y=!0,Vt||(Ft=[je(te,"click",i[8]),je(ue,"click",i[9]),je(Ie,"click",i[10]),je($e,"click",Hr),je(ve,"click",zr),je(Ke,"click",er),je(be,"click",Ls),je(ne,"input",i[11]),je(ge,"input",i[12])],Vt=!0)},p(N,[R]){N[2]?G?(G.p(N,R),R&4&&Gt(G,1)):(G=js(N),G.c(),Gt(G,1),G.m(t.parentNode,t)):G&&(pr(),ds(G,1,1,()=>{G=null}),dr()),wt===(wt=es(N))&&ye?ye.p(N,R):(ye.d(1),ye=wt(N),ye&&(ye.c(),ye.m(q,null))),(!Y||R&8)&&de!==(de=N[3].activeVibe+"")&&rt(ie,de),(!Y||R&8&&Ae!==(Ae="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(N[3].activeVibe==="noir"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")))&&g(te,"class",Ae),(!Y||R&8&&He!==(He="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(N[3].activeVibe==="library"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")))&&g(ue,"class",He),(!Y||R&8&&gt!==(gt="btn-premium px-5 py-5 rounded-2xl text-sm font-medium transition-all "+(N[3].activeVibe==="zen"?"bg-gradient-to-br from-primary-500 to-secondary-500 text-white shadow-xl glow-warm":"glass hover:glass-strong text-tertiary-300")))&&g(Ie,"class",gt),ot!==(ot=Bt(N))&&(qe.d(1),qe=ot(N),qe&&(qe.c(),qe.m(ve,null))),(!Y||R&1&&ft!==(ft="btn-premium w-20 h-20 rounded-3xl bg-gradient-to-br from-primary-500 to-secondary-500 hover:from-primary-400 hover:to-secondary-400 flex items-center justify-center text-3xl shadow-2xl transition-all hover:scale-110 active:scale-95 "+(N[0].isPlaying?"animate-breathe":"")))&&g(ve,"class",ft),(!Y||R&1&&mt!==(mt=N[0].isPlaying?"Pause":"Play"))&&g(ve,"title",mt),(!Y||R&1)&&at!==(at=N[0].isLoadingGame?"Loading new game...":"New Random Game")&&rt(vt,at),(!Y||R&1&&bt!==(bt=N[0].isLoadingGame))&&(be.disabled=bt),(!Y||R&8)&&ht!==(ht=Math.round(N[3].ambienceVolume*100)+"")&&rt(u,ht),(!Y||R&8&&m!==(m=N[3].ambienceVolume))&&(ne.value=m),(!Y||R&8)&&C!==(C=Math.round(N[3].musicVolume*100)+"")&&rt(xt,C),(!Y||R&8&&Ct!==(Ct=N[3].musicVolume))&&(ge.value=Ct),(!Y||R&4)&&Ks(r,"opacity-50",N[2])},i(N){Y||(Gt(G),Gt(e.$$.fragment,N),Y=!0)},o(N){ds(G),ds(e.$$.fragment,N),Y=!1},d(N){N&&(A(t),A(s),A(r)),G&&G.d(N),Hs(e,N),i[7](null),ye.d(),qe.d(),Vt=!1,cr(Ft)}}}function ai(i,t,e){let s,r;ks(i,Ve,k=>e(0,s=k)),ks(i,Zs,k=>e(3,r=k));let n,o,l=!0;function d(){e(2,l=!1),vr()}function h(k){br(k)}fr(async()=>{const{Chessboard:k,BORDER_TYPE:M}=await nr(async()=>{const{Chessboard:q,BORDER_TYPE:J}=await import("../chunks/B02hmuqp.js");return{Chessboard:q,BORDER_TYPE:J}},[],import.meta.url);e(6,o=new k(n,{position:s.fen,style:{cssClass:"default",showCoordinates:!0,borderType:M.none},responsive:!0,animationDuration:400,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}}))}),hr(()=>{o&&o.destroy()});function v(k){As[k?"unshift":"push"](()=>{n=k,e(1,n)})}const E=()=>h("noir"),_=()=>h("library"),L=()=>h("zen"),b=k=>gr(k.currentTarget.valueAsNumber),T=k=>mr(k.currentTarget.valueAsNumber);return i.$$.update=()=>{i.$$.dirty&65&&o&&s.fen&&o.setPosition(s.fen,!0)},[s,n,l,r,d,h,o,v,E,_,L,b,T]}class di extends Os{constructor(t){super(),Ds(this,t,ai,ni,Ms,{})}}export{di as component};
