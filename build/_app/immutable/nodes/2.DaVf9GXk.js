var ks=Object.defineProperty;var xs=(n,t,e)=>t in n?ks(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var w=(n,t,e)=>xs(n,typeof t!="symbol"?t+"":t,e);import{_ as Ps}from"../chunks/C1FmrZbK.js";import{g as Pt,s as $s,n as Dt,r as ws,c as Ns,o as Ts,d as Is,b as Os}from"../chunks/BTyoYWlv.js";import{S as Ms,i as Rs,d as F,s as We,w as N,a as $t,b as A,y as gt,c as I,e as V,g as te,z as Ye,f as be,h as O,j as se,t as Ee}from"../chunks/BFF_vkIo.js";import{w as Ks}from"../chunks/BM_tmHr3.js";function Ls(n){return n!==null?{comment:n,variations:[]}:{variations:[]}}function Ds(n,t,e,s,i){const a={move:n,variations:i};return t&&(a.suffix=t),e&&(a.nag=e),s!==null&&(a.comment=s),a}function qs(...n){const[t,...e]=n;let s=t;for(const i of e)i!==null&&(s.variations=[i,...i.variations],i.variations=[],s=i);return t}function Fs(n,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:n,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function Bs(n,t){function e(){this.constructor=n}e.prototype=t.prototype,n.prototype=new e}function Be(n,t,e,s){var i=Error.call(this,n);return Object.setPrototypeOf&&Object.setPrototypeOf(i,Be.prototype),i.expected=t,i.found=e,i.location=s,i.name="SyntaxError",i}Bs(Be,Error);function mt(n,t,e){return e=e||" ",n.length>t?n:(t-=n.length,e+=e.repeat(t),n+e.slice(0,t))}Be.prototype.format=function(n){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<n.length;s++)if(n[s].source===this.location.source){e=n[s].text.split(/\r\n|\n|\r/g);break}var i=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(i):i,h=this.location.source+":"+a.line+":"+a.column;if(e){var c=this.location.end,u=mt("",a.line.toString().length," "),p=e[i.line-1],d=i.line===c.line?c.column:p.length+1,v=d-i.column||1;t+=`
 --> `+h+`
`+u+` |
`+a.line+" | "+p+`
`+u+" | "+mt("",i.column-1," ")+mt("",v,"^")}else t+=`
 at `+h}return t};Be.buildMessage=function(n,t){var e={literal:function(p){return'"'+i(p.text)+'"'},class:function(p){var d=p.parts.map(function(v){return Array.isArray(v)?a(v[0])+"-"+a(v[1]):a(v)});return"["+(p.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function i(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function a(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function h(p){return e[p.type](p)}function c(p){var d=p.map(h),v,_;if(d.sort(),d.length>0){for(v=1,_=1;v<d.length;v++)d[v-1]!==d[v]&&(d[_]=d[v],_++);d.length=_}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function u(p){return p?'"'+i(p)+'"':"end of input"}return"Expected "+c(n)+" but "+u(t)+" found."};function Us(n,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,i={pgn:It},a=It,h="[",c='"',u="]",p=".",d="O-O-O",v="O-O",_="0-0-0",$="0-0",E="$",k="{",x="}",Q=";",fe="(",ye=")",ie="1-0",Ue="0-1",Ie="1/2-1/2",ce="*",oe=/^[a-zA-Z]/,Se=/^[^"]/,he=/^[0-9]/,Z=/^[.]/,ue=/^[a-zA-Z1-8\-=]/,Oe=/^[+#]/,Me=/^[!?]/,pe=/^[^}]/,Ae=/^[^\r\n]/,Re=/^[ \t\r\n]/,Ke=z("tag pair"),Qe=K("[",!1),j=K('"',!1),J=K("]",!1),Xe=z("tag name"),ke=ne([["a","z"],["A","Z"]],!1,!1),Y=z("tag value"),xe=ne(['"'],!0,!1),Ge=z("move number"),H=ne([["0","9"]],!1,!1),et=K(".",!1),Le=ne(["."],!1,!1),le=z("standard algebraic notation"),tt=K("O-O-O",!1),He=K("O-O",!1),st=K("0-0-0",!1),it=K("0-0",!1),Pe=ne([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),X=ne(["+","#"],!1,!1),R=z("suffix annotation"),D=ne(["!","?"],!1,!1),De=z("NAG"),rt=K("$",!1),re=z("brace comment"),_e=K("{",!1),je=ne(["}"],!0,!1),de=K("}",!1),nt=z("rest of line comment"),at=K(";",!1),$e=ne(["\r",`
`],!0,!1),ge=z("variation"),ot=K("(",!1),Yt=K(")",!1),zt=z("game termination marker"),Zt=K("1-0",!1),Jt=K("0-1",!1),Xt=K("1/2-1/2",!1),es=K("*",!1),ts=z("whitespace"),wt=ne([" ","	","\r",`
`],!1,!1),ss=function(r,l){return Fs(r,l)},is=function(r){return Object.fromEntries(r)},rs=function(r,l){return[r,l]},ns=function(r,l){return{root:r,marker:l}},as=function(r,l){return qs(Ls(r),...l.flat())},os=function(r,l,f,b,C){return Ds(r,l,f,b,C)},ls=function(r){return r},fs=function(r){return r.replace(/[\r\n]+/g," ")},cs=function(r){return r.trim()},hs=function(r){return r},us=function(r,l){return{result:r,comment:l}},o=t.peg$currPos|0,qe=[{line:1,column:1}],ee=o,lt=t.peg$maxFailExpected||[],g=t.peg$silentFails|0,Ve;if(t.startRule){if(!(t.startRule in i))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');a=i[t.startRule]}function K(r,l){return{type:"literal",text:r,ignoreCase:l}}function ne(r,l,f){return{type:"class",parts:r,inverted:l,ignoreCase:f}}function ps(){return{type:"end"}}function z(r){return{type:"other",description:r}}function Nt(r){var l=qe[r],f;if(l)return l;if(r>=qe.length)f=qe.length-1;else for(f=r;!qe[--f];);for(l=qe[f],l={line:l.line,column:l.column};f<r;)n.charCodeAt(f)===10?(l.line++,l.column=1):l.column++,f++;return qe[r]=l,l}function Tt(r,l,f){var b=Nt(r),C=Nt(l),P={source:s,start:{offset:r,line:b.line,column:b.column},end:{offset:l,line:C.line,column:C.column}};return P}function m(r){o<ee||(o>ee&&(ee=o,lt=[]),lt.push(r))}function _s(r,l,f){return new Be(Be.buildMessage(r,l),r,l,f)}function It(){var r,l,f;return r=o,l=ds(),f=vs(),r=ss(l,f),r}function ds(){var r,l,f;for(r=o,l=[],f=Ot();f!==e;)l.push(f),f=Ot();return f=G(),r=is(l),r}function Ot(){var r,l,f,b,C,P,we;return g++,r=o,G(),n.charCodeAt(o)===91?(l=h,o++):(l=e,g===0&&m(Qe)),l!==e?(G(),f=gs(),f!==e?(G(),n.charCodeAt(o)===34?(b=c,o++):(b=e,g===0&&m(j)),b!==e?(C=ms(),n.charCodeAt(o)===34?(P=c,o++):(P=e,g===0&&m(j)),P!==e?(G(),n.charCodeAt(o)===93?(we=u,o++):(we=e,g===0&&m(J)),we!==e?r=rs(f,C):(o=r,r=e)):(o=r,r=e)):(o=r,r=e)):(o=r,r=e)):(o=r,r=e),g--,r===e&&g===0&&m(Ke),r}function gs(){var r,l,f;if(g++,r=o,l=[],f=n.charAt(o),oe.test(f)?o++:(f=e,g===0&&m(ke)),f!==e)for(;f!==e;)l.push(f),f=n.charAt(o),oe.test(f)?o++:(f=e,g===0&&m(ke));else l=e;return l!==e?r=n.substring(r,o):r=l,g--,r===e&&(l=e,g===0&&m(Xe)),r}function ms(){var r,l,f;for(g++,r=o,l=[],f=n.charAt(o),Se.test(f)?o++:(f=e,g===0&&m(xe));f!==e;)l.push(f),f=n.charAt(o),Se.test(f)?o++:(f=e,g===0&&m(xe));return r=n.substring(r,o),g--,l=e,g===0&&m(Y),r}function vs(){var r,l,f;return r=o,l=Mt(),G(),f=As(),f===e&&(f=null),G(),r=ns(l,f),r}function Mt(){var r,l,f,b;for(r=o,l=dt(),l===e&&(l=null),f=[],b=Rt();b!==e;)f.push(b),b=Rt();return r=as(l,f),r}function Rt(){var r,l,f,b,C,P,we,ft;if(r=o,G(),bs(),G(),l=Es(),l!==e){for(f=Cs(),f===e&&(f=null),b=[],C=Kt();C!==e;)b.push(C),C=Kt();for(C=G(),P=dt(),P===e&&(P=null),we=[],ft=Lt();ft!==e;)we.push(ft),ft=Lt();r=os(l,f,b,P,we)}else o=r,r=e;return r}function bs(){var r,l,f,b,C,P;for(g++,r=o,l=[],f=n.charAt(o),he.test(f)?o++:(f=e,g===0&&m(H));f!==e;)l.push(f),f=n.charAt(o),he.test(f)?o++:(f=e,g===0&&m(H));if(n.charCodeAt(o)===46?(f=p,o++):(f=e,g===0&&m(et)),f!==e){for(b=G(),C=[],P=n.charAt(o),Z.test(P)?o++:(P=e,g===0&&m(Le));P!==e;)C.push(P),P=n.charAt(o),Z.test(P)?o++:(P=e,g===0&&m(Le));l=[l,f,b,C],r=l}else o=r,r=e;return g--,r===e&&(l=e,g===0&&m(Ge)),r}function Es(){var r,l,f,b,C,P;if(g++,r=o,l=o,n.substr(o,5)===d?(f=d,o+=5):(f=e,g===0&&m(tt)),f===e&&(n.substr(o,3)===v?(f=v,o+=3):(f=e,g===0&&m(He)),f===e&&(n.substr(o,5)===_?(f=_,o+=5):(f=e,g===0&&m(st)),f===e&&(n.substr(o,3)===$?(f=$,o+=3):(f=e,g===0&&m(it)),f===e))))if(f=o,b=n.charAt(o),oe.test(b)?o++:(b=e,g===0&&m(ke)),b!==e){if(C=[],P=n.charAt(o),ue.test(P)?o++:(P=e,g===0&&m(Pe)),P!==e)for(;P!==e;)C.push(P),P=n.charAt(o),ue.test(P)?o++:(P=e,g===0&&m(Pe));else C=e;C!==e?(b=[b,C],f=b):(o=f,f=e)}else o=f,f=e;return f!==e?(b=n.charAt(o),Oe.test(b)?o++:(b=e,g===0&&m(X)),b===e&&(b=null),f=[f,b],l=f):(o=l,l=e),l!==e?r=n.substring(r,o):r=l,g--,r===e&&(l=e,g===0&&m(le)),r}function Cs(){var r,l,f;for(g++,r=o,l=[],f=n.charAt(o),Me.test(f)?o++:(f=e,g===0&&m(D));f!==e;)l.push(f),l.length>=2?f=e:(f=n.charAt(o),Me.test(f)?o++:(f=e,g===0&&m(D)));return l.length<1?(o=r,r=e):r=l,g--,r===e&&(l=e,g===0&&m(R)),r}function Kt(){var r,l,f,b,C;if(g++,r=o,G(),n.charCodeAt(o)===36?(l=E,o++):(l=e,g===0&&m(rt)),l!==e){if(f=o,b=[],C=n.charAt(o),he.test(C)?o++:(C=e,g===0&&m(H)),C!==e)for(;C!==e;)b.push(C),C=n.charAt(o),he.test(C)?o++:(C=e,g===0&&m(H));else b=e;b!==e?f=n.substring(f,o):f=b,f!==e?r=ls(f):(o=r,r=e)}else o=r,r=e;return g--,r===e&&g===0&&m(De),r}function dt(){var r;return r=ys(),r===e&&(r=Ss()),r}function ys(){var r,l,f,b,C;if(g++,r=o,n.charCodeAt(o)===123?(l=k,o++):(l=e,g===0&&m(_e)),l!==e){for(f=o,b=[],C=n.charAt(o),pe.test(C)?o++:(C=e,g===0&&m(je));C!==e;)b.push(C),C=n.charAt(o),pe.test(C)?o++:(C=e,g===0&&m(je));f=n.substring(f,o),n.charCodeAt(o)===125?(b=x,o++):(b=e,g===0&&m(de)),b!==e?r=fs(f):(o=r,r=e)}else o=r,r=e;return g--,r===e&&(l=e,g===0&&m(re)),r}function Ss(){var r,l,f,b,C;if(g++,r=o,n.charCodeAt(o)===59?(l=Q,o++):(l=e,g===0&&m(at)),l!==e){for(f=o,b=[],C=n.charAt(o),Ae.test(C)?o++:(C=e,g===0&&m($e));C!==e;)b.push(C),C=n.charAt(o),Ae.test(C)?o++:(C=e,g===0&&m($e));f=n.substring(f,o),r=cs(f)}else o=r,r=e;return g--,r===e&&(l=e,g===0&&m(nt)),r}function Lt(){var r,l,f,b;return g++,r=o,G(),n.charCodeAt(o)===40?(l=fe,o++):(l=e,g===0&&m(ot)),l!==e?(f=Mt(),f!==e?(G(),n.charCodeAt(o)===41?(b=ye,o++):(b=e,g===0&&m(Yt)),b!==e?r=hs(f):(o=r,r=e)):(o=r,r=e)):(o=r,r=e),g--,r===e&&g===0&&m(ge),r}function As(){var r,l,f;return g++,r=o,n.substr(o,3)===ie?(l=ie,o+=3):(l=e,g===0&&m(Zt)),l===e&&(n.substr(o,3)===Ue?(l=Ue,o+=3):(l=e,g===0&&m(Jt)),l===e&&(n.substr(o,7)===Ie?(l=Ie,o+=7):(l=e,g===0&&m(Xt)),l===e&&(n.charCodeAt(o)===42?(l=ce,o++):(l=e,g===0&&m(es))))),l!==e?(G(),f=dt(),f===e&&(f=null),r=us(l,f)):(o=r,r=e),g--,r===e&&(l=e,g===0&&m(zt)),r}function G(){var r,l;for(g++,r=[],l=n.charAt(o),Re.test(l)?o++:(l=e,g===0&&m(wt));l!==e;)r.push(l),l=n.charAt(o),Re.test(l)?o++:(l=e,g===0&&m(wt));return g--,l=e,g===0&&m(ts),r}if(Ve=a(),t.peg$library)return{peg$result:Ve,peg$currPos:o,peg$FAILED:e,peg$maxFailExpected:lt,peg$maxFailPos:ee};if(Ve!==e&&o===n.length)return Ve;throw Ve!==e&&o<n.length&&m(ps()),_s(lt,ee<n.length?n.charAt(ee):null,ee<n.length?Tt(ee,ee+1):Tt(ee,ee))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const ut=0xffffffffffffffffn;function vt(n,t){return(n<<t|n>>64n-t)&0xffffffffffffffffn}function qt(n,t){return n*t&ut}function Qs(n){return function(){let t=BigInt(n&ut),e=BigInt(n>>64n&ut);const s=qt(vt(qt(t,5n),7n),9n);return e^=t,t=(vt(t,24n)^e^e<<16n)&ut,e=vt(e,37n),n=e<<64n|t,s}}const _t=Qs(0xa187eb39cdcaed8f31c4b365b102e01en),Gs=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>_t()))),Hs=Array.from({length:8},()=>_t()),js=Array.from({length:16},()=>_t()),bt=_t(),B="w",W="b",T="p",At="n",pt="b",Ze="r",Ce="q",M="k",Et="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class ct{constructor(t,e){w(this,"color");w(this,"from");w(this,"to");w(this,"piece");w(this,"captured");w(this,"promotion");w(this,"flags");w(this,"san");w(this,"lan");w(this,"before");w(this,"after");const{color:s,piece:i,from:a,to:h,flags:c,captured:u,promotion:p}=e,d=L(a),v=L(h);this.color=s,this.piece=i,this.from=d,this.to=v,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=d+v,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const _ in S)S[_]&c&&(this.flags+=Ne[_]);u&&(this.captured=u),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(Ne.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(Ne.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(Ne.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(Ne.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(Ne.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(Ne.BIG_PAWN)>-1}}const q=-1,Ne={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},S={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},kt={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Vs={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Ws={...kt,...Vs},y={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ct={b:[16,32,17,15],w:[-16,-32,-17,-15]},Ft={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Ys=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],zs=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Zs={p:1,n:2,b:4,r:8,q:16,k:32},Js="pnbrqkPNBRQK",Bt=[At,pt,Ze,Ce],Xs=7,ei=6,ti=1,si=0,ht={[M]:S.KSIDE_CASTLE,[Ce]:S.QSIDE_CASTLE},me={w:[{square:y.a1,flag:S.QSIDE_CASTLE},{square:y.h1,flag:S.KSIDE_CASTLE}],b:[{square:y.a8,flag:S.QSIDE_CASTLE},{square:y.h8,flag:S.KSIDE_CASTLE}]},ii={b:ti,w:ei},yt="--";function Te(n){return n>>4}function Je(n){return n&15}function Qt(n){return"0123456789".indexOf(n)!==-1}function L(n){const t=Je(n),e=Te(n);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function ze(n){return n===B?W:B}function ri(n){const t=n.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const i=t[0].split("/");if(i.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let h=0;h<i.length;h++){let c=0,u=!1;for(let p=0;p<i[h].length;p++)if(Qt(i[h][p])){if(u)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};c+=parseInt(i[h][p],10),u=!0}else{if(!/^[prnbqkPRNBQK]$/.test(i[h][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};c+=1,u=!1}if(c!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const a=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:h,regex:c}of a){if(!c.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${h} king`};if((t[0].match(c)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${h} kings`}}return Array.from(i[0]+i[7]).some(h=>h.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function ni(n,t){const e=n.from,s=n.to,i=n.piece;let a=0,h=0,c=0;for(let u=0,p=t.length;u<p;u++){const d=t[u].from,v=t[u].to,_=t[u].piece;i===_&&e!==d&&s===v&&(a++,Te(e)===Te(d)&&h++,Je(e)===Je(d)&&c++)}return a>0?h>0&&c>0?L(e):c>0?L(e).charAt(1):L(e).charAt(0):""}function ve(n,t,e,s,i,a=void 0,h=S.NORMAL){const c=Te(s);if(i===T&&(c===Xs||c===si))for(let u=0;u<Bt.length;u++){const p=Bt[u];n.push({color:t,from:e,to:s,piece:i,captured:a,promotion:p,flags:h|S.PROMOTION})}else n.push({color:t,from:e,to:s,piece:i,captured:a,flags:h})}function Ut(n){let t=n.charAt(0);return t>="a"&&t<="h"?n.match(/[a-h]\d.*[a-h]\d/)?void 0:T:(t=t.toLowerCase(),t==="o"?M:t)}function St(n){return n.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Gt{constructor(t=Et,{skipValidation:e=!1}={}){w(this,"_board",new Array(128));w(this,"_turn",B);w(this,"_header",{});w(this,"_kings",{w:q,b:q});w(this,"_epSquare",-1);w(this,"_halfMoves",0);w(this,"_moveNumber",0);w(this,"_history",[]);w(this,"_comments",{});w(this,"_castling",{w:0,b:0});w(this,"_hash",0n);w(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:q,b:q},this._turn=B,this._castling={w:0,b:0},this._epSquare=q,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Ws},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let i=t.split(/\s+/);if(i.length>=2&&i.length<6){const c=["-","-","0","1"];t=i.concat(c.slice(-(6-i.length))).join(" ")}if(i=t.split(/\s+/),!e){const{ok:c,error:u}=ri(t);if(!c)throw new Error(u)}const a=i[0];let h=0;this.clear({preserveHeaders:s});for(let c=0;c<a.length;c++){const u=a.charAt(c);if(u==="/")h+=8;else if(Qt(u))h+=parseInt(u,10);else{const p=u<"a"?B:W;this._put({type:u.toLowerCase(),color:p},L(h)),h++}}this._turn=i[1],i[2].indexOf("K")>-1&&(this._castling.w|=S.KSIDE_CASTLE),i[2].indexOf("Q")>-1&&(this._castling.w|=S.QSIDE_CASTLE),i[2].indexOf("k")>-1&&(this._castling.b|=S.KSIDE_CASTLE),i[2].indexOf("q")>-1&&(this._castling.b|=S.QSIDE_CASTLE),this._epSquare=i[3]==="-"?q:y[i[3]],this._halfMoves=parseInt(i[4],10),this._moveNumber=parseInt(i[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var h,c;let e=0,s="";for(let u=y.a8;u<=y.h1;u++){if(this._board[u]){e>0&&(s+=e,e=0);const{color:p,type:d}=this._board[u];s+=p===B?d.toUpperCase():d.toLowerCase()}else e++;u+1&136&&(e>0&&(s+=e),u!==y.h1&&(s+="/"),e=0,u+=8)}let i="";this._castling[B]&S.KSIDE_CASTLE&&(i+="K"),this._castling[B]&S.QSIDE_CASTLE&&(i+="Q"),this._castling[W]&S.KSIDE_CASTLE&&(i+="k"),this._castling[W]&S.QSIDE_CASTLE&&(i+="q"),i=i||"-";let a="-";if(this._epSquare!==q)if(t)a=L(this._epSquare);else{const u=this._epSquare+(this._turn===B?16:-16),p=[u+1,u-1];for(const d of p){if(d&136)continue;const v=this._turn;if(((h=this._board[d])==null?void 0:h.color)===v&&((c=this._board[d])==null?void 0:c.type)===T){this._makeMove({color:v,from:d,to:this._epSquare,piece:T,captured:T,flags:S.EP_CAPTURE});const _=!this._isKingAttacked(v);if(this._undoMove(),_){a=L(this._epSquare);break}}}}return[s,this._turn,i,a,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],i={w:0,b:1}[e],a={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Gs[i][a][t]}_epKey(){return this._epSquare===q?0n:Hs[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return js[t]}_computeHash(){let t=0n;for(let e=y.a8;e<=y.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=bt),t}_updateSetup(t){this._history.length>0||(t!==Et?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Et)}get(t){return this._board[y[t]]}findPiece(t){var s;const e=[];for(let i=y.a8;i<=y.h1;i++){if(i&136){i+=7;continue}!this._board[i]||((s=this._board[i])==null?void 0:s.color)!==t.color||this._board[i].color===t.color&&this._board[i].type===t.type&&e.push(L(i))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Js.indexOf(t.toLowerCase())===-1||!(s in y))return!1;const i=y[s];if(t==M&&!(this._kings[e]==q||this._kings[e]==i))return!1;const a=this._board[i];return a&&a.type===M&&(this._kings[a.color]=q),this._set(i,{type:t,color:e}),t===M&&(this._kings[e]=i),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(y[t]),e&&e.type===M&&(this._kings[e.color]=q),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var s,i,a,h,c,u,p,d,v,_,$,E;this._hash^=this._castlingKey();const t=((s=this._board[y.e1])==null?void 0:s.type)===M&&((i=this._board[y.e1])==null?void 0:i.color)===B,e=((a=this._board[y.e8])==null?void 0:a.type)===M&&((h=this._board[y.e8])==null?void 0:h.color)===W;(!t||((c=this._board[y.a1])==null?void 0:c.type)!==Ze||((u=this._board[y.a1])==null?void 0:u.color)!==B)&&(this._castling.w&=-65),(!t||((p=this._board[y.h1])==null?void 0:p.type)!==Ze||((d=this._board[y.h1])==null?void 0:d.color)!==B)&&(this._castling.w&=-33),(!e||((v=this._board[y.a8])==null?void 0:v.type)!==Ze||((_=this._board[y.a8])==null?void 0:_.color)!==W)&&(this._castling.b&=-65),(!e||(($=this._board[y.h8])==null?void 0:$.type)!==Ze||((E=this._board[y.h8])==null?void 0:E.color)!==W)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var a,h;if(this._epSquare===q)return;const t=this._epSquare+(this._turn===B?-16:16),e=this._epSquare+(this._turn===B?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((a=this._board[e])==null?void 0:a.color)!==ze(this._turn)||((h=this._board[e])==null?void 0:h.type)!==T){this._hash^=this._epKey(),this._epSquare=q;return}const i=c=>{var u,p;return!(c&136)&&((u=this._board[c])==null?void 0:u.color)===this._turn&&((p=this._board[c])==null?void 0:p.type)===T};s.some(i)||(this._hash^=this._epKey(),this._epSquare=q)}_attacked(t,e,s){const i=[];for(let a=y.a8;a<=y.h1;a++){if(a&136){a+=7;continue}if(this._board[a]===void 0||this._board[a].color!==t)continue;const h=this._board[a],c=a-e;if(c===0)continue;const u=c+119;if(Ys[u]&Zs[h.type]){if(h.type===T){if(c>0&&h.color===B||c<=0&&h.color===W)if(s)i.push(L(a));else return!0;continue}if(h.type==="n"||h.type==="k")if(s){i.push(L(a));continue}else return!0;const p=zs[u];let d=a+p,v=!1;for(;d!==e;){if(this._board[d]!=null){v=!0;break}d+=p}if(!v)if(s){i.push(L(a));continue}else return!0}}return s?i:!1}attackers(t,e){return e?this._attacked(e,y[t],!0):this._attacked(this._turn,y[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(ze(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,y[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,i=0;for(let a=y.a8;a<=y.h1;a++){if(i=(i+1)%2,a&136){a+=7;continue}const h=this._board[a];h&&(t[h.type]=h.type in t?t[h.type]+1:1,h.type===pt&&e.push(i),s++)}if(s===2)return!0;if(s===3&&(t[pt]===1||t[At]===1))return!0;if(s===t[pt]+2){let a=0;const h=e.length;for(let c=0;c<h;c++)a+=e[c];if(a===0||a===h)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const i=this._moves({square:e,piece:s});return t?i.map(a=>new ct(this,a)):i.map(a=>this._moveToSan(a,i))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){var $;const i=s?s.toLowerCase():void 0,a=e==null?void 0:e.toLowerCase(),h=[],c=this._turn,u=ze(c);let p=y.a8,d=y.h1,v=!1;if(i)if(i in y)p=d=y[i],v=!0;else return[];for(let E=p;E<=d;E++){if(E&136){E+=7;continue}if(!this._board[E]||this._board[E].color===u)continue;const{type:k}=this._board[E];let x;if(k===T){if(a&&a!==k)continue;x=E+Ct[c][0],this._board[x]||(ve(h,c,E,x,T),x=E+Ct[c][1],ii[c]===Te(E)&&!this._board[x]&&ve(h,c,E,x,T,void 0,S.BIG_PAWN));for(let Q=2;Q<4;Q++)x=E+Ct[c][Q],!(x&136)&&((($=this._board[x])==null?void 0:$.color)===u?ve(h,c,E,x,T,this._board[x].type,S.CAPTURE):x===this._epSquare&&ve(h,c,E,x,T,T,S.EP_CAPTURE))}else{if(a&&a!==k)continue;for(let Q=0,fe=Ft[k].length;Q<fe;Q++){const ye=Ft[k][Q];for(x=E;x+=ye,!(x&136);){if(!this._board[x])ve(h,c,E,x,k);else{if(this._board[x].color===c)break;ve(h,c,E,x,k,this._board[x].type,S.CAPTURE);break}if(k===At||k===M)break}}}}if((a===void 0||a===M)&&(!v||d===this._kings[c])){if(this._castling[c]&S.KSIDE_CASTLE){const E=this._kings[c],k=E+2;!this._board[E+1]&&!this._board[k]&&!this._attacked(u,this._kings[c])&&!this._attacked(u,E+1)&&!this._attacked(u,k)&&ve(h,c,this._kings[c],k,M,void 0,S.KSIDE_CASTLE)}if(this._castling[c]&S.QSIDE_CASTLE){const E=this._kings[c],k=E-2;!this._board[E-1]&&!this._board[E-2]&&!this._board[E-3]&&!this._attacked(u,this._kings[c])&&!this._attacked(u,E-1)&&!this._attacked(u,k)&&ve(h,c,this._kings[c],k,M,void 0,S.QSIDE_CASTLE)}}if(!t||this._kings[c]===-1)return h;const _=[];for(let E=0,k=h.length;E<k;E++)this._makeMove(h[E]),this._isKingAttacked(c)||_.push(h[E]),this._undoMove();return _}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(yt,e);else if(typeof t=="object"){const a=this._moves();for(let h=0,c=a.length;h<c;h++)if(t.from===L(a[h].from)&&t.to===L(a[h].to)&&(!("promotion"in a[h])||t.promotion===a[h].promotion)){s=a[h];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&S.NULL_MOVE)throw new Error("Null move not allowed when in check");const i=new ct(this,s);return this._makeMove(s),this._incPositionCount(),i}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){var i,a,h,c;const e=this._turn,s=ze(e);if(this._push(t),t.flags&S.NULL_MOVE){e===W&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=q;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&S.EP_CAPTURE&&(this._turn===W?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===M){if(this._kings[e]=t.to,t.flags&S.KSIDE_CASTLE){const u=t.to-1,p=t.to+1;this._movePiece(p,u)}else if(t.flags&S.QSIDE_CASTLE){const u=t.to+1,p=t.to-2;this._movePiece(p,u)}this._castling[e]=0}if(this._castling[e]){for(let u=0,p=me[e].length;u<p;u++)if(t.from===me[e][u].square&&this._castling[e]&me[e][u].flag){this._castling[e]^=me[e][u].flag;break}}if(this._castling[s]){for(let u=0,p=me[s].length;u<p;u++)if(t.to===me[s][u].square&&this._castling[s]&me[s][u].flag){this._castling[s]^=me[s][u].flag;break}}if(this._hash^=this._castlingKey(),t.flags&S.BIG_PAWN){let u;e===W?u=t.to-16:u=t.to+16,!(t.to-1&136)&&((i=this._board[t.to-1])==null?void 0:i.type)===T&&((a=this._board[t.to-1])==null?void 0:a.color)===s||!(t.to+1&136)&&((h=this._board[t.to+1])==null?void 0:h.type)===T&&((c=this._board[t.to+1])==null?void 0:c.color)===s?(this._epSquare=u,this._hash^=this._epKey()):this._epSquare=q}else this._epSquare=q;t.piece===T?this._halfMoves=0:t.flags&(S.CAPTURE|S.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===W&&this._moveNumber++,this._turn=s,this._hash^=bt}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new ct(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=bt;const s=this._turn,i=ze(s);if(e.flags&S.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&S.EP_CAPTURE){let a;s===W?a=e.to-16:a=e.to+16,this._set(a,{type:T,color:i})}else this._set(e.to,{type:e.captured,color:i});if(e.flags&(S.KSIDE_CASTLE|S.QSIDE_CASTLE)){let a,h;e.flags&S.KSIDE_CASTLE?(a=e.to+1,h=e.to-1):(a=e.to-2,h=e.to+1),this._movePiece(h,a)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let i=!1;for(const _ in this._header)this._header[_]&&s.push(`[${_} "${this._header[_]}"]`+t),i=!0;i&&this._history.length&&s.push(t);const a=_=>{const $=this._comments[this.fen()];if(typeof $<"u"){const E=_.length>0?" ":"";_=`${_}${E}{${$}}`}return _},h=[];for(;this._history.length>0;)h.push(this._undoMove());const c=[];let u="";for(h.length===0&&c.push(a(""));h.length>0;){u=a(u);const _=h.pop();if(!_)break;if(!this._history.length&&_.color==="b"){const $=`${this._moveNumber}. ...`;u=u?`${u} ${$}`:$}else _.color==="w"&&(u.length&&c.push(u),u=this._moveNumber+".");u=u+" "+this._moveToSan(_,this._moves({legal:!0})),this._makeMove(_)}if(u.length&&c.push(a(u)),c.push(this._header.Result||"*"),e===0)return s.join("")+c.join(" ");const p=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},d=function(_,$){for(const E of $.split(" "))if(E){if(_+E.length>e){for(;p();)_--;s.push(t),_=0}s.push(E),_+=E.length,s.push(" "),_++}return p()&&_--,_};let v=0;for(let _=0;_<c.length;_++){if(v+c[_].length>e&&c[_].includes("{")){v=d(v,c[_]);continue}v+c[_].length>e&&_!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),v=0):_!==0&&(s.push(" "),v++),s.push(c[_]),v+=c[_].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??kt[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=kt[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const i=Us(t);this.reset();const a=i.headers;let h="";for(const p in a)p.toLowerCase()==="fen"&&(h=a[p]),this.header(p,a[p]);if(!e)h&&this.load(h,{preserveHeaders:!0});else if(a.SetUp==="1"){if(!("FEN"in a))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(a.FEN,{preserveHeaders:!0})}let c=i.root;for(;c;){if(c.move){const p=this._moveFromSan(c.move,e);if(p==null)throw new Error(`Invalid move in PGN: ${c.move}`);this._makeMove(p),this._incPositionCount()}c.comment!==void 0&&(this._comments[this.fen()]=c.comment),c=c.variations[0]}const u=i.result;u&&Object.keys(this._header).length&&this._header.Result!==u&&this.setHeader("Result",u)}_moveToSan(t,e){let s="";if(t.flags&S.KSIDE_CASTLE)s="O-O";else if(t.flags&S.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&S.NULL_MOVE)return yt;if(t.piece!==T){const i=ni(t,e);s+=t.piece.toUpperCase()+i}t.flags&(S.CAPTURE|S.EP_CAPTURE)&&(t.piece===T&&(s+=L(t.from)[0]),s+="x"),s+=L(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=St(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==yt)return{color:this._turn,from:0,to:0,piece:"k",flags:S.NULL_MOVE};let i=Ut(s),a=this._moves({legal:!0,piece:i});for(let _=0,$=a.length;_<$;_++)if(s===St(this._moveToSan(a[_],a)))return a[_];if(e)return null;let h,c,u,p,d,v=!1;if(c=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),c?(h=c[1],u=c[2],p=c[3],d=c[4],u.length==1&&(v=!0)):(c=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),c&&(h=c[1],u=c[2],p=c[3],d=c[4],u.length==1&&(v=!0))),i=Ut(s),a=this._moves({legal:!0,piece:h||i}),!p)return null;for(let _=0,$=a.length;_<$;_++)if(u){if((!h||h.toLowerCase()==a[_].piece)&&y[u]==a[_].from&&y[p]==a[_].to&&(!d||d.toLowerCase()==a[_].promotion))return a[_];if(v){const E=L(a[_].from);if((!h||h.toLowerCase()==a[_].piece)&&y[p]==a[_].to&&(u==E[0]||u==E[1])&&(!d||d.toLowerCase()==a[_].promotion))return a[_]}}else if(s===St(this._moveToSan(a[_],a)).replace("x",""))return a[_];return null}ascii(){let t=`   +------------------------+
`;for(let e=y.a8;e<=y.h1;e++){if(Je(e)===0&&(t+=" "+"87654321"[Te(e)]+" |"),this._board[e]){const s=this._board[e].type,a=this._board[e].color===B?s.toUpperCase():s.toLowerCase();t+=" "+a+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const i=this._turn;for(let a=0,h=e.length;a<h;a++)this._makeMove(e[a]),this._isKingAttacked(i)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=y.a8;s<=y.h1;s++)this._board[s]==null?e.push(null):e.push({square:L(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in y){const e=y[t];return(Te(e)+Je(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const i=e.pop();if(!i)break;t?s.push(new ct(this,i)):s.push(this._moveToSan(i,this._moves())),this._makeMove(i)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=i=>{i in this._comments&&(e[i]=this._comments[i])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const i=t.pop();if(!i)break;this._makeMove(i),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const i of[M,Ce])e[i]!==void 0&&(e[i]?this._castling[t]|=ht[i]:this._castling[t]&=~ht[i]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[M]===void 0||e[M]===s[M])&&(e[Ce]===void 0||e[Ce]===s[Ce])}getCastlingRights(t){return{[M]:(this._castling[t]&ht[M])!==0,[Ce]:(this._castling[t]&ht[Ce])!==0}}moveNumber(){return this._moveNumber}}const ai={id:"immortal",white:"Adolf Anderssen",black:"Lionel Kieseritzky",date:"1851",event:"London (friendly)",win:"white",description:"The Immortal Game - A romantic sacrifice masterpiece.",pgn:`[Event "London"]
[Site "London ENG"]
[Date "1851.06.21"]
[EventDate "1851.05.26"]
[Round "?"]
[Result "1-0"]
[White "Adolf Anderssen"]
[Black "Lionel Kieseritzky"]
[ECO "C33"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "45"]

1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5
9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6
16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8
22.Qf6+ Nxf6 23.Be7# 1-0`},oi={id:"opera",white:"Paul Morphy",black:"Duke Karl / Count Isouard",date:"1858",event:"Paris Opera House",win:"white",description:"The Opera Game - Development over material.",pgn:`[Event "Paris"]
[Site "Paris FRA"]
[Date "1858.??.??"]
[EventDate "?"]
[Round "?"]
[Result "1-0"]
[White "Paul Morphy"]
[Black "Duke Karl / Count Isouard"]
[ECO "C41"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "33"]

1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3
c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6
15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0`},Ht=[ai,oi];let U=new Gt,xt=[];const li={fen:U.fen(),history:[U.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:Ht[0],lastMove:null},ae=Ks(li);let Fe=null;const fi=3e3;function ci(n){Wt(),U=new Gt;try{U.loadPgn(n.pgn),xt=U.history(),U.reset(),ae.set({fen:U.fen(),history:[U.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:n,lastMove:null}),Vt()}catch(t){console.error("Failed to load PGN",t)}}function jt(){const n=Pt(ae);if(n.currentMoveIndex>=xt.length-1){ui();return}const t=n.currentMoveIndex+1,e=xt[t],s=U.move(e);s&&ae.update(i=>({...i,fen:U.fen(),currentMoveIndex:t,lastMove:s,history:[...i.history,U.fen()]}))}function hi(){if(Pt(ae).currentMoveIndex<0)return;U.undo()&&ae.update(e=>{const s=e.history.slice(0,-1);return{...e,fen:U.fen(),currentMoveIndex:e.currentMoveIndex-1,lastMove:null,history:s}})}function ui(){U.reset(),ae.update(n=>({...n,fen:U.fen(),currentMoveIndex:-1,history:[U.fen()],lastMove:null}))}function pi(){Pt(ae).isPlaying?Wt():Vt()}function Vt(){Fe&&clearInterval(Fe),ae.update(n=>({...n,isPlaying:!0})),Fe=setInterval(()=>{jt()},fi)}function Wt(){Fe&&clearInterval(Fe),Fe=null,ae.update(n=>({...n,isPlaying:!1}))}ci(Ht[0]);function _i(n){let t;return{c(){t=Ee("▶️")},l(e){t=be(e,"▶️")},m(e,s){$t(e,t,s)},d(e){e&&F(t)}}}function di(n){let t;return{c(){t=Ee("⏸️")},l(e){t=be(e,"⏸️")},m(e,s){$t(e,t,s)},d(e){e&&F(t)}}}function gi(n){let t,e,s,i,a,h,c="ChillChess",u,p,d,v,_=n[0].currentGame.event+"",$,E,k,x,Q=n[0].currentGame.white+"",fe,ye,ie,Ue="vs",Ie,ce,oe=n[0].currentGame.black+"",Se,he,Z,ue=n[0].currentGame.date+"",Oe,Me,pe=n[0].currentGame.description+"",Ae,Re,Ke,Qe,j,J,Xe="⏮️",ke,Y,xe,Ge,H,et="⏭️",Le,le,tt='<div class="flex justify-between text-sm"><span>Rainy Cafe</span> <span class="opacity-50">Coming Phase 3</span></div> <input type="range" value="50" class="w-full h-1 bg-surface-600 rounded-lg appearance-none cursor-not-allowed opacity-50" disabled=""/>',He,st;function it(R,D){return R[0].isPlaying?di:_i}let Pe=it(n),X=Pe(n);return{c(){t=O("div"),e=O("div"),s=O("div"),i=O("div"),a=se(),h=O("h1"),h.textContent=c,u=se(),p=O("div"),d=O("div"),v=O("h2"),$=Ee(_),E=se(),k=O("div"),x=O("p"),fe=Ee(Q),ye=se(),ie=O("p"),ie.textContent=Ue,Ie=se(),ce=O("p"),Se=Ee(oe),he=se(),Z=O("p"),Oe=Ee(ue),Me=Ee(" • "),Ae=Ee(pe),Re=se(),Ke=O("hr"),Qe=se(),j=O("div"),J=O("button"),J.textContent=Xe,ke=se(),Y=O("button"),X.c(),Ge=se(),H=O("button"),H.textContent=et,Le=se(),le=O("div"),le.innerHTML=tt,this.h()},l(R){t=I(R,"DIV",{class:!0});var D=V(t);e=I(D,"DIV",{class:!0});var De=V(e);s=I(De,"DIV",{class:!0});var rt=V(s);i=I(rt,"DIV",{class:!0}),V(i).forEach(F),rt.forEach(F),a=te(De),h=I(De,"H1",{class:!0,"data-svelte-h":!0}),Ye(h)!=="svelte-1sqixea"&&(h.textContent=c),De.forEach(F),u=te(D),p=I(D,"DIV",{class:!0});var re=V(p);d=I(re,"DIV",{class:!0});var _e=V(d);v=I(_e,"H2",{class:!0});var je=V(v);$=be(je,_),je.forEach(F),E=te(_e),k=I(_e,"DIV",{class:!0});var de=V(k);x=I(de,"P",{class:!0});var nt=V(x);fe=be(nt,Q),nt.forEach(F),ye=te(de),ie=I(de,"P",{class:!0,"data-svelte-h":!0}),Ye(ie)!=="svelte-1mut9la"&&(ie.textContent=Ue),Ie=te(de),ce=I(de,"P",{class:!0});var at=V(ce);Se=be(at,oe),at.forEach(F),de.forEach(F),he=te(_e),Z=I(_e,"P",{class:!0});var $e=V(Z);Oe=be($e,ue),Me=be($e," • "),Ae=be($e,pe),$e.forEach(F),_e.forEach(F),Re=te(re),Ke=I(re,"HR",{class:!0}),Qe=te(re),j=I(re,"DIV",{class:!0});var ge=V(j);J=I(ge,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Ye(J)!=="svelte-63nhqc"&&(J.textContent=Xe),ke=te(ge),Y=I(ge,"BUTTON",{class:!0,title:!0});var ot=V(Y);X.l(ot),ot.forEach(F),Ge=te(ge),H=I(ge,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),Ye(H)!=="svelte-8p7c3"&&(H.textContent=et),ge.forEach(F),Le=te(re),le=I(re,"DIV",{class:!0,"data-svelte-h":!0}),Ye(le)!=="svelte-1o5w3da"&&(le.innerHTML=tt),re.forEach(F),D.forEach(F),this.h()},h(){N(i,"class","w-full h-full board-container"),N(s,"class","glass p-1 rounded-lg shadow-2xl glow-cyan w-full max-w-[80vh] aspect-square"),N(h,"class","absolute top-8 left-8 text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-400 to-secondary-400 opacity-90"),N(e,"class","flex-1 flex items-center justify-center p-4 relative"),N(v,"class","h2 font-bold text-primary-500"),N(x,"class","text-sm font-semibold"),N(ie,"class","text-xs opacity-50"),N(ce,"class","text-sm font-semibold"),N(k,"class","flex flex-col gap-1"),N(Z,"class","text-xs opacity-50 mt-2"),N(d,"class","text-center space-y-2"),N(Ke,"class","opacity-20"),N(J,"class","btn-icon variant-soft-surface hover:variant-filled-surface transition-all"),N(J,"title","Previous Move"),N(Y,"class","btn-icon variant-filled-primary shadow-lg scale-110 hover:scale-125 transition-all"),N(Y,"title",xe=n[0].isPlaying?"Pause":"Play"),N(H,"class","btn-icon variant-soft-surface hover:variant-filled-surface transition-all"),N(H,"title","Next Move"),N(j,"class","flex justify-center gap-4 text-2xl"),N(le,"class","space-y-4 mt-auto"),N(p,"class","w-full md:w-80 glass border-l border-surface-500/30 p-6 flex flex-col gap-6 backdrop-blur-xl z-20"),N(t,"class","h-full flex flex-col md:flex-row")},m(R,D){$t(R,t,D),A(t,e),A(e,s),A(s,i),n[3](i),A(e,a),A(e,h),A(t,u),A(t,p),A(p,d),A(d,v),A(v,$),A(d,E),A(d,k),A(k,x),A(x,fe),A(k,ye),A(k,ie),A(k,Ie),A(k,ce),A(ce,Se),A(d,he),A(d,Z),A(Z,Oe),A(Z,Me),A(Z,Ae),A(p,Re),A(p,Ke),A(p,Qe),A(p,j),A(j,J),A(j,ke),A(j,Y),X.m(Y,null),A(j,Ge),A(j,H),A(p,Le),A(p,le),He||(st=[gt(J,"click",hi),gt(Y,"click",pi),gt(H,"click",jt)],He=!0)},p(R,[D]){D&1&&_!==(_=R[0].currentGame.event+"")&&We($,_),D&1&&Q!==(Q=R[0].currentGame.white+"")&&We(fe,Q),D&1&&oe!==(oe=R[0].currentGame.black+"")&&We(Se,oe),D&1&&ue!==(ue=R[0].currentGame.date+"")&&We(Oe,ue),D&1&&pe!==(pe=R[0].currentGame.description+"")&&We(Ae,pe),Pe!==(Pe=it(R))&&(X.d(1),X=Pe(R),X&&(X.c(),X.m(Y,null))),D&1&&xe!==(xe=R[0].isPlaying?"Pause":"Play")&&N(Y,"title",xe)},i:Dt,o:Dt,d(R){R&&F(t),n[3](null),X.d(),He=!1,ws(st)}}}function mi(n,t,e){let s;Ns(n,ae,c=>e(0,s=c));let i,a;Ts(async()=>{const{Chessboard:c,BORDER_TYPE:u}=await Ps(async()=>{const{Chessboard:p,BORDER_TYPE:d}=await import("../chunks/B02hmuqp.js");return{Chessboard:p,BORDER_TYPE:d}},[],import.meta.url);e(2,a=new c(i,{position:s.fen,style:{cssClass:"default",showCoordinates:!1,borderType:u.thin},responsive:!0,animationDuration:300,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}}))}),Is(()=>{a&&a.destroy()});function h(c){Os[c?"unshift":"push"](()=>{i=c,e(1,i)})}return n.$$.update=()=>{n.$$.dirty&5&&a&&s.fen&&a.setPosition(s.fen,!0)},[s,i,a,h]}class Si extends Ms{constructor(t){super(),Rs(this,t,mi,gi,$s,{})}}export{Si as component};
