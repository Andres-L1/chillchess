var ar=Object.defineProperty;var or=(i,t,e)=>t in i?ar(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var B=(i,t,e)=>or(i,typeof t!="symbol"?t+"":t,e);import{_ as lr}from"../chunks/C1FmrZbK.js";import{A as cr,O as Os,s as Ds,n as Qt,d as N,B as ur,i as ye,b as p,P as je,r as m,c as y,e as $,Q as G,g as M,h as E,j as O,R as fr,S as hs,k as Ps,v as Ns,y as hr,a as tt,T as Fs,f as ve,t as be,o as dr,U as pr}from"../chunks/Cj_gOvkl.js";import{S as Ls,i as Rs,f as Bs,d as Ys,t as _s,a as Gt,c as _r,m as Zs,e as Js,b as Xs,g as mr}from"../chunks/t-oyX_jB.js";import{w as gr}from"../chunks/J2oobD_V.js";import{a as er,s as vr,b as br,u as xr,c as yr}from"../chunks/BM9eA6VO.js";function Us(i,{delay:t=0,duration:e=400,easing:s=cr}={}){const r=+getComputedStyle(i).opacity;return{delay:t,duration:e,easing:s,css:a=>`opacity: ${a*r}`}}function Er(i){return i!==null?{comment:i,variations:[]}:{variations:[]}}function Cr(i,t,e,s,r){const a={move:i,variations:r};return t&&(a.suffix=t),e&&(a.nag=e),s!==null&&(a.comment=s),a}function Sr(...i){const[t,...e]=i;let s=t;for(const r of e)r!==null&&(s.variations=[r,...r.variations],r.variations=[],s=r);return t}function kr(i,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:i,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function Ar(i,t){function e(){this.constructor=i}e.prototype=t.prototype,i.prototype=new e}function Pt(i,t,e,s){var r=Error.call(this,i);return Object.setPrototypeOf&&Object.setPrototypeOf(r,Pt.prototype),r.expected=t,r.found=e,r.location=s,r.name="SyntaxError",r}Ar(Pt,Error);function ys(i,t,e){return e=e||" ",i.length>t?i:(t-=i.length,e+=e.repeat(t),i+e.slice(0,t))}Pt.prototype.format=function(i){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<i.length;s++)if(i[s].source===this.location.source){e=i[s].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,a=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,o=this.location.source+":"+a.line+":"+a.column;if(e){var l=this.location.end,h=ys("",a.line.toString().length," "),d=e[r.line-1],g=r.line===l.line?l.column:d.length+1,C=g-r.column||1;t+=`
 --> `+o+`
`+h+` |
`+a.line+" | "+d+`
`+h+" | "+ys("",r.column-1," ")+ys("",C,"^")}else t+=`
 at `+o}return t};Pt.buildMessage=function(i,t){var e={literal:function(d){return'"'+r(d.text)+'"'},class:function(d){var g=d.parts.map(function(C){return Array.isArray(C)?a(C[0])+"-"+a(C[1]):a(C)});return"["+(d.inverted?"^":"")+g.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(d){return d.description}};function s(d){return d.charCodeAt(0).toString(16).toUpperCase()}function r(d){return d.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function a(d){return d.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(g){return"\\x0"+s(g)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(g){return"\\x"+s(g)})}function o(d){return e[d.type](d)}function l(d){var g=d.map(o),C,_;if(g.sort(),g.length>0){for(C=1,_=1;C<g.length;C++)g[C-1]!==g[C]&&(g[_]=g[C],_++);g.length=_}switch(g.length){case 1:return g[0];case 2:return g[0]+" or "+g[1];default:return g.slice(0,-1).join(", ")+", or "+g[g.length-1]}}function h(d){return d?'"'+r(d)+'"':"end of input"}return"Expected "+l(i)+" but "+h(t)+" found."};function wr(i,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,r={pgn:Ge},a=Ge,o="[",l='"',h="]",d=".",g="O-O-O",C="O-O",_="0-0-0",D="0-0",b="$",S="{",A="}",V=";",F="(",Y=")",K="1-0",J="0-1",ne="1/2-1/2",st="*",ae=/^[a-zA-Z]/,Ee=/^[^"]/,ue=/^[0-9]/,re=/^[.]/,fe=/^[a-zA-Z1-8\-=]/,oe=/^[+#]/,X=/^[!?]/,ee=/^[^}]/,Ie=/^[^\r\n]/,Te=/^[ \t\r\n]/,q=j("tag pair"),H=R("[",!1),Ce=R('"',!1),rt=R("]",!1),le=j("tag name"),he=ce([["a","z"],["A","Z"]],!1,!1),$e=j("tag value"),Me=ce(['"'],!0,!1),Se=j("move number"),ke=ce([["0","9"]],!1,!1),Qe=R(".",!1),mt=ce(["."],!1,!1),Ae=j("standard algebraic notation"),He=R("O-O-O",!1),zt=R("O-O",!1),Nt=R("0-0-0",!1),ze=R("0-0",!1),It=ce([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),gt=ce(["+","#"],!1,!1),Tt=j("suffix annotation"),lt=ce(["!","?"],!1,!1),$t=j("NAG"),Ve=R("$",!1),We=j("brace comment"),Wt=R("{",!1),vt=ce(["}"],!0,!1),we=R("}",!1),Oe=j("rest of line comment"),Yt=R(";",!1),bt=ce(["\r",`
`],!0,!1),Pe=j("variation"),xt=R("(",!1),Mt=R(")",!1),De=j("game termination marker"),Zt=R("1-0",!1),Ot=R("0-1",!1),pe=R("1/2-1/2",!1),Ye=R("*",!1),Jt=j("whitespace"),yt=ce([" ","	","\r",`
`],!1,!1),ct=function(n,u){return kr(n,u)},Et=function(n){return Object.fromEntries(n)},Ct=function(n,u){return[n,u]},Dt=function(n,u){return{root:n,marker:u}},St=function(n,u){return Sr(Er(n),...u.flat())},Lt=function(n,u,f,P,x){return Cr(n,u,f,P,x)},qe=function(n){return n},Fe=function(n){return n.replace(/[\r\n]+/g," ")},Be=function(n){return n.trim()},Ze=function(n){return n},Xt=function(n,u){return{result:n,comment:u}},c=t.peg$currPos|0,de=[{line:1,column:1}],te=c,Je=t.peg$maxFailExpected||[],v=t.peg$silentFails|0,Xe;if(t.startRule){if(!(t.startRule in r))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');a=r[t.startRule]}function R(n,u){return{type:"literal",text:n,ignoreCase:u}}function ce(n,u,f){return{type:"class",parts:n,inverted:u,ignoreCase:f}}function Rt(){return{type:"end"}}function j(n){return{type:"other",description:n}}function Le(n){var u=de[n],f;if(u)return u;if(n>=de.length)f=de.length-1;else for(f=n;!de[--f];);for(u=de[f],u={line:u.line,column:u.column};f<n;)i.charCodeAt(f)===10?(u.line++,u.column=1):u.column++,f++;return de[n]=u,u}function Ue(n,u,f){var P=Le(n),x=Le(u),L={source:s,start:{offset:n,line:P.line,column:P.column},end:{offset:u,line:x.line,column:x.column}};return L}function w(n){c<te||(c>te&&(te=c,Je=[]),Je.push(n))}function Kt(n,u,f){return new Pt(Pt.buildMessage(n,u),n,u,f)}function Ge(){var n,u,f;return n=c,u=ut(),f=_e(),n=ct(u,f),n}function ut(){var n,u,f;for(n=c,u=[],f=ft();f!==e;)u.push(f),f=ft();return f=k(),n=Et(u),n}function ft(){var n,u,f,P,x,L,Ne;return v++,n=c,k(),i.charCodeAt(c)===91?(u=o,c++):(u=e,v===0&&w(H)),u!==e?(k(),f=Vt(),f!==e?(k(),i.charCodeAt(c)===34?(P=l,c++):(P=e,v===0&&w(Ce)),P!==e?(x=qt(),i.charCodeAt(c)===34?(L=l,c++):(L=e,v===0&&w(Ce)),L!==e?(k(),i.charCodeAt(c)===93?(Ne=h,c++):(Ne=e,v===0&&w(rt)),Ne!==e?n=Ct(f,x):(c=n,n=e)):(c=n,n=e)):(c=n,n=e)):(c=n,n=e)):(c=n,n=e),v--,n===e&&v===0&&w(q),n}function Vt(){var n,u,f;if(v++,n=c,u=[],f=i.charAt(c),ae.test(f)?c++:(f=e,v===0&&w(he)),f!==e)for(;f!==e;)u.push(f),f=i.charAt(c),ae.test(f)?c++:(f=e,v===0&&w(he));else u=e;return u!==e?n=i.substring(n,c):n=u,v--,n===e&&(u=e,v===0&&w(le)),n}function qt(){var n,u,f;for(v++,n=c,u=[],f=i.charAt(c),Ee.test(f)?c++:(f=e,v===0&&w(Me));f!==e;)u.push(f),f=i.charAt(c),Ee.test(f)?c++:(f=e,v===0&&w(Me));return n=i.substring(n,c),v--,u=e,v===0&&w($e),n}function _e(){var n,u,f;return n=c,u=ht(),k(),f=Re(),f===e&&(f=null),k(),n=Dt(u,f),n}function ht(){var n,u,f,P;for(n=c,u=it(),u===e&&(u=null),f=[],P=z();P!==e;)f.push(P),P=z();return n=St(u,f),n}function z(){var n,u,f,P,x,L,Ne,et;if(n=c,k(),Ft(),k(),u=es(),u!==e){for(f=U(),f===e&&(f=null),P=[],x=Bt();x!==e;)P.push(x),x=Bt();for(x=k(),L=it(),L===e&&(L=null),Ne=[],et=dt();et!==e;)Ne.push(et),et=dt();n=Lt(u,f,P,L,Ne)}else c=n,n=e;return n}function Ft(){var n,u,f,P,x,L;for(v++,n=c,u=[],f=i.charAt(c),ue.test(f)?c++:(f=e,v===0&&w(ke));f!==e;)u.push(f),f=i.charAt(c),ue.test(f)?c++:(f=e,v===0&&w(ke));if(i.charCodeAt(c)===46?(f=d,c++):(f=e,v===0&&w(Qe)),f!==e){for(P=k(),x=[],L=i.charAt(c),re.test(L)?c++:(L=e,v===0&&w(mt));L!==e;)x.push(L),L=i.charAt(c),re.test(L)?c++:(L=e,v===0&&w(mt));u=[u,f,P,x],n=u}else c=n,n=e;return v--,n===e&&(u=e,v===0&&w(Se)),n}function es(){var n,u,f,P,x,L;if(v++,n=c,u=c,i.substr(c,5)===g?(f=g,c+=5):(f=e,v===0&&w(He)),f===e&&(i.substr(c,3)===C?(f=C,c+=3):(f=e,v===0&&w(zt)),f===e&&(i.substr(c,5)===_?(f=_,c+=5):(f=e,v===0&&w(Nt)),f===e&&(i.substr(c,3)===D?(f=D,c+=3):(f=e,v===0&&w(ze)),f===e))))if(f=c,P=i.charAt(c),ae.test(P)?c++:(P=e,v===0&&w(he)),P!==e){if(x=[],L=i.charAt(c),fe.test(L)?c++:(L=e,v===0&&w(It)),L!==e)for(;L!==e;)x.push(L),L=i.charAt(c),fe.test(L)?c++:(L=e,v===0&&w(It));else x=e;x!==e?(P=[P,x],f=P):(c=f,f=e)}else c=f,f=e;return f!==e?(P=i.charAt(c),oe.test(P)?c++:(P=e,v===0&&w(gt)),P===e&&(P=null),f=[f,P],u=f):(c=u,u=e),u!==e?n=i.substring(n,c):n=u,v--,n===e&&(u=e,v===0&&w(Ae)),n}function U(){var n,u,f;for(v++,n=c,u=[],f=i.charAt(c),X.test(f)?c++:(f=e,v===0&&w(lt));f!==e;)u.push(f),u.length>=2?f=e:(f=i.charAt(c),X.test(f)?c++:(f=e,v===0&&w(lt)));return u.length<1?(c=n,n=e):n=u,v--,n===e&&(u=e,v===0&&w(Tt)),n}function Bt(){var n,u,f,P,x;if(v++,n=c,k(),i.charCodeAt(c)===36?(u=b,c++):(u=e,v===0&&w(Ve)),u!==e){if(f=c,P=[],x=i.charAt(c),ue.test(x)?c++:(x=e,v===0&&w(ke)),x!==e)for(;x!==e;)P.push(x),x=i.charAt(c),ue.test(x)?c++:(x=e,v===0&&w(ke));else P=e;P!==e?f=i.substring(f,c):f=P,f!==e?n=qe(f):(c=n,n=e)}else c=n,n=e;return v--,n===e&&v===0&&w($t),n}function it(){var n;return n=me(),n===e&&(n=ts()),n}function me(){var n,u,f,P,x;if(v++,n=c,i.charCodeAt(c)===123?(u=S,c++):(u=e,v===0&&w(Wt)),u!==e){for(f=c,P=[],x=i.charAt(c),ee.test(x)?c++:(x=e,v===0&&w(vt));x!==e;)P.push(x),x=i.charAt(c),ee.test(x)?c++:(x=e,v===0&&w(vt));f=i.substring(f,c),i.charCodeAt(c)===125?(P=A,c++):(P=e,v===0&&w(we)),P!==e?n=Fe(f):(c=n,n=e)}else c=n,n=e;return v--,n===e&&(u=e,v===0&&w(We)),n}function ts(){var n,u,f,P,x;if(v++,n=c,i.charCodeAt(c)===59?(u=V,c++):(u=e,v===0&&w(Yt)),u!==e){for(f=c,P=[],x=i.charAt(c),Ie.test(x)?c++:(x=e,v===0&&w(bt));x!==e;)P.push(x),x=i.charAt(c),Ie.test(x)?c++:(x=e,v===0&&w(bt));f=i.substring(f,c),n=Be(f)}else c=n,n=e;return v--,n===e&&(u=e,v===0&&w(Oe)),n}function dt(){var n,u,f,P;return v++,n=c,k(),i.charCodeAt(c)===40?(u=F,c++):(u=e,v===0&&w(xt)),u!==e?(f=ht(),f!==e?(k(),i.charCodeAt(c)===41?(P=Y,c++):(P=e,v===0&&w(Mt)),P!==e?n=Ze(f):(c=n,n=e)):(c=n,n=e)):(c=n,n=e),v--,n===e&&v===0&&w(Pe),n}function Re(){var n,u,f;return v++,n=c,i.substr(c,3)===K?(u=K,c+=3):(u=e,v===0&&w(Zt)),u===e&&(i.substr(c,3)===J?(u=J,c+=3):(u=e,v===0&&w(Ot)),u===e&&(i.substr(c,7)===ne?(u=ne,c+=7):(u=e,v===0&&w(pe)),u===e&&(i.charCodeAt(c)===42?(u=st,c++):(u=e,v===0&&w(Ye))))),u!==e?(k(),f=it(),f===e&&(f=null),n=Xt(u,f)):(c=n,n=e),v--,n===e&&(u=e,v===0&&w(De)),n}function k(){var n,u;for(v++,n=[],u=i.charAt(c),Te.test(u)?c++:(u=e,v===0&&w(yt));u!==e;)n.push(u),u=i.charAt(c),Te.test(u)?c++:(u=e,v===0&&w(yt));return v--,u=e,v===0&&w(Jt),n}if(Xe=a(),t.peg$library)return{peg$result:Xe,peg$currPos:c,peg$FAILED:e,peg$maxFailExpected:Je,peg$maxFailPos:te};if(Xe!==e&&c===i.length)return Xe;throw Xe!==e&&c<i.length&&w(Rt()),Kt(Je,te<i.length?i.charAt(te):null,te<i.length?Ue(te,te+1):Ue(te,te))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const ms=0xffffffffffffffffn;function Es(i,t){return(i<<t|i>>64n-t)&0xffffffffffffffffn}function Gs(i,t){return i*t&ms}function Pr(i){return function(){let t=BigInt(i&ms),e=BigInt(i>>64n&ms);const s=Gs(Es(Gs(t,5n),7n),9n);return e^=t,t=(Es(t,24n)^e^e<<16n)&ms,e=Es(e,37n),i=e<<64n|t,s}}const vs=Pr(0xa187eb39cdcaed8f31c4b365b102e01en),Nr=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>vs()))),Ir=Array.from({length:8},()=>vs()),Tr=Array.from({length:16},()=>vs()),Cs=vs(),ie="w",ge="b",Q="p",Is="n",gs="b",jt="r",ot="q",W="k",Ss="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class ds{constructor(t,e){B(this,"color");B(this,"from");B(this,"to");B(this,"piece");B(this,"captured");B(this,"promotion");B(this,"flags");B(this,"san");B(this,"lan");B(this,"before");B(this,"after");const{color:s,piece:r,from:a,to:o,flags:l,captured:h,promotion:d}=e,g=Z(a),C=Z(o);this.color=s,this.piece=r,this.from=g,this.to=C,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=g+C,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const _ in T)T[_]&l&&(this.flags+=pt[_]);h&&(this.captured=h),d&&(this.promotion=d,this.lan+=d)}isCapture(){return this.flags.indexOf(pt.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(pt.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(pt.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(pt.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(pt.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(pt.BIG_PAWN)>-1}}const se=-1,pt={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},T={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},Ts={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},$r={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Mr={...Ts,...$r},I={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},ks={b:[16,32,17,15],w:[-16,-32,-17,-15]},js={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Or=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Dr=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Lr={p:1,n:2,b:4,r:8,q:16,k:32},Rr="pnbrqkPNBRQK",Qs=[Is,gs,jt,ot],Kr=7,Vr=6,qr=1,Fr=0,ps={[W]:T.KSIDE_CASTLE,[ot]:T.QSIDE_CASTLE},nt={w:[{square:I.a1,flag:T.QSIDE_CASTLE},{square:I.h1,flag:T.KSIDE_CASTLE}],b:[{square:I.a8,flag:T.QSIDE_CASTLE},{square:I.h8,flag:T.KSIDE_CASTLE}]},Br={b:qr,w:Vr},As="--";function _t(i){return i>>4}function Ht(i){return i&15}function tr(i){return"0123456789".indexOf(i)!==-1}function Z(i){const t=Ht(i),e=_t(i);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function Ut(i){return i===ie?ge:ie}function Ur(i){const t=i.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=t[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let o=0;o<r.length;o++){let l=0,h=!1;for(let d=0;d<r[o].length;d++)if(tr(r[o][d])){if(h)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(r[o][d],10),h=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[o][d]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,h=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const a=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:o,regex:l}of a){if(!l.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${o} king`};if((t[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${o} kings`}}return Array.from(r[0]+r[7]).some(o=>o.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Gr(i,t){const e=i.from,s=i.to,r=i.piece;let a=0,o=0,l=0;for(let h=0,d=t.length;h<d;h++){const g=t[h].from,C=t[h].to,_=t[h].piece;r===_&&e!==g&&s===C&&(a++,_t(e)===_t(g)&&o++,Ht(e)===Ht(g)&&l++)}return a>0?o>0&&l>0?Z(e):l>0?Z(e).charAt(1):Z(e).charAt(0):""}function at(i,t,e,s,r,a=void 0,o=T.NORMAL){const l=_t(s);if(r===Q&&(l===Kr||l===Fr))for(let h=0;h<Qs.length;h++){const d=Qs[h];i.push({color:t,from:e,to:s,piece:r,captured:a,promotion:d,flags:o|T.PROMOTION})}else i.push({color:t,from:e,to:s,piece:r,captured:a,flags:o})}function Hs(i){let t=i.charAt(0);return t>="a"&&t<="h"?i.match(/[a-h]\d.*[a-h]\d/)?void 0:Q:(t=t.toLowerCase(),t==="o"?W:t)}function ws(i){return i.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class sr{constructor(t=Ss,{skipValidation:e=!1}={}){B(this,"_board",new Array(128));B(this,"_turn",ie);B(this,"_header",{});B(this,"_kings",{w:se,b:se});B(this,"_epSquare",-1);B(this,"_halfMoves",0);B(this,"_moveNumber",0);B(this,"_history",[]);B(this,"_comments",{});B(this,"_castling",{w:0,b:0});B(this,"_hash",0n);B(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:se,b:se},this._turn=ie,this._castling={w:0,b:0},this._epSquare=se,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Mr},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let r=t.split(/\s+/);if(r.length>=2&&r.length<6){const l=["-","-","0","1"];t=r.concat(l.slice(-(6-r.length))).join(" ")}if(r=t.split(/\s+/),!e){const{ok:l,error:h}=Ur(t);if(!l)throw new Error(h)}const a=r[0];let o=0;this.clear({preserveHeaders:s});for(let l=0;l<a.length;l++){const h=a.charAt(l);if(h==="/")o+=8;else if(tr(h))o+=parseInt(h,10);else{const d=h<"a"?ie:ge;this._put({type:h.toLowerCase(),color:d},Z(o)),o++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=T.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=T.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=T.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=T.QSIDE_CASTLE),this._epSquare=r[3]==="-"?se:I[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var o,l;let e=0,s="";for(let h=I.a8;h<=I.h1;h++){if(this._board[h]){e>0&&(s+=e,e=0);const{color:d,type:g}=this._board[h];s+=d===ie?g.toUpperCase():g.toLowerCase()}else e++;h+1&136&&(e>0&&(s+=e),h!==I.h1&&(s+="/"),e=0,h+=8)}let r="";this._castling[ie]&T.KSIDE_CASTLE&&(r+="K"),this._castling[ie]&T.QSIDE_CASTLE&&(r+="Q"),this._castling[ge]&T.KSIDE_CASTLE&&(r+="k"),this._castling[ge]&T.QSIDE_CASTLE&&(r+="q"),r=r||"-";let a="-";if(this._epSquare!==se)if(t)a=Z(this._epSquare);else{const h=this._epSquare+(this._turn===ie?16:-16),d=[h+1,h-1];for(const g of d){if(g&136)continue;const C=this._turn;if(((o=this._board[g])==null?void 0:o.color)===C&&((l=this._board[g])==null?void 0:l.type)===Q){this._makeMove({color:C,from:g,to:this._epSquare,piece:Q,captured:Q,flags:T.EP_CAPTURE});const _=!this._isKingAttacked(C);if(this._undoMove(),_){a=Z(this._epSquare);break}}}}return[s,this._turn,r,a,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],r={w:0,b:1}[e],a={p:0,n:1,b:2,r:3,q:4,k:5}[s];return Nr[r][a][t]}_epKey(){return this._epSquare===se?0n:Ir[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Tr[t]}_computeHash(){let t=0n;for(let e=I.a8;e<=I.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=Cs),t}_updateSetup(t){this._history.length>0||(t!==Ss?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(Ss)}get(t){return this._board[I[t]]}findPiece(t){var s;const e=[];for(let r=I.a8;r<=I.h1;r++){if(r&136){r+=7;continue}!this._board[r]||((s=this._board[r])==null?void 0:s.color)!==t.color||this._board[r].color===t.color&&this._board[r].type===t.type&&e.push(Z(r))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Rr.indexOf(t.toLowerCase())===-1||!(s in I))return!1;const r=I[s];if(t==W&&!(this._kings[e]==se||this._kings[e]==r))return!1;const a=this._board[r];return a&&a.type===W&&(this._kings[a.color]=se),this._set(r,{type:t,color:e}),t===W&&(this._kings[e]=r),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(I[t]),e&&e.type===W&&(this._kings[e.color]=se),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var s,r,a,o,l,h,d,g,C,_,D,b;this._hash^=this._castlingKey();const t=((s=this._board[I.e1])==null?void 0:s.type)===W&&((r=this._board[I.e1])==null?void 0:r.color)===ie,e=((a=this._board[I.e8])==null?void 0:a.type)===W&&((o=this._board[I.e8])==null?void 0:o.color)===ge;(!t||((l=this._board[I.a1])==null?void 0:l.type)!==jt||((h=this._board[I.a1])==null?void 0:h.color)!==ie)&&(this._castling.w&=-65),(!t||((d=this._board[I.h1])==null?void 0:d.type)!==jt||((g=this._board[I.h1])==null?void 0:g.color)!==ie)&&(this._castling.w&=-33),(!e||((C=this._board[I.a8])==null?void 0:C.type)!==jt||((_=this._board[I.a8])==null?void 0:_.color)!==ge)&&(this._castling.b&=-65),(!e||((D=this._board[I.h8])==null?void 0:D.type)!==jt||((b=this._board[I.h8])==null?void 0:b.color)!==ge)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var a,o;if(this._epSquare===se)return;const t=this._epSquare+(this._turn===ie?-16:16),e=this._epSquare+(this._turn===ie?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((a=this._board[e])==null?void 0:a.color)!==Ut(this._turn)||((o=this._board[e])==null?void 0:o.type)!==Q){this._hash^=this._epKey(),this._epSquare=se;return}const r=l=>{var h,d;return!(l&136)&&((h=this._board[l])==null?void 0:h.color)===this._turn&&((d=this._board[l])==null?void 0:d.type)===Q};s.some(r)||(this._hash^=this._epKey(),this._epSquare=se)}_attacked(t,e,s){const r=[];for(let a=I.a8;a<=I.h1;a++){if(a&136){a+=7;continue}if(this._board[a]===void 0||this._board[a].color!==t)continue;const o=this._board[a],l=a-e;if(l===0)continue;const h=l+119;if(Or[h]&Lr[o.type]){if(o.type===Q){if(l>0&&o.color===ie||l<=0&&o.color===ge)if(s)r.push(Z(a));else return!0;continue}if(o.type==="n"||o.type==="k")if(s){r.push(Z(a));continue}else return!0;const d=Dr[h];let g=a+d,C=!1;for(;g!==e;){if(this._board[g]!=null){C=!0;break}g+=d}if(!C)if(s){r.push(Z(a));continue}else return!0}}return s?r:!1}attackers(t,e){return e?this._attacked(e,I[t],!0):this._attacked(this._turn,I[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(Ut(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,I[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,r=0;for(let a=I.a8;a<=I.h1;a++){if(r=(r+1)%2,a&136){a+=7;continue}const o=this._board[a];o&&(t[o.type]=o.type in t?t[o.type]+1:1,o.type===gs&&e.push(r),s++)}if(s===2)return!0;if(s===3&&(t[gs]===1||t[Is]===1))return!0;if(s===t[gs]+2){let a=0;const o=e.length;for(let l=0;l<o;l++)a+=e[l];if(a===0||a===o)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const r=this._moves({square:e,piece:s});return t?r.map(a=>new ds(this,a)):r.map(a=>this._moveToSan(a,r))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){var D;const r=s?s.toLowerCase():void 0,a=e==null?void 0:e.toLowerCase(),o=[],l=this._turn,h=Ut(l);let d=I.a8,g=I.h1,C=!1;if(r)if(r in I)d=g=I[r],C=!0;else return[];for(let b=d;b<=g;b++){if(b&136){b+=7;continue}if(!this._board[b]||this._board[b].color===h)continue;const{type:S}=this._board[b];let A;if(S===Q){if(a&&a!==S)continue;A=b+ks[l][0],this._board[A]||(at(o,l,b,A,Q),A=b+ks[l][1],Br[l]===_t(b)&&!this._board[A]&&at(o,l,b,A,Q,void 0,T.BIG_PAWN));for(let V=2;V<4;V++)A=b+ks[l][V],!(A&136)&&(((D=this._board[A])==null?void 0:D.color)===h?at(o,l,b,A,Q,this._board[A].type,T.CAPTURE):A===this._epSquare&&at(o,l,b,A,Q,Q,T.EP_CAPTURE))}else{if(a&&a!==S)continue;for(let V=0,F=js[S].length;V<F;V++){const Y=js[S][V];for(A=b;A+=Y,!(A&136);){if(!this._board[A])at(o,l,b,A,S);else{if(this._board[A].color===l)break;at(o,l,b,A,S,this._board[A].type,T.CAPTURE);break}if(S===Is||S===W)break}}}}if((a===void 0||a===W)&&(!C||g===this._kings[l])){if(this._castling[l]&T.KSIDE_CASTLE){const b=this._kings[l],S=b+2;!this._board[b+1]&&!this._board[S]&&!this._attacked(h,this._kings[l])&&!this._attacked(h,b+1)&&!this._attacked(h,S)&&at(o,l,this._kings[l],S,W,void 0,T.KSIDE_CASTLE)}if(this._castling[l]&T.QSIDE_CASTLE){const b=this._kings[l],S=b-2;!this._board[b-1]&&!this._board[b-2]&&!this._board[b-3]&&!this._attacked(h,this._kings[l])&&!this._attacked(h,b-1)&&!this._attacked(h,S)&&at(o,l,this._kings[l],S,W,void 0,T.QSIDE_CASTLE)}}if(!t||this._kings[l]===-1)return o;const _=[];for(let b=0,S=o.length;b<S;b++)this._makeMove(o[b]),this._isKingAttacked(l)||_.push(o[b]),this._undoMove();return _}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan(As,e);else if(typeof t=="object"){const a=this._moves();for(let o=0,l=a.length;o<l;o++)if(t.from===Z(a[o].from)&&t.to===Z(a[o].to)&&(!("promotion"in a[o])||t.promotion===a[o].promotion)){s=a[o];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&T.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new ds(this,s);return this._makeMove(s),this._incPositionCount(),r}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){var r,a,o,l;const e=this._turn,s=Ut(e);if(this._push(t),t.flags&T.NULL_MOVE){e===ge&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=se;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&T.EP_CAPTURE&&(this._turn===ge?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===W){if(this._kings[e]=t.to,t.flags&T.KSIDE_CASTLE){const h=t.to-1,d=t.to+1;this._movePiece(d,h)}else if(t.flags&T.QSIDE_CASTLE){const h=t.to+1,d=t.to-2;this._movePiece(d,h)}this._castling[e]=0}if(this._castling[e]){for(let h=0,d=nt[e].length;h<d;h++)if(t.from===nt[e][h].square&&this._castling[e]&nt[e][h].flag){this._castling[e]^=nt[e][h].flag;break}}if(this._castling[s]){for(let h=0,d=nt[s].length;h<d;h++)if(t.to===nt[s][h].square&&this._castling[s]&nt[s][h].flag){this._castling[s]^=nt[s][h].flag;break}}if(this._hash^=this._castlingKey(),t.flags&T.BIG_PAWN){let h;e===ge?h=t.to-16:h=t.to+16,!(t.to-1&136)&&((r=this._board[t.to-1])==null?void 0:r.type)===Q&&((a=this._board[t.to-1])==null?void 0:a.color)===s||!(t.to+1&136)&&((o=this._board[t.to+1])==null?void 0:o.type)===Q&&((l=this._board[t.to+1])==null?void 0:l.color)===s?(this._epSquare=h,this._hash^=this._epKey()):this._epSquare=se}else this._epSquare=se;t.piece===Q?this._halfMoves=0:t.flags&(T.CAPTURE|T.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===ge&&this._moveNumber++,this._turn=s,this._hash^=Cs}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new ds(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Cs;const s=this._turn,r=Ut(s);if(e.flags&T.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&T.EP_CAPTURE){let a;s===ge?a=e.to-16:a=e.to+16,this._set(a,{type:Q,color:r})}else this._set(e.to,{type:e.captured,color:r});if(e.flags&(T.KSIDE_CASTLE|T.QSIDE_CASTLE)){let a,o;e.flags&T.KSIDE_CASTLE?(a=e.to+1,o=e.to-1):(a=e.to-2,o=e.to+1),this._movePiece(o,a)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let r=!1;for(const _ in this._header)this._header[_]&&s.push(`[${_} "${this._header[_]}"]`+t),r=!0;r&&this._history.length&&s.push(t);const a=_=>{const D=this._comments[this.fen()];if(typeof D<"u"){const b=_.length>0?" ":"";_=`${_}${b}{${D}}`}return _},o=[];for(;this._history.length>0;)o.push(this._undoMove());const l=[];let h="";for(o.length===0&&l.push(a(""));o.length>0;){h=a(h);const _=o.pop();if(!_)break;if(!this._history.length&&_.color==="b"){const D=`${this._moveNumber}. ...`;h=h?`${h} ${D}`:D}else _.color==="w"&&(h.length&&l.push(h),h=this._moveNumber+".");h=h+" "+this._moveToSan(_,this._moves({legal:!0})),this._makeMove(_)}if(h.length&&l.push(a(h)),l.push(this._header.Result||"*"),e===0)return s.join("")+l.join(" ");const d=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},g=function(_,D){for(const b of D.split(" "))if(b){if(_+b.length>e){for(;d();)_--;s.push(t),_=0}s.push(b),_+=b.length,s.push(" "),_++}return d()&&_--,_};let C=0;for(let _=0;_<l.length;_++){if(C+l[_].length>e&&l[_].includes("{")){C=g(C,l[_]);continue}C+l[_].length>e&&_!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),C=0):_!==0&&(s.push(" "),C++),s.push(l[_]),C+=l[_].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??Ts[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=Ts[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const r=wr(t);this.reset();const a=r.headers;let o="";for(const d in a)d.toLowerCase()==="fen"&&(o=a[d]),this.header(d,a[d]);if(!e)o&&this.load(o,{preserveHeaders:!0});else if(a.SetUp==="1"){if(!("FEN"in a))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(a.FEN,{preserveHeaders:!0})}let l=r.root;for(;l;){if(l.move){const d=this._moveFromSan(l.move,e);if(d==null)throw new Error(`Invalid move in PGN: ${l.move}`);this._makeMove(d),this._incPositionCount()}l.comment!==void 0&&(this._comments[this.fen()]=l.comment),l=l.variations[0]}const h=r.result;h&&Object.keys(this._header).length&&this._header.Result!==h&&this.setHeader("Result",h)}_moveToSan(t,e){let s="";if(t.flags&T.KSIDE_CASTLE)s="O-O";else if(t.flags&T.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&T.NULL_MOVE)return As;if(t.piece!==Q){const r=Gr(t,e);s+=t.piece.toUpperCase()+r}t.flags&(T.CAPTURE|T.EP_CAPTURE)&&(t.piece===Q&&(s+=Z(t.from)[0]),s+="x"),s+=Z(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=ws(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==As)return{color:this._turn,from:0,to:0,piece:"k",flags:T.NULL_MOVE};let r=Hs(s),a=this._moves({legal:!0,piece:r});for(let _=0,D=a.length;_<D;_++)if(s===ws(this._moveToSan(a[_],a)))return a[_];if(e)return null;let o,l,h,d,g,C=!1;if(l=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(o=l[1],h=l[2],d=l[3],g=l[4],h.length==1&&(C=!0)):(l=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(o=l[1],h=l[2],d=l[3],g=l[4],h.length==1&&(C=!0))),r=Hs(s),a=this._moves({legal:!0,piece:o||r}),!d)return null;for(let _=0,D=a.length;_<D;_++)if(h){if((!o||o.toLowerCase()==a[_].piece)&&I[h]==a[_].from&&I[d]==a[_].to&&(!g||g.toLowerCase()==a[_].promotion))return a[_];if(C){const b=Z(a[_].from);if((!o||o.toLowerCase()==a[_].piece)&&I[d]==a[_].to&&(h==b[0]||h==b[1])&&(!g||g.toLowerCase()==a[_].promotion))return a[_]}}else if(s===ws(this._moveToSan(a[_],a)).replace("x",""))return a[_];return null}ascii(){let t=`   +------------------------+
`;for(let e=I.a8;e<=I.h1;e++){if(Ht(e)===0&&(t+=" "+"87654321"[_t(e)]+" |"),this._board[e]){const s=this._board[e].type,a=this._board[e].color===ie?s.toUpperCase():s.toLowerCase();t+=" "+a+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const r=this._turn;for(let a=0,o=e.length;a<o;a++)this._makeMove(e[a]),this._isKingAttacked(r)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=I.a8;s<=I.h1;s++)this._board[s]==null?e.push(null):e.push({square:Z(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in I){const e=I[t];return(_t(e)+Ht(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const r=e.pop();if(!r)break;t?s.push(new ds(this,r)):s.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=r=>{r in this._comments&&(e[r]=this._comments[r])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const r=t.pop();if(!r)break;this._makeMove(r),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const r of[W,ot])e[r]!==void 0&&(e[r]?this._castling[t]|=ps[r]:this._castling[t]&=~ps[r]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[W]===void 0||e[W]===s[W])&&(e[ot]===void 0||e[ot]===s[ot])}getCastlingRights(t){return{[W]:(this._castling[t]&ps[W])!==0,[ot]:(this._castling[t]&ps[ot])!==0}}moveNumber(){return this._moveNumber}}const jr={id:"immortal",white:"Adolf Anderssen",black:"Lionel Kieseritzky",date:"1851",event:"London (friendly)",win:"white",description:"The Immortal Game - A romantic sacrifice masterpiece.",pgn:`[Event "London"]
[Site "London ENG"]
[Date "1851.06.21"]
[EventDate "1851.05.26"]
[Round "?"]
[Result "1-0"]
[White "Adolf Anderssen"]
[Black "Lionel Kieseritzky"]
[ECO "C33"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "45"]

1.e4 e5 2.f4 exf4 3.Bc4 Qh4+ 4.Kf1 b5 5.Bxb5 Nf6 6.Nf3 Qh6 7.d3 Nh5 8.Nh4 Qg5
9.Nf5 c6 10.g4 Nf6 11.Rg1 cxb5 12.h4 Qg6 13.h5 Qg5 14.Qf3 Ng8 15.Bxf4 Qf6
16.Nc3 Bc5 17.Nd5 Qxb2 18.Bd6 Bxg1 19.e5 Qxa1+ 20.Ke2 Na6 21.Nxg7+ Kd8
22.Qf6+ Nxf6 23.Be7# 1-0`},Qr={id:"opera",white:"Paul Morphy",black:"Duke Karl / Count Isouard",date:"1858",event:"Paris Opera House",win:"white",description:"The Opera Game - Development over material.",pgn:`[Event "Paris"]
[Site "Paris FRA"]
[Date "1858.??.??"]
[EventDate "?"]
[Round "?"]
[Result "1-0"]
[White "Paul Morphy"]
[Black "Duke Karl / Count Isouard"]
[ECO "C41"]
[WhiteElo "?"]
[BlackElo "?"]
[PlyCount "33"]

1.e4 e5 2.Nf3 d6 3.d4 Bg4 4.dxe5 Bxf3 5.Qxf3 dxe5 6.Bc4 Nf6 7.Qb3 Qe7 8.Nc3
c6 9.Bg5 b5 10.Nxb5 cxb5 11.Bxb5+ Nbd7 12.O-O-O Rd8 13.Rxd7 Rxd7 14.Rd1 Qe6
15.Bxd7+ Nxd7 16.Qb8+ Nxb8 17.Rd8# 1-0`},$s=[jr,Qr];let xe=new sr,Ms=[];const Hr={fen:xe.fen(),history:[xe.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:$s[0],lastMove:null,isLoadingGame:!1},Ke=gr(Hr);let wt=null;const zr=3e3;async function Ks(){var i;Ke.update(t=>({...t,isLoadingGame:!0}));try{const s=(await(await fetch("https://lichess.org/api/games/user/DrNykterstein?max=1&rated=true&perfType=blitz&opening=true&clocks=false&evals=false&pgnInJson=true",{headers:{Accept:"application/x-ndjson"}})).text()).trim().split(`
`),r=JSON.parse(s[0]),a={id:r.id,white:r.players.white.user.name,black:r.players.black.user.name,date:new Date(r.createdAt).getFullYear().toString(),event:`Lichess ${r.speed} ‚Ä¢ ${r.perf}`,win:r.winner==="white"?"white":r.winner==="black"?"black":"draw",description:`${((i=r.opening)==null?void 0:i.name)||"Classic Opening"}`,pgn:r.pgn};zs(a)}catch(t){console.error("Failed to load Lichess game:",t),zs($s[Math.floor(Math.random()*$s.length)])}finally{Ke.update(t=>({...t,isLoadingGame:!1}))}}function zs(i){nr(),xe=new sr;try{xe.loadPgn(i.pgn),Ms=xe.history(),xe.reset(),Ke.set({fen:xe.fen(),history:[xe.fen()],currentMoveIndex:-1,isPlaying:!1,currentGame:i,lastMove:null,isLoadingGame:!1}),ir()}catch(t){console.error("Failed to load PGN",t)}}function rr(){const i=Os(Ke);if(i.currentMoveIndex>=Ms.length-1){Ks();return}const t=i.currentMoveIndex+1,e=Ms[t],s=xe.move(e);s&&Ke.update(r=>({...r,fen:xe.fen(),currentMoveIndex:t,lastMove:s,history:[...r.history,xe.fen()]}))}function Wr(){if(Os(Ke).currentMoveIndex<0)return;xe.undo()&&Ke.update(e=>{const s=e.history.slice(0,-1);return{...e,fen:xe.fen(),currentMoveIndex:e.currentMoveIndex-1,lastMove:null,history:s}})}function Yr(){Os(Ke).isPlaying?nr():ir()}function ir(){wt&&clearInterval(wt),Ke.update(i=>({...i,isPlaying:!0})),wt=setInterval(()=>{rr()},zr)}function nr(){wt&&clearInterval(wt),wt=null,Ke.update(i=>({...i,isPlaying:!1}))}Ks();function Zr(i){let t,e,s,r="ChillChess",a,o,l="El Santuario Visual del Ajedrecista",h,d,g="Entrar al Santuario",C,_,D="<span>Recomendamos usar auriculares</span> <br/> <span>Click para activar la experiencia sonora</span>",b,S,A,V;return{c(){t=E("div"),e=E("div"),s=E("h1"),s.textContent=r,a=O(),o=E("p"),o.textContent=l,h=O(),d=E("button"),d.textContent=g,C=O(),_=E("p"),_.innerHTML=D,this.h()},l(F){t=y(F,"DIV",{class:!0});var Y=$(t);e=y(Y,"DIV",{class:!0});var K=$(e);s=y(K,"H1",{class:!0,"data-svelte-h":!0}),G(s)!=="svelte-12mg5j8"&&(s.textContent=r),a=M(K),o=y(K,"P",{class:!0,"data-svelte-h":!0}),G(o)!=="svelte-1qxucny"&&(o.textContent=l),h=M(K),d=y(K,"BUTTON",{class:!0,"data-svelte-h":!0}),G(d)!=="svelte-1e93jub"&&(d.textContent=g),C=M(K),_=y(K,"P",{class:!0,"data-svelte-h":!0}),G(_)!=="svelte-15qbzbi"&&(_.innerHTML=D),K.forEach(N),Y.forEach(N),this.h()},h(){m(s,"class","h1 font-bold font-cinzel text-transparent bg-clip-text bg-gradient-to-br from-primary-400 to-tertiary-400"),m(o,"class","text-xl font-light opacity-80"),m(d,"class","btn variant-filled-primary rounded-full px-8 py-4 shadow-xl text-lg font-semibold hover:scale-105 transition-transform"),m(_,"class","text-xs opacity-50 space-y-1"),m(e,"class","text-center space-y-8 animate-pulse-slow svelte-1855xwc"),m(t,"class","fixed inset-0 z-50 flex items-center justify-center bg-surface-900/90 backdrop-blur-sm")},m(F,Y){ye(F,t,Y),p(t,e),p(e,s),p(e,a),p(e,o),p(e,h),p(e,d),p(e,C),p(e,_),S=!0,A||(V=je(d,"click",i[0]),A=!0)},p:Qt,i(F){S||(F&&ur(()=>{S&&(b||(b=Bs(t,Us,{},!0)),b.run(1))}),S=!0)},o(F){F&&(b||(b=Bs(t,Us,{},!1)),b.run(0)),S=!1},d(F){F&&N(t),F&&b&&b.end(),A=!1,V()}}}function Jr(i){const t=fr();function e(){t("start")}return[e]}class Xr extends Ls{constructor(t){super(),Rs(this,t,Jr,Zr,Ds,{})}}function ei(i){let t,e,s,r,a;return{c(){t=E("audio"),s=O(),r=E("audio"),this.h()},l(o){t=y(o,"AUDIO",{src:!0,preload:!0}),$(t).forEach(N),s=M(o),r=y(o,"AUDIO",{src:!0,preload:!0}),$(r).forEach(N),this.h()},h(){hs(t.src,e=i[3].music[i[2].currentMusic])||m(t,"src",e),t.loop=!0,m(t,"preload","auto"),hs(r.src,a=i[3].ambience[i[2].currentAmbience])||m(r,"src",a),r.loop=!0,m(r,"preload","auto")},m(o,l){ye(o,t,l),i[4](t),ye(o,s,l),ye(o,r,l),i[5](r)},p(o,[l]){l&4&&!hs(t.src,e=o[3].music[o[2].currentMusic])&&m(t,"src",e),l&4&&!hs(r.src,a=o[3].ambience[o[2].currentAmbience])&&m(r,"src",a)},i:Qt,o:Qt,d(o){o&&(N(t),N(s),N(r)),i[4](null),i[5](null)}}}function ti(i,t,e){let s;Ps(i,er,d=>e(2,s=d));const r={music:{lofi:"/assets/audio/music/lofi.mp3",jazz:"/assets/audio/music/jazz.mp3",piano:"/assets/audio/music/piano.mp3",flute:"/assets/audio/music/flute.mp3",none:""},ambience:{rain:"/assets/audio/ambience/rain.mp3",library:"/assets/audio/ambience/library.mp3",garden:"/assets/audio/ambience/garden.mp3",none:""}};let a,o;function l(d){Ns[d?"unshift":"push"](()=>{a=d,e(0,a),e(2,s)})}function h(d){Ns[d?"unshift":"push"](()=>{o=d,e(1,o),e(2,s)})}return i.$$.update=()=>{if(i.$$.dirty&5&&a){e(0,a.volume=s.isMuted?0:s.musicVolume,a);const d=r.music[s.currentMusic];a.src!==d&&d&&(e(0,a.src=d,a),s.isPlaying&&a.play().catch(console.error)),s.isPlaying&&s.currentMusic!=="none"&&a.paused?a.play().catch(console.error):(!s.isPlaying||s.currentMusic==="none")&&a.pause()}if(i.$$.dirty&6&&o){e(1,o.volume=s.isMuted?0:s.ambienceVolume,o);const d=r.ambience[s.currentAmbience];o.src!==d&&d&&(e(1,o.src=d,o),s.isPlaying&&o.play().catch(console.error)),s.isPlaying&&s.currentAmbience!=="none"&&o.paused?o.play().catch(console.error):(!s.isPlaying||s.currentAmbience==="none")&&o.pause()}},[a,o,s,r,l,h]}class si extends Ls{constructor(t){super(),Rs(this,t,ti,ei,Ds,{})}}function Ws(i){let t,e;return t=new Xr({}),t.$on("start",i[4]),{c(){Xs(t.$$.fragment)},l(s){Js(t.$$.fragment,s)},m(s,r){Zs(t,s,r),e=!0},p:Qt,i(s){e||(Gt(t.$$.fragment,s),e=!0)},o(s){_s(t.$$.fragment,s),e=!1},d(s){Ys(t,s)}}}function ri(i){let t,e,s,r=i[0].currentGame.event+"",a,o,l,h=i[0].currentGame.description+"",d,g,C,_=i[0].currentGame.date+"",D,b,S,A,V,F="White",Y,K,J=i[0].currentGame.white+"",ne,st,ae,Ee="‚öîÔ∏è",ue,re,fe,oe="Black",X,ee,Ie=i[0].currentGame.black+"",Te;return{c(){t=E("div"),e=E("div"),s=E("h2"),a=be(r),o=O(),l=E("p"),d=be(h),g=O(),C=E("span"),D=be(_),b=O(),S=E("div"),A=E("div"),V=E("p"),V.textContent=F,Y=O(),K=E("p"),ne=be(J),st=O(),ae=E("div"),ae.textContent=Ee,ue=O(),re=E("div"),fe=E("p"),fe.textContent=oe,X=O(),ee=E("p"),Te=be(Ie),this.h()},l(q){t=y(q,"DIV",{class:!0});var H=$(t);e=y(H,"DIV",{class:!0});var Ce=$(e);s=y(Ce,"H2",{class:!0});var rt=$(s);a=ve(rt,r),rt.forEach(N),o=M(Ce),l=y(Ce,"P",{class:!0});var le=$(l);d=ve(le,h),le.forEach(N),Ce.forEach(N),g=M(H),C=y(H,"SPAN",{class:!0});var he=$(C);D=ve(he,_),he.forEach(N),H.forEach(N),b=M(q),S=y(q,"DIV",{class:!0});var $e=$(S);A=y($e,"DIV",{class:!0});var Me=$(A);V=y(Me,"P",{class:!0,"data-svelte-h":!0}),G(V)!=="svelte-lfr7up"&&(V.textContent=F),Y=M(Me),K=y(Me,"P",{class:!0});var Se=$(K);ne=ve(Se,J),Se.forEach(N),Me.forEach(N),st=M($e),ae=y($e,"DIV",{class:!0,"data-svelte-h":!0}),G(ae)!=="svelte-1efwqf2"&&(ae.textContent=Ee),ue=M($e),re=y($e,"DIV",{class:!0});var ke=$(re);fe=y(ke,"P",{class:!0,"data-svelte-h":!0}),G(fe)!=="svelte-yphz3f"&&(fe.textContent=oe),X=M(ke),ee=y(ke,"P",{class:!0});var Qe=$(ee);Te=ve(Qe,Ie),Qe.forEach(N),ke.forEach(N),$e.forEach(N),this.h()},h(){m(s,"class","text-lg font-bold text-primary-400 font-cinzel"),m(l,"class","text-xs text-surface-400 mt-1"),m(e,"class","flex-1"),m(C,"class","text-xs px-2 py-1 bg-primary-500/20 text-primary-300 rounded-full"),m(t,"class","flex items-start justify-between"),m(V,"class","text-xs text-surface-500 mb-1"),m(K,"class","text-sm font-semibold text-surface-200"),m(A,"class","text-center flex-1"),m(ae,"class","text-primary-500 text-xl"),m(fe,"class","text-xs text-surface-500 mb-1"),m(ee,"class","text-sm font-semibold text-surface-200"),m(re,"class","text-center flex-1"),m(S,"class","flex items-center justify-between pt-3 border-t border-surface-700")},m(q,H){ye(q,t,H),p(t,e),p(e,s),p(s,a),p(e,o),p(e,l),p(l,d),p(t,g),p(t,C),p(C,D),ye(q,b,H),ye(q,S,H),p(S,A),p(A,V),p(A,Y),p(A,K),p(K,ne),p(S,st),p(S,ae),p(S,ue),p(S,re),p(re,fe),p(re,X),p(re,ee),p(ee,Te)},p(q,H){H&1&&r!==(r=q[0].currentGame.event+"")&&tt(a,r),H&1&&h!==(h=q[0].currentGame.description+"")&&tt(d,h),H&1&&_!==(_=q[0].currentGame.date+"")&&tt(D,_),H&1&&J!==(J=q[0].currentGame.white+"")&&tt(ne,J),H&1&&Ie!==(Ie=q[0].currentGame.black+"")&&tt(Te,Ie)},d(q){q&&(N(t),N(b),N(S))}}}function ii(i){let t,e='<div class="h-4 bg-surface-600 rounded w-3/4 loading-shimmer"></div> <div class="h-3 bg-surface-600 rounded w-1/2 loading-shimmer"></div>';return{c(){t=E("div"),t.innerHTML=e,this.h()},l(s){t=y(s,"DIV",{class:!0,"data-svelte-h":!0}),G(t)!=="svelte-6a1pb6"&&(t.innerHTML=e),this.h()},h(){m(t,"class","animate-pulse space-y-2")},m(s,r){ye(s,t,r)},p:Qt,d(s){s&&N(t)}}}function ni(i){let t;return{c(){t=be("‚ñ∂Ô∏è")},l(e){t=ve(e,"‚ñ∂Ô∏è")},m(e,s){ye(e,t,s)},d(e){e&&N(t)}}}function ai(i){let t;return{c(){t=be("‚è∏Ô∏è")},l(e){t=ve(e,"‚è∏Ô∏è")},m(e,s){ye(e,t,s)},d(e){e&&N(t)}}}function oi(i){let t,e,s,r,a,o,l,h,d,g,C,_,D='<h1 class="text-5xl font-bold font-cinzel bg-clip-text text-transparent bg-gradient-to-r from-primary-300 via-primary-400 to-tertiary-400 drop-shadow-lg">ChillChess</h1> <p class="text-sm text-surface-300 mt-1 font-light tracking-wide">Visual Sanctuary</p>',b,S,A,V,F,Y,K,J,ne,st="Atmosphere",ae,Ee,ue=i[3].activeVibe+"",re,fe,oe,X,ee,Ie="üåßÔ∏è",Te,q,H="Noir",Ce,rt,le,he,$e="üìö",Me,Se,ke="Library",Qe,mt,Ae,He,zt="üå∏",Nt,ze,It="Zen",gt,Tt,lt,$t,Ve,We,Wt="Playback",vt,we,Oe,Yt="‚èÆÔ∏è",bt,Pe,xt,Mt,De,Zt="‚è≠Ô∏è",Ot,pe,Ye,Jt="üîÑ",yt,ct=i[0].isLoadingGame?"Loading...":"New Random Game",Et,Ct,Dt,St,Lt,qe,Fe,Be,Ze,Xt=`<span class="text-lg">üåßÔ∏è</span>
                        Ambience`,c,de,te=Math.round(i[3].ambienceVolume*100)+"",Je,v,Xe,R,ce,Rt,j,Le,Ue,w=`<span class="text-lg">üéµ</span>
                        Music`,Kt,Ge,ut=Math.round(i[3].musicVolume*100)+"",ft,Vt,qt,_e,ht,z,Ft,es,U=i[2]&&Ws(i);e=new si({});function Bt(k,n){return k[0].isLoadingGame?ii:ri}let it=Bt(i),me=it(i);function ts(k,n){return k[0].isPlaying?ai:ni}let dt=ts(i),Re=dt(i);return{c(){U&&U.c(),t=O(),Xs(e.$$.fragment),s=O(),r=E("div"),a=E("div"),o=E("div"),l=E("div"),h=O(),d=E("div"),g=E("div"),C=O(),_=E("div"),_.innerHTML=D,b=O(),S=E("div"),A=E("div"),me.c(),V=O(),F=E("hr"),Y=O(),K=E("div"),J=E("div"),ne=E("p"),ne.textContent=st,ae=O(),Ee=E("span"),re=be(ue),fe=O(),oe=E("div"),X=E("button"),ee=E("div"),ee.textContent=Ie,Te=O(),q=E("div"),q.textContent=H,rt=O(),le=E("button"),he=E("div"),he.textContent=$e,Me=O(),Se=E("div"),Se.textContent=ke,mt=O(),Ae=E("button"),He=E("div"),He.textContent=zt,Nt=O(),ze=E("div"),ze.textContent=It,Tt=O(),lt=E("hr"),$t=O(),Ve=E("div"),We=E("p"),We.textContent=Wt,vt=O(),we=E("div"),Oe=E("button"),Oe.textContent=Yt,bt=O(),Pe=E("button"),Re.c(),Mt=O(),De=E("button"),De.textContent=Zt,Ot=O(),pe=E("button"),Ye=E("span"),Ye.textContent=Jt,yt=O(),Et=be(ct),Dt=O(),St=E("hr"),Lt=O(),qe=E("div"),Fe=E("div"),Be=E("div"),Ze=E("span"),Ze.innerHTML=Xt,c=O(),de=E("span"),Je=be(te),v=be("%"),Xe=O(),R=E("input"),Rt=O(),j=E("div"),Le=E("div"),Ue=E("span"),Ue.innerHTML=w,Kt=O(),Ge=E("span"),ft=be(ut),Vt=be("%"),qt=O(),_e=E("input"),this.h()},l(k){U&&U.l(k),t=M(k),Js(e.$$.fragment,k),s=M(k),r=y(k,"DIV",{class:!0});var n=$(r);a=y(n,"DIV",{class:!0});var u=$(a);o=y(u,"DIV",{class:!0});var f=$(o);l=y(f,"DIV",{class:!0}),$(l).forEach(N),h=M(f),d=y(f,"DIV",{class:!0});var P=$(d);g=y(P,"DIV",{class:!0}),$(g).forEach(N),P.forEach(N),f.forEach(N),C=M(u),_=y(u,"DIV",{class:!0,"data-svelte-h":!0}),G(_)!=="svelte-gujj7z"&&(_.innerHTML=D),u.forEach(N),b=M(n),S=y(n,"DIV",{class:!0});var x=$(S);A=y(x,"DIV",{class:!0});var L=$(A);me.l(L),L.forEach(N),V=M(x),F=y(x,"HR",{class:!0}),Y=M(x),K=y(x,"DIV",{class:!0});var Ne=$(K);J=y(Ne,"DIV",{class:!0});var et=$(J);ne=y(et,"P",{class:!0,"data-svelte-h":!0}),G(ne)!=="svelte-n8wn27"&&(ne.textContent=st),ae=M(et),Ee=y(et,"SPAN",{class:!0});var Vs=$(Ee);re=ve(Vs,ue),Vs.forEach(N),et.forEach(N),fe=M(Ne),oe=y(Ne,"DIV",{class:!0});var kt=$(oe);X=y(kt,"BUTTON",{class:!0});var ss=$(X);ee=y(ss,"DIV",{class:!0,"data-svelte-h":!0}),G(ee)!=="svelte-5zum88"&&(ee.textContent=Ie),Te=M(ss),q=y(ss,"DIV",{class:!0,"data-svelte-h":!0}),G(q)!=="svelte-wj3mnc"&&(q.textContent=H),ss.forEach(N),rt=M(kt),le=y(kt,"BUTTON",{class:!0});var rs=$(le);he=y(rs,"DIV",{class:!0,"data-svelte-h":!0}),G(he)!=="svelte-juoben"&&(he.textContent=$e),Me=M(rs),Se=y(rs,"DIV",{class:!0,"data-svelte-h":!0}),G(Se)!=="svelte-1hmv0u5"&&(Se.textContent=ke),rs.forEach(N),mt=M(kt),Ae=y(kt,"BUTTON",{class:!0});var is=$(Ae);He=y(is,"DIV",{class:!0,"data-svelte-h":!0}),G(He)!=="svelte-16xcjos"&&(He.textContent=zt),Nt=M(is),ze=y(is,"DIV",{class:!0,"data-svelte-h":!0}),G(ze)!=="svelte-pw8ckr"&&(ze.textContent=It),is.forEach(N),kt.forEach(N),Ne.forEach(N),Tt=M(x),lt=y(x,"HR",{class:!0}),$t=M(x),Ve=y(x,"DIV",{class:!0});var ns=$(Ve);We=y(ns,"P",{class:!0,"data-svelte-h":!0}),G(We)!=="svelte-a0ah10"&&(We.textContent=Wt),vt=M(ns),we=y(ns,"DIV",{class:!0});var At=$(we);Oe=y(At,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),G(Oe)!=="svelte-1jrm37k"&&(Oe.textContent=Yt),bt=M(At),Pe=y(At,"BUTTON",{class:!0,title:!0});var qs=$(Pe);Re.l(qs),qs.forEach(N),Mt=M(At),De=y(At,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),G(De)!=="svelte-v7g8nd"&&(De.textContent=Zt),At.forEach(N),ns.forEach(N),Ot=M(x),pe=y(x,"BUTTON",{class:!0});var as=$(pe);Ye=y(as,"SPAN",{class:!0,"data-svelte-h":!0}),G(Ye)!=="svelte-vcx5my"&&(Ye.textContent=Jt),yt=M(as),Et=ve(as,ct),as.forEach(N),Dt=M(x),St=y(x,"HR",{class:!0}),Lt=M(x),qe=y(x,"DIV",{class:!0});var os=$(qe);Fe=y(os,"DIV",{class:!0});var ls=$(Fe);Be=y(ls,"DIV",{class:!0});var cs=$(Be);Ze=y(cs,"SPAN",{class:!0,"data-svelte-h":!0}),G(Ze)!=="svelte-18oymb6"&&(Ze.innerHTML=Xt),c=M(cs),de=y(cs,"SPAN",{class:!0});var bs=$(de);Je=ve(bs,te),v=ve(bs,"%"),bs.forEach(N),cs.forEach(N),Xe=M(ls),R=y(ls,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ls.forEach(N),Rt=M(os),j=y(os,"DIV",{class:!0});var us=$(j);Le=y(us,"DIV",{class:!0});var fs=$(Le);Ue=y(fs,"SPAN",{class:!0,"data-svelte-h":!0}),G(Ue)!=="svelte-116my0g"&&(Ue.innerHTML=w),Kt=M(fs),Ge=y(fs,"SPAN",{class:!0});var xs=$(Ge);ft=ve(xs,ut),Vt=ve(xs,"%"),xs.forEach(N),fs.forEach(N),qt=M(us),_e=y(us,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),us.forEach(N),os.forEach(N),x.forEach(N),n.forEach(N),this.h()},h(){m(l,"class","absolute inset-0 bg-gradient-to-br from-primary-500/20 to-tertiary-500/20 blur-3xl -z-10 scale-110"),m(g,"class","w-full h-full board-container rounded-lg overflow-hidden"),m(d,"class","glass-strong p-4 rounded-2xl shadow-2xl glow-gold h-full"),m(o,"class","relative w-full max-w-[min(80vh,90vw)] aspect-square"),m(_,"class","absolute top-8 left-8"),m(a,"class","flex-1 flex items-center justify-center p-8 relative"),m(A,"class","glass p-6 rounded-xl space-y-3 border border-primary-500/20"),m(F,"class","border-surface-700/50"),m(ne,"class","text-xs font-semibold text-primary-400 uppercase tracking-wider"),m(Ee,"class","text-xs text-surface-500"),m(J,"class","flex items-center justify-between"),m(ee,"class","text-xl mb-1"),m(q,"class","text-xs"),m(X,"class",Ce="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(i[3].activeVibe==="noir"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")),m(he,"class","text-xl mb-1"),m(Se,"class","text-xs"),m(le,"class",Qe="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(i[3].activeVibe==="library"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")),m(He,"class","text-xl mb-1"),m(ze,"class","text-xs"),m(Ae,"class",gt="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(i[3].activeVibe==="zen"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")),m(oe,"class","grid grid-cols-3 gap-2"),m(K,"class","space-y-3"),m(lt,"class","border-surface-700/50"),m(We,"class","text-xs font-semibold text-primary-400 uppercase tracking-wider"),m(Oe,"class","btn-premium w-12 h-12 rounded-full glass hover:bg-surface-700/50 flex items-center justify-center text-xl transition-all hover:scale-110 active:scale-95"),m(Oe,"title","Previous Move"),m(Pe,"class","btn-premium w-16 h-16 rounded-full bg-primary-500 hover:bg-primary-400 flex items-center justify-center text-2xl shadow-lg shadow-primary-500/50 transition-all hover:scale-110 active:scale-95"),m(Pe,"title",xt=i[0].isPlaying?"Pause":"Play"),m(De,"class","btn-premium w-12 h-12 rounded-full glass hover:bg-surface-700/50 flex items-center justify-center text-xl transition-all hover:scale-110 active:scale-95"),m(De,"title","Next Move"),m(we,"class","flex justify-center gap-3"),m(Ve,"class","space-y-3"),m(Ye,"class","mr-2"),pe.disabled=Ct=i[0].isLoadingGame,m(pe,"class","btn-premium w-full py-3 rounded-xl glass hover:bg-surface-700/50 text-sm font-medium text-surface-300 hover:text-primary-400 transition-all disabled:opacity-50 disabled:cursor-not-allowed"),m(St,"class","border-surface-700/50"),m(Ze,"class","text-surface-400 flex items-center gap-2"),m(de,"class","text-primary-400 font-mono text-xs"),m(Be,"class","flex items-center justify-between text-sm"),m(R,"type","range"),m(R,"min","0"),m(R,"max","1"),m(R,"step","0.01"),R.value=ce=i[3].ambienceVolume,m(R,"class","w-full"),m(Fe,"class","space-y-2"),m(Ue,"class","text-surface-400 flex items-center gap-2"),m(Ge,"class","text-primary-400 font-mono text-xs"),m(Le,"class","flex items-center justify-between text-sm"),m(_e,"type","range"),m(_e,"min","0"),m(_e,"max","1"),m(_e,"step","0.01"),_e.value=ht=i[3].musicVolume,m(_e,"class","w-full"),m(j,"class","space-y-2"),m(qe,"class","space-y-5 mt-auto"),m(S,"class","w-full md:w-96 glass-strong border-l border-primary-500/10 p-8 flex flex-col gap-6 backdrop-blur-xl z-20 shadow-2xl"),m(r,"class","h-full flex flex-col md:flex-row transition-opacity duration-1000"),Fs(r,"opacity-50",i[2])},m(k,n){U&&U.m(k,n),ye(k,t,n),Zs(e,k,n),ye(k,s,n),ye(k,r,n),p(r,a),p(a,o),p(o,l),p(o,h),p(o,d),p(d,g),i[7](g),p(a,C),p(a,_),p(r,b),p(r,S),p(S,A),me.m(A,null),p(S,V),p(S,F),p(S,Y),p(S,K),p(K,J),p(J,ne),p(J,ae),p(J,Ee),p(Ee,re),p(K,fe),p(K,oe),p(oe,X),p(X,ee),p(X,Te),p(X,q),p(oe,rt),p(oe,le),p(le,he),p(le,Me),p(le,Se),p(oe,mt),p(oe,Ae),p(Ae,He),p(Ae,Nt),p(Ae,ze),p(S,Tt),p(S,lt),p(S,$t),p(S,Ve),p(Ve,We),p(Ve,vt),p(Ve,we),p(we,Oe),p(we,bt),p(we,Pe),Re.m(Pe,null),p(we,Mt),p(we,De),p(S,Ot),p(S,pe),p(pe,Ye),p(pe,yt),p(pe,Et),p(S,Dt),p(S,St),p(S,Lt),p(S,qe),p(qe,Fe),p(Fe,Be),p(Be,Ze),p(Be,c),p(Be,de),p(de,Je),p(de,v),p(Fe,Xe),p(Fe,R),p(qe,Rt),p(qe,j),p(j,Le),p(Le,Ue),p(Le,Kt),p(Le,Ge),p(Ge,ft),p(Ge,Vt),p(j,qt),p(j,_e),z=!0,Ft||(es=[je(X,"click",i[8]),je(le,"click",i[9]),je(Ae,"click",i[10]),je(Oe,"click",Wr),je(Pe,"click",Yr),je(De,"click",rr),je(pe,"click",Ks),je(R,"input",i[11]),je(_e,"input",i[12])],Ft=!0)},p(k,[n]){k[2]?U?(U.p(k,n),n&4&&Gt(U,1)):(U=Ws(k),U.c(),Gt(U,1),U.m(t.parentNode,t)):U&&(mr(),_s(U,1,1,()=>{U=null}),_r()),it===(it=Bt(k))&&me?me.p(k,n):(me.d(1),me=it(k),me&&(me.c(),me.m(A,null))),(!z||n&8)&&ue!==(ue=k[3].activeVibe+"")&&tt(re,ue),(!z||n&8&&Ce!==(Ce="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(k[3].activeVibe==="noir"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")))&&m(X,"class",Ce),(!z||n&8&&Qe!==(Qe="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(k[3].activeVibe==="library"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")))&&m(le,"class",Qe),(!z||n&8&&gt!==(gt="btn-premium px-4 py-3 rounded-xl text-sm font-medium transition-all "+(k[3].activeVibe==="zen"?"bg-primary-500 text-black shadow-lg shadow-primary-500/50":"glass hover:bg-surface-700/50 text-surface-300")))&&m(Ae,"class",gt),dt!==(dt=ts(k))&&(Re.d(1),Re=dt(k),Re&&(Re.c(),Re.m(Pe,null))),(!z||n&1&&xt!==(xt=k[0].isPlaying?"Pause":"Play"))&&m(Pe,"title",xt),(!z||n&1)&&ct!==(ct=k[0].isLoadingGame?"Loading...":"New Random Game")&&tt(Et,ct),(!z||n&1&&Ct!==(Ct=k[0].isLoadingGame))&&(pe.disabled=Ct),(!z||n&8)&&te!==(te=Math.round(k[3].ambienceVolume*100)+"")&&tt(Je,te),(!z||n&8&&ce!==(ce=k[3].ambienceVolume))&&(R.value=ce),(!z||n&8)&&ut!==(ut=Math.round(k[3].musicVolume*100)+"")&&tt(ft,ut),(!z||n&8&&ht!==(ht=k[3].musicVolume))&&(_e.value=ht),(!z||n&4)&&Fs(r,"opacity-50",k[2])},i(k){z||(Gt(U),Gt(e.$$.fragment,k),z=!0)},o(k){_s(U),_s(e.$$.fragment,k),z=!1},d(k){k&&(N(t),N(s),N(r)),U&&U.d(k),Ys(e,k),i[7](null),me.d(),Re.d(),Ft=!1,hr(es)}}}function li(i,t,e){let s,r;Ps(i,Ke,A=>e(0,s=A)),Ps(i,er,A=>e(3,r=A));let a,o,l=!0;function h(){e(2,l=!1),xr()}function d(A){yr(A)}dr(async()=>{const{Chessboard:A,BORDER_TYPE:V}=await lr(async()=>{const{Chessboard:F,BORDER_TYPE:Y}=await import("../chunks/B02hmuqp.js");return{Chessboard:F,BORDER_TYPE:Y}},[],import.meta.url);e(6,o=new A(a,{position:s.fen,style:{cssClass:"default",showCoordinates:!0,borderType:V.none},responsive:!0,animationDuration:300,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}}))}),pr(()=>{o&&o.destroy()});function g(A){Ns[A?"unshift":"push"](()=>{a=A,e(1,a)})}const C=()=>d("noir"),_=()=>d("library"),D=()=>d("zen"),b=A=>vr(A.currentTarget.valueAsNumber),S=A=>br(A.currentTarget.valueAsNumber);return i.$$.update=()=>{i.$$.dirty&65&&o&&s.fen&&o.setPosition(s.fen,!0)},[s,a,l,r,h,d,o,g,C,_,D,b,S]}class _i extends Ls{constructor(t){super(),Rs(this,t,li,oi,Ds,{})}}export{_i as component};
