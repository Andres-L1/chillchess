var hs=Object.defineProperty;var cs=(f,t,e)=>t in f?hs(f,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):f[t]=e;var k=(f,t,e)=>cs(f,typeof t!="symbol"?t+"":t,e);import{_ as us}from"../chunks/C1FmrZbK.js";import{s as ps,n as be,o as _s,d as gs,b as ds}from"../chunks/APMyDZsm.js";import{S as ms,i as vs,d as ee,a as bs,b as H,w as Y,c as z,e as le,g as tt,y as st,h as Z,j as it}from"../chunks/B77H-00_.js";function Es(f){return f!==null?{comment:f,variations:[]}:{variations:[]}}function Cs(f,t,e,s,r){const n={move:f,variations:r};return t&&(n.suffix=t),e&&(n.nag=e),s!==null&&(n.comment=s),n}function Ss(...f){const[t,...e]=f;let s=t;for(const r of e)r!==null&&(s.variations=[r,...r.variations],r.variations=[],s=r);return t}function ys(f,t){if(t.marker&&t.marker.comment){let e=t.root;for(;;){const s=e.variations[0];if(!s){e.comment=t.marker.comment;break}e=s}}return{headers:f,root:t.root,result:(t.marker&&t.marker.result)??void 0}}function As(f,t){function e(){this.constructor=f}e.prototype=t.prototype,f.prototype=new e}function J(f,t,e,s){var r=Error.call(this,f);return Object.setPrototypeOf&&Object.setPrototypeOf(r,J.prototype),r.expected=t,r.found=e,r.location=s,r.name="SyntaxError",r}As(J,Error);function Ee(f,t,e){return e=e||" ",f.length>t?f:(t-=f.length,e+=e.repeat(t),f+e.slice(0,t))}J.prototype.format=function(f){var t="Error: "+this.message;if(this.location){var e=null,s;for(s=0;s<f.length;s++)if(f[s].source===this.location.source){e=f[s].text.split(/\r\n|\n|\r/g);break}var r=this.location.start,n=this.location.source&&typeof this.location.source.offset=="function"?this.location.source.offset(r):r,c=this.location.source+":"+n.line+":"+n.column;if(e){var h=this.location.end,u=Ee("",n.line.toString().length," "),p=e[r.line-1],d=r.line===h.line?h.column:p.length+1,b=d-r.column||1;t+=`
 --> `+c+`
`+u+` |
`+n.line+" | "+p+`
`+u+" | "+Ee("",r.column-1," ")+Ee("",b,"^")}else t+=`
 at `+c}return t};J.buildMessage=function(f,t){var e={literal:function(p){return'"'+r(p.text)+'"'},class:function(p){var d=p.parts.map(function(b){return Array.isArray(b)?n(b[0])+"-"+n(b[1]):n(b)});return"["+(p.inverted?"^":"")+d.join("")+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(p){return p.description}};function s(p){return p.charCodeAt(0).toString(16).toUpperCase()}function r(p){return p.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function n(p){return p.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(d){return"\\x0"+s(d)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(d){return"\\x"+s(d)})}function c(p){return e[p.type](p)}function h(p){var d=p.map(c),b,_;if(d.sort(),d.length>0){for(b=1,_=1;b<d.length;b++)d[b-1]!==d[b]&&(d[_]=d[b],_++);d.length=_}switch(d.length){case 1:return d[0];case 2:return d[0]+" or "+d[1];default:return d.slice(0,-1).join(", ")+", or "+d[d.length-1]}}function u(p){return p?'"'+r(p)+'"':"end of input"}return"Expected "+h(f)+" but "+u(t)+" found."};function $s(f,t){t=t!==void 0?t:{};var e={},s=t.grammarSource,r={pgn:Ye},n=Ye,c="[",h='"',u="]",p=".",d="O-O-O",b="O-O",_="0-0-0",$="0-0",E="$",x="{",w="}",F=";",_e="(",ge=")",Te="1-0",Pe="0-1",Ne="1/2-1/2",ft="*",de=/^[a-zA-Z]/,Ie=/^[^"]/,re=/^[0-9]/,Oe=/^[.]/,Me=/^[a-zA-Z1-8\-=]/,ht=/^[+#]/,Ke=/^[!?]/,Le=/^[^}]/,Re=/^[^\r\n]/,qe=/^[ \t\r\n]/,ct=R("tag pair"),ut=N("[",!1),De=N('"',!1),pt=N("]",!1),_t=R("tag name"),me=D([["a","z"],["A","Z"]],!1,!1),gt=R("tag value"),Fe=D(['"'],!0,!1),dt=R("move number"),ne=D([["0","9"]],!1,!1),mt=N(".",!1),Ue=D(["."],!1,!1),vt=R("standard algebraic notation"),bt=N("O-O-O",!1),Et=N("O-O",!1),Ct=N("0-0-0",!1),St=N("0-0",!1),Be=D([["a","z"],["A","Z"],["1","8"],"-","="],!1,!1),yt=D(["+","#"],!1,!1),At=R("suffix annotation"),Qe=D(["!","?"],!1,!1),$t=R("NAG"),kt=N("$",!1),wt=R("brace comment"),xt=N("{",!1),je=D(["}"],!0,!1),Tt=N("}",!1),Pt=R("rest of line comment"),Nt=N(";",!1),He=D(["\r",`
`],!0,!1),It=R("variation"),Ot=N("(",!1),Mt=N(")",!1),Kt=R("game termination marker"),Lt=N("1-0",!1),Rt=N("0-1",!1),qt=N("1/2-1/2",!1),Dt=N("*",!1),Ft=R("whitespace"),Ve=D([" ","	","\r",`
`],!1,!1),Ut=function(i,o){return ys(i,o)},Bt=function(i){return Object.fromEntries(i)},Qt=function(i,o){return[i,o]},jt=function(i,o){return{root:i,marker:o}},Ht=function(i,o){return Ss(Es(i),...o.flat())},Vt=function(i,o,l,v,C){return Cs(i,o,l,v,C)},Gt=function(i){return i},Wt=function(i){return i.replace(/[\r\n]+/g," ")},Yt=function(i){return i.trim()},zt=function(i){return i},Zt=function(i,o){return{result:i,comment:o}},a=t.peg$currPos|0,W=[{line:1,column:1}],q=a,ae=t.peg$maxFailExpected||[],g=t.peg$silentFails|0,X;if(t.startRule){if(!(t.startRule in r))throw new Error(`Can't start parsing from rule "`+t.startRule+'".');n=r[t.startRule]}function N(i,o){return{type:"literal",text:i,ignoreCase:o}}function D(i,o,l){return{type:"class",parts:i,inverted:o,ignoreCase:l}}function Jt(){return{type:"end"}}function R(i){return{type:"other",description:i}}function Ge(i){var o=W[i],l;if(o)return o;if(i>=W.length)l=W.length-1;else for(l=i;!W[--l];);for(o=W[l],o={line:o.line,column:o.column};l<i;)f.charCodeAt(l)===10?(o.line++,o.column=1):o.column++,l++;return W[i]=o,o}function We(i,o,l){var v=Ge(i),C=Ge(o),A={source:s,start:{offset:i,line:v.line,column:v.column},end:{offset:o,line:C.line,column:C.column}};return A}function m(i){a<q||(a>q&&(q=a,ae=[]),ae.push(i))}function Xt(i,o,l){return new J(J.buildMessage(i,o),i,o,l)}function Ye(){var i,o,l;return i=a,o=es(),l=is(),i=Ut(o,l),i}function es(){var i,o,l;for(i=a,o=[],l=ze();l!==e;)o.push(l),l=ze();return l=K(),i=Bt(o),i}function ze(){var i,o,l,v,C,A,j;return g++,i=a,K(),f.charCodeAt(a)===91?(o=c,a++):(o=e,g===0&&m(ut)),o!==e?(K(),l=ts(),l!==e?(K(),f.charCodeAt(a)===34?(v=h,a++):(v=e,g===0&&m(De)),v!==e?(C=ss(),f.charCodeAt(a)===34?(A=h,a++):(A=e,g===0&&m(De)),A!==e?(K(),f.charCodeAt(a)===93?(j=u,a++):(j=e,g===0&&m(pt)),j!==e?i=Qt(l,C):(a=i,i=e)):(a=i,i=e)):(a=i,i=e)):(a=i,i=e)):(a=i,i=e),g--,i===e&&g===0&&m(ct),i}function ts(){var i,o,l;if(g++,i=a,o=[],l=f.charAt(a),de.test(l)?a++:(l=e,g===0&&m(me)),l!==e)for(;l!==e;)o.push(l),l=f.charAt(a),de.test(l)?a++:(l=e,g===0&&m(me));else o=e;return o!==e?i=f.substring(i,a):i=o,g--,i===e&&(o=e,g===0&&m(_t)),i}function ss(){var i,o,l;for(g++,i=a,o=[],l=f.charAt(a),Ie.test(l)?a++:(l=e,g===0&&m(Fe));l!==e;)o.push(l),l=f.charAt(a),Ie.test(l)?a++:(l=e,g===0&&m(Fe));return i=f.substring(i,a),g--,o=e,g===0&&m(gt),i}function is(){var i,o,l;return i=a,o=Ze(),K(),l=fs(),l===e&&(l=null),K(),i=jt(o,l),i}function Ze(){var i,o,l,v;for(i=a,o=ve(),o===e&&(o=null),l=[],v=Je();v!==e;)l.push(v),v=Je();return i=Ht(o,l),i}function Je(){var i,o,l,v,C,A,j,oe;if(i=a,K(),rs(),K(),o=ns(),o!==e){for(l=as(),l===e&&(l=null),v=[],C=Xe();C!==e;)v.push(C),C=Xe();for(C=K(),A=ve(),A===e&&(A=null),j=[],oe=et();oe!==e;)j.push(oe),oe=et();i=Vt(o,l,v,A,j)}else a=i,i=e;return i}function rs(){var i,o,l,v,C,A;for(g++,i=a,o=[],l=f.charAt(a),re.test(l)?a++:(l=e,g===0&&m(ne));l!==e;)o.push(l),l=f.charAt(a),re.test(l)?a++:(l=e,g===0&&m(ne));if(f.charCodeAt(a)===46?(l=p,a++):(l=e,g===0&&m(mt)),l!==e){for(v=K(),C=[],A=f.charAt(a),Oe.test(A)?a++:(A=e,g===0&&m(Ue));A!==e;)C.push(A),A=f.charAt(a),Oe.test(A)?a++:(A=e,g===0&&m(Ue));o=[o,l,v,C],i=o}else a=i,i=e;return g--,i===e&&(o=e,g===0&&m(dt)),i}function ns(){var i,o,l,v,C,A;if(g++,i=a,o=a,f.substr(a,5)===d?(l=d,a+=5):(l=e,g===0&&m(bt)),l===e&&(f.substr(a,3)===b?(l=b,a+=3):(l=e,g===0&&m(Et)),l===e&&(f.substr(a,5)===_?(l=_,a+=5):(l=e,g===0&&m(Ct)),l===e&&(f.substr(a,3)===$?(l=$,a+=3):(l=e,g===0&&m(St)),l===e))))if(l=a,v=f.charAt(a),de.test(v)?a++:(v=e,g===0&&m(me)),v!==e){if(C=[],A=f.charAt(a),Me.test(A)?a++:(A=e,g===0&&m(Be)),A!==e)for(;A!==e;)C.push(A),A=f.charAt(a),Me.test(A)?a++:(A=e,g===0&&m(Be));else C=e;C!==e?(v=[v,C],l=v):(a=l,l=e)}else a=l,l=e;return l!==e?(v=f.charAt(a),ht.test(v)?a++:(v=e,g===0&&m(yt)),v===e&&(v=null),l=[l,v],o=l):(a=o,o=e),o!==e?i=f.substring(i,a):i=o,g--,i===e&&(o=e,g===0&&m(vt)),i}function as(){var i,o,l;for(g++,i=a,o=[],l=f.charAt(a),Ke.test(l)?a++:(l=e,g===0&&m(Qe));l!==e;)o.push(l),o.length>=2?l=e:(l=f.charAt(a),Ke.test(l)?a++:(l=e,g===0&&m(Qe)));return o.length<1?(a=i,i=e):i=o,g--,i===e&&(o=e,g===0&&m(At)),i}function Xe(){var i,o,l,v,C;if(g++,i=a,K(),f.charCodeAt(a)===36?(o=E,a++):(o=e,g===0&&m(kt)),o!==e){if(l=a,v=[],C=f.charAt(a),re.test(C)?a++:(C=e,g===0&&m(ne)),C!==e)for(;C!==e;)v.push(C),C=f.charAt(a),re.test(C)?a++:(C=e,g===0&&m(ne));else v=e;v!==e?l=f.substring(l,a):l=v,l!==e?i=Gt(l):(a=i,i=e)}else a=i,i=e;return g--,i===e&&g===0&&m($t),i}function ve(){var i;return i=os(),i===e&&(i=ls()),i}function os(){var i,o,l,v,C;if(g++,i=a,f.charCodeAt(a)===123?(o=x,a++):(o=e,g===0&&m(xt)),o!==e){for(l=a,v=[],C=f.charAt(a),Le.test(C)?a++:(C=e,g===0&&m(je));C!==e;)v.push(C),C=f.charAt(a),Le.test(C)?a++:(C=e,g===0&&m(je));l=f.substring(l,a),f.charCodeAt(a)===125?(v=w,a++):(v=e,g===0&&m(Tt)),v!==e?i=Wt(l):(a=i,i=e)}else a=i,i=e;return g--,i===e&&(o=e,g===0&&m(wt)),i}function ls(){var i,o,l,v,C;if(g++,i=a,f.charCodeAt(a)===59?(o=F,a++):(o=e,g===0&&m(Nt)),o!==e){for(l=a,v=[],C=f.charAt(a),Re.test(C)?a++:(C=e,g===0&&m(He));C!==e;)v.push(C),C=f.charAt(a),Re.test(C)?a++:(C=e,g===0&&m(He));l=f.substring(l,a),i=Yt(l)}else a=i,i=e;return g--,i===e&&(o=e,g===0&&m(Pt)),i}function et(){var i,o,l,v;return g++,i=a,K(),f.charCodeAt(a)===40?(o=_e,a++):(o=e,g===0&&m(Ot)),o!==e?(l=Ze(),l!==e?(K(),f.charCodeAt(a)===41?(v=ge,a++):(v=e,g===0&&m(Mt)),v!==e?i=zt(l):(a=i,i=e)):(a=i,i=e)):(a=i,i=e),g--,i===e&&g===0&&m(It),i}function fs(){var i,o,l;return g++,i=a,f.substr(a,3)===Te?(o=Te,a+=3):(o=e,g===0&&m(Lt)),o===e&&(f.substr(a,3)===Pe?(o=Pe,a+=3):(o=e,g===0&&m(Rt)),o===e&&(f.substr(a,7)===Ne?(o=Ne,a+=7):(o=e,g===0&&m(qt)),o===e&&(f.charCodeAt(a)===42?(o=ft,a++):(o=e,g===0&&m(Dt))))),o!==e?(K(),l=ve(),l===e&&(l=null),i=Zt(o,l)):(a=i,i=e),g--,i===e&&(o=e,g===0&&m(Kt)),i}function K(){var i,o;for(g++,i=[],o=f.charAt(a),qe.test(o)?a++:(o=e,g===0&&m(Ve));o!==e;)i.push(o),o=f.charAt(a),qe.test(o)?a++:(o=e,g===0&&m(Ve));return g--,o=e,g===0&&m(Ft),i}if(X=n(),t.peg$library)return{peg$result:X,peg$currPos:a,peg$FAILED:e,peg$maxFailExpected:ae,peg$maxFailPos:q};if(X!==e&&a===f.length)return X;throw X!==e&&a<f.length&&m(Jt()),Xt(ae,q<f.length?f.charAt(q):null,q<f.length?We(q,q+1):We(q,q))}/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const ce=0xffffffffffffffffn;function Ce(f,t){return(f<<t|f>>64n-t)&0xffffffffffffffffn}function rt(f,t){return f*t&ce}function ks(f){return function(){let t=BigInt(f&ce),e=BigInt(f>>64n&ce);const s=rt(Ce(rt(t,5n),7n),9n);return e^=t,t=(Ce(t,24n)^e^e<<16n)&ce,e=Ce(e,37n),f=e<<64n|t,s}}const pe=ks(0xa187eb39cdcaed8f31c4b365b102e01en),ws=Array.from({length:2},()=>Array.from({length:6},()=>Array.from({length:128},()=>pe()))),xs=Array.from({length:8},()=>pe()),Ts=Array.from({length:16},()=>pe()),Se=pe(),M="w",L="b",T="p",we="n",ue="b",se="r",Q="q",P="k",ye="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class fe{constructor(t,e){k(this,"color");k(this,"from");k(this,"to");k(this,"piece");k(this,"captured");k(this,"promotion");k(this,"flags");k(this,"san");k(this,"lan");k(this,"before");k(this,"after");const{color:s,piece:r,from:n,to:c,flags:h,captured:u,promotion:p}=e,d=I(n),b=I(c);this.color=s,this.piece=r,this.from=d,this.to=b,this.san=t._moveToSan(e,t._moves({legal:!0})),this.lan=d+b,this.before=t.fen(),t._makeMove(e),this.after=t.fen(),t._undoMove(),this.flags="";for(const _ in y)y[_]&h&&(this.flags+=V[_]);u&&(this.captured=u),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(V.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(V.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(V.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(V.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(V.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(V.BIG_PAWN)>-1}}const O=-1,V={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q",NULL_MOVE:"-"},y={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64,NULL_MOVE:128},xe={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},Ps={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},Ns={...xe,...Ps},S={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},Ae={b:[16,32,17,15],w:[-16,-32,-17,-15]},nt={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},Is=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],Os=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],Ms={p:1,n:2,b:4,r:8,q:16,k:32},Ks="pnbrqkPNBRQK",at=[we,ue,se,Q],Ls=7,Rs=6,qs=1,Ds=0,he={[P]:y.KSIDE_CASTLE,[Q]:y.QSIDE_CASTLE},U={w:[{square:S.a1,flag:y.QSIDE_CASTLE},{square:S.h1,flag:y.KSIDE_CASTLE}],b:[{square:S.a8,flag:y.QSIDE_CASTLE},{square:S.h8,flag:y.KSIDE_CASTLE}]},Fs={b:qs,w:Rs},$e="--";function G(f){return f>>4}function ie(f){return f&15}function lt(f){return"0123456789".indexOf(f)!==-1}function I(f){const t=ie(f),e=G(f);return"abcdefgh".substring(t,t+1)+"87654321".substring(e,e+1)}function te(f){return f===M?L:M}function Us(f){const t=f.split(/\s+/);if(t.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const e=parseInt(t[5],10);if(isNaN(e)||e<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const s=parseInt(t[4],10);if(isNaN(s)||s<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(t[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(t[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(t[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const r=t[0].split("/");if(r.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let c=0;c<r.length;c++){let h=0,u=!1;for(let p=0;p<r[c].length;p++)if(lt(r[c][p])){if(u)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};h+=parseInt(r[c][p],10),u=!0}else{if(!/^[prnbqkPRNBQK]$/.test(r[c][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};h+=1,u=!1}if(h!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(t[3][1]=="3"&&t[1]=="w"||t[3][1]=="6"&&t[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const n=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:c,regex:h}of n){if(!h.test(t[0]))return{ok:!1,error:`Invalid FEN: missing ${c} king`};if((t[0].match(h)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${c} kings`}}return Array.from(r[0]+r[7]).some(c=>c.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function Bs(f,t){const e=f.from,s=f.to,r=f.piece;let n=0,c=0,h=0;for(let u=0,p=t.length;u<p;u++){const d=t[u].from,b=t[u].to,_=t[u].piece;r===_&&e!==d&&s===b&&(n++,G(e)===G(d)&&c++,ie(e)===ie(d)&&h++)}return n>0?c>0&&h>0?I(e):h>0?I(e).charAt(1):I(e).charAt(0):""}function B(f,t,e,s,r,n=void 0,c=y.NORMAL){const h=G(s);if(r===T&&(h===Ls||h===Ds))for(let u=0;u<at.length;u++){const p=at[u];f.push({color:t,from:e,to:s,piece:r,captured:n,promotion:p,flags:c|y.PROMOTION})}else f.push({color:t,from:e,to:s,piece:r,captured:n,flags:c})}function ot(f){let t=f.charAt(0);return t>="a"&&t<="h"?f.match(/[a-h]\d.*[a-h]\d/)?void 0:T:(t=t.toLowerCase(),t==="o"?P:t)}function ke(f){return f.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}class Qs{constructor(t=ye,{skipValidation:e=!1}={}){k(this,"_board",new Array(128));k(this,"_turn",M);k(this,"_header",{});k(this,"_kings",{w:O,b:O});k(this,"_epSquare",-1);k(this,"_halfMoves",0);k(this,"_moveNumber",0);k(this,"_history",[]);k(this,"_comments",{});k(this,"_castling",{w:0,b:0});k(this,"_hash",0n);k(this,"_positionCount",new Map);this.load(t,{skipValidation:e})}clear({preserveHeaders:t=!1}={}){this._board=new Array(128),this._kings={w:O,b:O},this._turn=M,this._castling={w:0,b:0},this._epSquare=O,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=t?this._header:{...Ns},this._hash=this._computeHash(),this._positionCount=new Map,this._header.SetUp=null,this._header.FEN=null}load(t,{skipValidation:e=!1,preserveHeaders:s=!1}={}){let r=t.split(/\s+/);if(r.length>=2&&r.length<6){const h=["-","-","0","1"];t=r.concat(h.slice(-(6-r.length))).join(" ")}if(r=t.split(/\s+/),!e){const{ok:h,error:u}=Us(t);if(!h)throw new Error(u)}const n=r[0];let c=0;this.clear({preserveHeaders:s});for(let h=0;h<n.length;h++){const u=n.charAt(h);if(u==="/")c+=8;else if(lt(u))c+=parseInt(u,10);else{const p=u<"a"?M:L;this._put({type:u.toLowerCase(),color:p},I(c)),c++}}this._turn=r[1],r[2].indexOf("K")>-1&&(this._castling.w|=y.KSIDE_CASTLE),r[2].indexOf("Q")>-1&&(this._castling.w|=y.QSIDE_CASTLE),r[2].indexOf("k")>-1&&(this._castling.b|=y.KSIDE_CASTLE),r[2].indexOf("q")>-1&&(this._castling.b|=y.QSIDE_CASTLE),this._epSquare=r[3]==="-"?O:S[r[3]],this._halfMoves=parseInt(r[4],10),this._moveNumber=parseInt(r[5],10),this._hash=this._computeHash(),this._updateSetup(t),this._incPositionCount()}fen({forceEnpassantSquare:t=!1}={}){var c,h;let e=0,s="";for(let u=S.a8;u<=S.h1;u++){if(this._board[u]){e>0&&(s+=e,e=0);const{color:p,type:d}=this._board[u];s+=p===M?d.toUpperCase():d.toLowerCase()}else e++;u+1&136&&(e>0&&(s+=e),u!==S.h1&&(s+="/"),e=0,u+=8)}let r="";this._castling[M]&y.KSIDE_CASTLE&&(r+="K"),this._castling[M]&y.QSIDE_CASTLE&&(r+="Q"),this._castling[L]&y.KSIDE_CASTLE&&(r+="k"),this._castling[L]&y.QSIDE_CASTLE&&(r+="q"),r=r||"-";let n="-";if(this._epSquare!==O)if(t)n=I(this._epSquare);else{const u=this._epSquare+(this._turn===M?16:-16),p=[u+1,u-1];for(const d of p){if(d&136)continue;const b=this._turn;if(((c=this._board[d])==null?void 0:c.color)===b&&((h=this._board[d])==null?void 0:h.type)===T){this._makeMove({color:b,from:d,to:this._epSquare,piece:T,captured:T,flags:y.EP_CAPTURE});const _=!this._isKingAttacked(b);if(this._undoMove(),_){n=I(this._epSquare);break}}}}return[s,this._turn,r,n,this._halfMoves,this._moveNumber].join(" ")}_pieceKey(t){if(!this._board[t])return 0n;const{color:e,type:s}=this._board[t],r={w:0,b:1}[e],n={p:0,n:1,b:2,r:3,q:4,k:5}[s];return ws[r][n][t]}_epKey(){return this._epSquare===O?0n:xs[this._epSquare&7]}_castlingKey(){const t=this._castling.w>>5|this._castling.b>>3;return Ts[t]}_computeHash(){let t=0n;for(let e=S.a8;e<=S.h1;e++){if(e&136){e+=7;continue}this._board[e]&&(t^=this._pieceKey(e))}return t^=this._epKey(),t^=this._castlingKey(),this._turn==="b"&&(t^=Se),t}_updateSetup(t){this._history.length>0||(t!==ye?(this._header.SetUp="1",this._header.FEN=t):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(ye)}get(t){return this._board[S[t]]}findPiece(t){var s;const e=[];for(let r=S.a8;r<=S.h1;r++){if(r&136){r+=7;continue}!this._board[r]||((s=this._board[r])==null?void 0:s.color)!==t.color||this._board[r].color===t.color&&this._board[r].type===t.type&&e.push(I(r))}return e}put({type:t,color:e},s){return this._put({type:t,color:e},s)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_set(t,e){this._hash^=this._pieceKey(t),this._board[t]=e,this._hash^=this._pieceKey(t)}_put({type:t,color:e},s){if(Ks.indexOf(t.toLowerCase())===-1||!(s in S))return!1;const r=S[s];if(t==P&&!(this._kings[e]==O||this._kings[e]==r))return!1;const n=this._board[r];return n&&n.type===P&&(this._kings[n.color]=O),this._set(r,{type:t,color:e}),t===P&&(this._kings[e]=r),!0}_clear(t){this._hash^=this._pieceKey(t),delete this._board[t]}remove(t){const e=this.get(t);return this._clear(S[t]),e&&e.type===P&&(this._kings[e.color]=O),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),e}_updateCastlingRights(){var s,r,n,c,h,u,p,d,b,_,$,E;this._hash^=this._castlingKey();const t=((s=this._board[S.e1])==null?void 0:s.type)===P&&((r=this._board[S.e1])==null?void 0:r.color)===M,e=((n=this._board[S.e8])==null?void 0:n.type)===P&&((c=this._board[S.e8])==null?void 0:c.color)===L;(!t||((h=this._board[S.a1])==null?void 0:h.type)!==se||((u=this._board[S.a1])==null?void 0:u.color)!==M)&&(this._castling.w&=-65),(!t||((p=this._board[S.h1])==null?void 0:p.type)!==se||((d=this._board[S.h1])==null?void 0:d.color)!==M)&&(this._castling.w&=-33),(!e||((b=this._board[S.a8])==null?void 0:b.type)!==se||((_=this._board[S.a8])==null?void 0:_.color)!==L)&&(this._castling.b&=-65),(!e||(($=this._board[S.h8])==null?void 0:$.type)!==se||((E=this._board[S.h8])==null?void 0:E.color)!==L)&&(this._castling.b&=-33),this._hash^=this._castlingKey()}_updateEnPassantSquare(){var n,c;if(this._epSquare===O)return;const t=this._epSquare+(this._turn===M?-16:16),e=this._epSquare+(this._turn===M?16:-16),s=[e+1,e-1];if(this._board[t]!==null||this._board[this._epSquare]!==null||((n=this._board[e])==null?void 0:n.color)!==te(this._turn)||((c=this._board[e])==null?void 0:c.type)!==T){this._hash^=this._epKey(),this._epSquare=O;return}const r=h=>{var u,p;return!(h&136)&&((u=this._board[h])==null?void 0:u.color)===this._turn&&((p=this._board[h])==null?void 0:p.type)===T};s.some(r)||(this._hash^=this._epKey(),this._epSquare=O)}_attacked(t,e,s){const r=[];for(let n=S.a8;n<=S.h1;n++){if(n&136){n+=7;continue}if(this._board[n]===void 0||this._board[n].color!==t)continue;const c=this._board[n],h=n-e;if(h===0)continue;const u=h+119;if(Is[u]&Ms[c.type]){if(c.type===T){if(h>0&&c.color===M||h<=0&&c.color===L)if(s)r.push(I(n));else return!0;continue}if(c.type==="n"||c.type==="k")if(s){r.push(I(n));continue}else return!0;const p=Os[u];let d=n+p,b=!1;for(;d!==e;){if(this._board[d]!=null){b=!0;break}d+=p}if(!b)if(s){r.push(I(n));continue}else return!0}}return s?r:!1}attackers(t,e){return e?this._attacked(e,S[t],!0):this._attacked(this._turn,S[t],!0)}_isKingAttacked(t){const e=this._kings[t];return e===-1?!1:this._attacked(te(t),e)}hash(){return this._hash.toString(16)}isAttacked(t,e){return this._attacked(e,S[t])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const t={b:0,n:0,r:0,q:0,k:0,p:0},e=[];let s=0,r=0;for(let n=S.a8;n<=S.h1;n++){if(r=(r+1)%2,n&136){n+=7;continue}const c=this._board[n];c&&(t[c.type]=c.type in t?t[c.type]+1:1,c.type===ue&&e.push(r),s++)}if(s===2)return!0;if(s===3&&(t[ue]===1||t[we]===1))return!0;if(s===t[ue]+2){let n=0;const c=e.length;for(let h=0;h<c;h++)n+=e[h];if(n===0||n===c)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this._hash)>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isDraw()}moves({verbose:t=!1,square:e=void 0,piece:s=void 0}={}){const r=this._moves({square:e,piece:s});return t?r.map(n=>new fe(this,n)):r.map(n=>this._moveToSan(n,r))}_moves({legal:t=!0,piece:e=void 0,square:s=void 0}={}){var $;const r=s?s.toLowerCase():void 0,n=e==null?void 0:e.toLowerCase(),c=[],h=this._turn,u=te(h);let p=S.a8,d=S.h1,b=!1;if(r)if(r in S)p=d=S[r],b=!0;else return[];for(let E=p;E<=d;E++){if(E&136){E+=7;continue}if(!this._board[E]||this._board[E].color===u)continue;const{type:x}=this._board[E];let w;if(x===T){if(n&&n!==x)continue;w=E+Ae[h][0],this._board[w]||(B(c,h,E,w,T),w=E+Ae[h][1],Fs[h]===G(E)&&!this._board[w]&&B(c,h,E,w,T,void 0,y.BIG_PAWN));for(let F=2;F<4;F++)w=E+Ae[h][F],!(w&136)&&((($=this._board[w])==null?void 0:$.color)===u?B(c,h,E,w,T,this._board[w].type,y.CAPTURE):w===this._epSquare&&B(c,h,E,w,T,T,y.EP_CAPTURE))}else{if(n&&n!==x)continue;for(let F=0,_e=nt[x].length;F<_e;F++){const ge=nt[x][F];for(w=E;w+=ge,!(w&136);){if(!this._board[w])B(c,h,E,w,x);else{if(this._board[w].color===h)break;B(c,h,E,w,x,this._board[w].type,y.CAPTURE);break}if(x===we||x===P)break}}}}if((n===void 0||n===P)&&(!b||d===this._kings[h])){if(this._castling[h]&y.KSIDE_CASTLE){const E=this._kings[h],x=E+2;!this._board[E+1]&&!this._board[x]&&!this._attacked(u,this._kings[h])&&!this._attacked(u,E+1)&&!this._attacked(u,x)&&B(c,h,this._kings[h],x,P,void 0,y.KSIDE_CASTLE)}if(this._castling[h]&y.QSIDE_CASTLE){const E=this._kings[h],x=E-2;!this._board[E-1]&&!this._board[E-2]&&!this._board[E-3]&&!this._attacked(u,this._kings[h])&&!this._attacked(u,E-1)&&!this._attacked(u,x)&&B(c,h,this._kings[h],x,P,void 0,y.QSIDE_CASTLE)}}if(!t||this._kings[h]===-1)return c;const _=[];for(let E=0,x=c.length;E<x;E++)this._makeMove(c[E]),this._isKingAttacked(h)||_.push(c[E]),this._undoMove();return _}move(t,{strict:e=!1}={}){let s=null;if(typeof t=="string")s=this._moveFromSan(t,e);else if(t===null)s=this._moveFromSan($e,e);else if(typeof t=="object"){const n=this._moves();for(let c=0,h=n.length;c<h;c++)if(t.from===I(n[c].from)&&t.to===I(n[c].to)&&(!("promotion"in n[c])||t.promotion===n[c].promotion)){s=n[c];break}}if(!s)throw typeof t=="string"?new Error(`Invalid move: ${t}`):new Error(`Invalid move: ${JSON.stringify(t)}`);if(this.isCheck()&&s.flags&y.NULL_MOVE)throw new Error("Null move not allowed when in check");const r=new fe(this,s);return this._makeMove(s),this._incPositionCount(),r}_push(t){this._history.push({move:t,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_movePiece(t,e){this._hash^=this._pieceKey(t),this._board[e]=this._board[t],delete this._board[t],this._hash^=this._pieceKey(e)}_makeMove(t){var r,n,c,h;const e=this._turn,s=te(e);if(this._push(t),t.flags&y.NULL_MOVE){e===L&&this._moveNumber++,this._halfMoves++,this._turn=s,this._epSquare=O;return}if(this._hash^=this._epKey(),this._hash^=this._castlingKey(),t.captured&&(this._hash^=this._pieceKey(t.to)),this._movePiece(t.from,t.to),t.flags&y.EP_CAPTURE&&(this._turn===L?this._clear(t.to-16):this._clear(t.to+16)),t.promotion&&(this._clear(t.to),this._set(t.to,{type:t.promotion,color:e})),this._board[t.to].type===P){if(this._kings[e]=t.to,t.flags&y.KSIDE_CASTLE){const u=t.to-1,p=t.to+1;this._movePiece(p,u)}else if(t.flags&y.QSIDE_CASTLE){const u=t.to+1,p=t.to-2;this._movePiece(p,u)}this._castling[e]=0}if(this._castling[e]){for(let u=0,p=U[e].length;u<p;u++)if(t.from===U[e][u].square&&this._castling[e]&U[e][u].flag){this._castling[e]^=U[e][u].flag;break}}if(this._castling[s]){for(let u=0,p=U[s].length;u<p;u++)if(t.to===U[s][u].square&&this._castling[s]&U[s][u].flag){this._castling[s]^=U[s][u].flag;break}}if(this._hash^=this._castlingKey(),t.flags&y.BIG_PAWN){let u;e===L?u=t.to-16:u=t.to+16,!(t.to-1&136)&&((r=this._board[t.to-1])==null?void 0:r.type)===T&&((n=this._board[t.to-1])==null?void 0:n.color)===s||!(t.to+1&136)&&((c=this._board[t.to+1])==null?void 0:c.type)===T&&((h=this._board[t.to+1])==null?void 0:h.color)===s?(this._epSquare=u,this._hash^=this._epKey()):this._epSquare=O}else this._epSquare=O;t.piece===T?this._halfMoves=0:t.flags&(y.CAPTURE|y.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,e===L&&this._moveNumber++,this._turn=s,this._hash^=Se}undo(){const t=this._hash,e=this._undoMove();if(e){const s=new fe(this,e);return this._decPositionCount(t),s}return null}_undoMove(){const t=this._history.pop();if(t===void 0)return null;this._hash^=this._epKey(),this._hash^=this._castlingKey();const e=t.move;this._kings=t.kings,this._turn=t.turn,this._castling=t.castling,this._epSquare=t.epSquare,this._halfMoves=t.halfMoves,this._moveNumber=t.moveNumber,this._hash^=this._epKey(),this._hash^=this._castlingKey(),this._hash^=Se;const s=this._turn,r=te(s);if(e.flags&y.NULL_MOVE)return e;if(this._movePiece(e.to,e.from),e.piece&&(this._clear(e.from),this._set(e.from,{type:e.piece,color:s})),e.captured)if(e.flags&y.EP_CAPTURE){let n;s===L?n=e.to-16:n=e.to+16,this._set(n,{type:T,color:r})}else this._set(e.to,{type:e.captured,color:r});if(e.flags&(y.KSIDE_CASTLE|y.QSIDE_CASTLE)){let n,c;e.flags&y.KSIDE_CASTLE?(n=e.to+1,c=e.to-1):(n=e.to-2,c=e.to+1),this._movePiece(c,n)}return e}pgn({newline:t=`
`,maxWidth:e=0}={}){const s=[];let r=!1;for(const _ in this._header)this._header[_]&&s.push(`[${_} "${this._header[_]}"]`+t),r=!0;r&&this._history.length&&s.push(t);const n=_=>{const $=this._comments[this.fen()];if(typeof $<"u"){const E=_.length>0?" ":"";_=`${_}${E}{${$}}`}return _},c=[];for(;this._history.length>0;)c.push(this._undoMove());const h=[];let u="";for(c.length===0&&h.push(n(""));c.length>0;){u=n(u);const _=c.pop();if(!_)break;if(!this._history.length&&_.color==="b"){const $=`${this._moveNumber}. ...`;u=u?`${u} ${$}`:$}else _.color==="w"&&(u.length&&h.push(u),u=this._moveNumber+".");u=u+" "+this._moveToSan(_,this._moves({legal:!0})),this._makeMove(_)}if(u.length&&h.push(n(u)),h.push(this._header.Result||"*"),e===0)return s.join("")+h.join(" ");const p=function(){return s.length>0&&s[s.length-1]===" "?(s.pop(),!0):!1},d=function(_,$){for(const E of $.split(" "))if(E){if(_+E.length>e){for(;p();)_--;s.push(t),_=0}s.push(E),_+=E.length,s.push(" "),_++}return p()&&_--,_};let b=0;for(let _=0;_<h.length;_++){if(b+h[_].length>e&&h[_].includes("{")){b=d(b,h[_]);continue}b+h[_].length>e&&_!==0?(s[s.length-1]===" "&&s.pop(),s.push(t),b=0):_!==0&&(s.push(" "),b++),s.push(h[_]),b+=h[_].length}return s.join("")}header(...t){for(let e=0;e<t.length;e+=2)typeof t[e]=="string"&&typeof t[e+1]=="string"&&(this._header[t[e]]=t[e+1]);return this._header}setHeader(t,e){return this._header[t]=e??xe[t]??null,this.getHeaders()}removeHeader(t){return t in this._header?(this._header[t]=xe[t]||null,!0):!1}getHeaders(){const t={};for(const[e,s]of Object.entries(this._header))s!==null&&(t[e]=s);return t}loadPgn(t,{strict:e=!1,newlineChar:s=`\r?
`}={}){s!==`\r?
`&&(t=t.replace(new RegExp(s,"g"),`
`));const r=$s(t);this.reset();const n=r.headers;let c="";for(const p in n)p.toLowerCase()==="fen"&&(c=n[p]),this.header(p,n[p]);if(!e)c&&this.load(c,{preserveHeaders:!0});else if(n.SetUp==="1"){if(!("FEN"in n))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(n.FEN,{preserveHeaders:!0})}let h=r.root;for(;h;){if(h.move){const p=this._moveFromSan(h.move,e);if(p==null)throw new Error(`Invalid move in PGN: ${h.move}`);this._makeMove(p),this._incPositionCount()}h.comment!==void 0&&(this._comments[this.fen()]=h.comment),h=h.variations[0]}const u=r.result;u&&Object.keys(this._header).length&&this._header.Result!==u&&this.setHeader("Result",u)}_moveToSan(t,e){let s="";if(t.flags&y.KSIDE_CASTLE)s="O-O";else if(t.flags&y.QSIDE_CASTLE)s="O-O-O";else{if(t.flags&y.NULL_MOVE)return $e;if(t.piece!==T){const r=Bs(t,e);s+=t.piece.toUpperCase()+r}t.flags&(y.CAPTURE|y.EP_CAPTURE)&&(t.piece===T&&(s+=I(t.from)[0]),s+="x"),s+=I(t.to),t.promotion&&(s+="="+t.promotion.toUpperCase())}return this._makeMove(t),this.isCheck()&&(this.isCheckmate()?s+="#":s+="+"),this._undoMove(),s}_moveFromSan(t,e=!1){let s=ke(t);if(e||(s==="0-0"?s="O-O":s==="0-0-0"&&(s="O-O-O")),s==$e)return{color:this._turn,from:0,to:0,piece:"k",flags:y.NULL_MOVE};let r=ot(s),n=this._moves({legal:!0,piece:r});for(let _=0,$=n.length;_<$;_++)if(s===ke(this._moveToSan(n[_],n)))return n[_];if(e)return null;let c,h,u,p,d,b=!1;if(h=s.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),h?(c=h[1],u=h[2],p=h[3],d=h[4],u.length==1&&(b=!0)):(h=s.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),h&&(c=h[1],u=h[2],p=h[3],d=h[4],u.length==1&&(b=!0))),r=ot(s),n=this._moves({legal:!0,piece:c||r}),!p)return null;for(let _=0,$=n.length;_<$;_++)if(u){if((!c||c.toLowerCase()==n[_].piece)&&S[u]==n[_].from&&S[p]==n[_].to&&(!d||d.toLowerCase()==n[_].promotion))return n[_];if(b){const E=I(n[_].from);if((!c||c.toLowerCase()==n[_].piece)&&S[p]==n[_].to&&(u==E[0]||u==E[1])&&(!d||d.toLowerCase()==n[_].promotion))return n[_]}}else if(s===ke(this._moveToSan(n[_],n)).replace("x",""))return n[_];return null}ascii(){let t=`   +------------------------+
`;for(let e=S.a8;e<=S.h1;e++){if(ie(e)===0&&(t+=" "+"87654321"[G(e)]+" |"),this._board[e]){const s=this._board[e].type,n=this._board[e].color===M?s.toUpperCase():s.toLowerCase();t+=" "+n+" "}else t+=" . ";e+1&136&&(t+=`|
`,e+=8)}return t+=`   +------------------------+
`,t+="     a  b  c  d  e  f  g  h",t}perft(t){const e=this._moves({legal:!1});let s=0;const r=this._turn;for(let n=0,c=e.length;n<c;n++)this._makeMove(e[n]),this._isKingAttacked(r)||(t-1>0?s+=this.perft(t-1):s++),this._undoMove();return s}setTurn(t){return this._turn==t?!1:(this.move("--"),!0)}turn(){return this._turn}board(){const t=[];let e=[];for(let s=S.a8;s<=S.h1;s++)this._board[s]==null?e.push(null):e.push({square:I(s),type:this._board[s].type,color:this._board[s].color}),s+1&136&&(t.push(e),e=[],s+=8);return t}squareColor(t){if(t in S){const e=S[t];return(G(e)+ie(e))%2===0?"light":"dark"}return null}history({verbose:t=!1}={}){const e=[],s=[];for(;this._history.length>0;)e.push(this._undoMove());for(;;){const r=e.pop();if(!r)break;t?s.push(new fe(this,r)):s.push(this._moveToSan(r,this._moves())),this._makeMove(r)}return s}_getPositionCount(t){return this._positionCount.get(t)??0}_incPositionCount(){this._positionCount.set(this._hash,(this._positionCount.get(this._hash)??0)+1)}_decPositionCount(t){const e=this._positionCount.get(t)??0;e===1?this._positionCount.delete(t):this._positionCount.set(t,e-1)}_pruneComments(){const t=[],e={},s=r=>{r in this._comments&&(e[r]=this._comments[r])};for(;this._history.length>0;)t.push(this._undoMove());for(s(this.fen());;){const r=t.pop();if(!r)break;this._makeMove(r),s(this.fen())}this._comments=e}getComment(){return this._comments[this.fen()]}setComment(t){this._comments[this.fen()]=t.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const t=this._comments[this.fen()];return delete this._comments[this.fen()],t}getComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>({fen:t,comment:this._comments[t]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(t=>{const e=this._comments[t];return delete this._comments[t],{fen:t,comment:e}})}setCastlingRights(t,e){for(const r of[P,Q])e[r]!==void 0&&(e[r]?this._castling[t]|=he[r]:this._castling[t]&=~he[r]);this._updateCastlingRights();const s=this.getCastlingRights(t);return(e[P]===void 0||e[P]===s[P])&&(e[Q]===void 0||e[Q]===s[Q])}getCastlingRights(t){return{[P]:(this._castling[t]&he[P])!==0,[Q]:(this._castling[t]&he[Q])!==0}}moveNumber(){return this._moveNumber}}function js(f){let t,e,s,r,n,c,h="ChillChess",u,p,d='<div class="text-center space-y-2"><h2 class="h2 font-bold text-primary-500">The Immortal Game</h2> <p class="text-sm opacity-70">Anderssen vs. Kieseritzky (1851)</p></div> <hr class="opacity-20"/> <div class="flex justify-center gap-4 text-2xl"><button class="btn-icon variant-soft-surface">⏮️</button> <button class="btn-icon variant-filled-primary shadow-lg scale-110">⏸️</button> <button class="btn-icon variant-soft-surface">⏭️</button></div> <div class="space-y-4 mt-auto"><div class="flex justify-between text-sm"><span>Rainy Cafe</span> <span class="opacity-50">On</span></div> <input type="range" value="50" class="w-full"/></div>';return{c(){t=Z("div"),e=Z("div"),s=Z("div"),r=Z("div"),n=it(),c=Z("h1"),c.textContent=h,u=it(),p=Z("div"),p.innerHTML=d,this.h()},l(b){t=z(b,"DIV",{class:!0});var _=le(t);e=z(_,"DIV",{class:!0});var $=le(e);s=z($,"DIV",{class:!0});var E=le(s);r=z(E,"DIV",{class:!0}),le(r).forEach(ee),E.forEach(ee),n=tt($),c=z($,"H1",{class:!0,"data-svelte-h":!0}),st(c)!=="svelte-1sqixea"&&(c.textContent=h),$.forEach(ee),u=tt(_),p=z(_,"DIV",{class:!0,"data-svelte-h":!0}),st(p)!=="svelte-yoq6tm"&&(p.innerHTML=d),_.forEach(ee),this.h()},h(){Y(r,"class","w-full h-full board-container"),Y(s,"class","glass p-1 rounded-lg shadow-2xl glow-cyan w-full max-w-[80vh] aspect-square"),Y(c,"class","absolute top-8 left-8 text-4xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-primary-400 to-secondary-400 opacity-90"),Y(e,"class","flex-1 flex items-center justify-center p-4 relative"),Y(p,"class","w-full md:w-80 glass border-l border-surface-500/30 p-6 flex flex-col gap-6 backdrop-blur-xl z-20"),Y(t,"class","h-full flex flex-col md:flex-row")},m(b,_){bs(b,t,_),H(t,e),H(e,s),H(s,r),f[1](r),H(e,n),H(e,c),H(t,u),H(t,p)},p:be,i:be,o:be,d(b){b&&ee(t),f[1](null)}}}function Hs(f,t,e){let s,r,n=new Qs;_s(async()=>{const{Chessboard:h,BORDER_TYPE:u}=await us(async()=>{const{Chessboard:p,BORDER_TYPE:d}=await import("../chunks/B02hmuqp.js");return{Chessboard:p,BORDER_TYPE:d}},[],import.meta.url);r=new h(s,{position:n.fen(),style:{cssClass:"default",showCoordinates:!1,borderType:u.thin},responsive:!0,animationDuration:300,sprite:{url:"/assets/images/chessboard-sprite-staunton.svg"}})}),gs(()=>{r&&r.destroy()});function c(h){ds[h?"unshift":"push"](()=>{s=h,e(0,s)})}return[s,c]}class zs extends ms{constructor(t){super(),vs(this,t,Hs,js,ps,{})}}export{zs as component};
