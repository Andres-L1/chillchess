import{_ as ne}from"../chunks/CmsKOCeN.js";import{s as _t,d as i,i as I,y as pt,r as V,e as Ce,v as P,c as Me,o as ht,L as tt,n as me,a as d,b as _,g as Y,f as p,D as vt,p as X,q as o,x as De,l as g,t as B,w as F,m as bt,z as Ve}from"../chunks/BckIrkyu.js";import{S as kt,i as gt,t as Ue,a as ze,c as xt,d as yt,m as Et,b as It,e as wt,g as Tt}from"../chunks/km8sfNIa.js";import{e as Pe,u as Ct,d as Dt}from"../chunks/B19K-gfZ.js";import{p as Vt}from"../chunks/BFllfxPg.js";import{g as Te}from"../chunks/BkPvZzYy.js";import{u as Pt}from"../chunks/Bf7cs9Dz.js";import{a as fe,p as lt}from"../chunks/Dd3AVUpa.js";import{C as St}from"../chunks/BMUu-_ze.js";import{t as Oe}from"../chunks/C-5qQ3rF.js";function rt(s,e,l){const t=s.slice();return t[19]=e[l],t}function st(s,e,l){const t=s.slice();return t[24]=e[l],t}function qe(s){const e=s.slice(),l=e[2].availableAlbums.find(r=>r.id===e[0]?.currentTrack?.albumId);e[22]=l;const t=e[22]?.tracks?.[e[0]?.currentTrack?.trackIndex??0];return e[23]=t,e}function At(s){let e,l,t,r,a,f,c,u,h,n="â† Salir de la Sala",b,w,C=s[0].name+"",E,x,y,m,T=s[0].hostName+"",R,A,k,D,j,M,K="ðŸ“‹ Copiar Enlace",q,S,L,H,G,oe,_e,Se,ce,Z,ee,se,Be="ðŸ‘¥",Ae,te,Le,ue=s[4].length+"",pe,Ne,Re,le,$=[],Fe=new Map,re,je,Ge;t=new St({});let U=s[1]&&at(),O=s[1]&&it(s);function Ye(v,N){return v[0].currentTrack?Rt:Nt}let he=Ye(s),W=he(s);function $e(v,N){return v[0].currentTrack?Mt:v[1]?Ht:jt}let ve=$e(s),J=ve(s),z=s[1]&&ut(),be=Pe(s[4]);const Je=v=>v[19].uid;for(let v=0;v<be.length;v+=1){let N=rt(s,be,v),Q=Je(N);Fe.set(Q,$[v]=mt(Q,N))}return{c(){e=p("div"),l=p("div"),wt(t.$$.fragment),r=P(),a=p("div"),f=p("div"),c=p("div"),u=p("div"),h=p("button"),h.textContent=n,b=P(),w=p("h1"),E=F(C),x=P(),y=p("p"),m=F("Host: "),R=F(T),A=P(),U&&U.c(),k=P(),D=p("div"),O&&O.c(),j=P(),M=p("button"),M.textContent=K,q=P(),S=p("div"),L=p("div"),H=p("div"),G=p("h2"),W.c(),oe=P(),J.c(),_e=P(),z&&z.c(),Se=P(),ce=p("div"),Z=p("div"),ee=p("h3"),se=p("span"),se.textContent=Be,Ae=P(),te=p("span"),Le=F("Participantes ("),pe=F(ue),Ne=F(")"),Re=P(),le=p("div");for(let v=0;v<$.length;v+=1)$[v].c();this.h()},l(v){e=_(v,"DIV",{class:!0});var N=g(e);l=_(N,"DIV",{class:!0});var Q=g(l);It(t.$$.fragment,Q),Q.forEach(i),r=V(N),a=_(N,"DIV",{class:!0});var Ke=g(a);f=_(Ke,"DIV",{class:!0});var ke=g(f);c=_(ke,"DIV",{class:!0});var ge=g(c);u=_(ge,"DIV",{});var ae=g(u);h=_(ae,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(h)!=="svelte-1uuzfzp"&&(h.textContent=n),b=V(ae),w=_(ae,"H1",{class:!0});var Qe=g(w);E=B(Qe,C),Qe.forEach(i),x=V(ae),y=_(ae,"P",{class:!0});var de=g(y);m=B(de,"Host: "),R=B(de,T),A=V(de),U&&U.l(de),de.forEach(i),ae.forEach(i),k=V(ge),D=_(ge,"DIV",{class:!0});var xe=g(D);O&&O.l(xe),j=V(xe),M=_(xe,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(M)!=="svelte-1b72jsd"&&(M.textContent=K),xe.forEach(i),ge.forEach(i),q=V(ke),S=_(ke,"DIV",{class:!0});var ye=g(S);L=_(ye,"DIV",{class:!0});var We=g(L);H=_(We,"DIV",{class:!0});var ie=g(H);G=_(ie,"H2",{class:!0});var Xe=g(G);W.l(Xe),Xe.forEach(i),oe=V(ie),J.l(ie),_e=V(ie),z&&z.l(ie),ie.forEach(i),We.forEach(i),Se=V(ye),ce=_(ye,"DIV",{});var Ze=g(ce);Z=_(Ze,"DIV",{class:!0});var Ee=g(Z);ee=_(Ee,"H3",{class:!0});var Ie=g(ee);se=_(Ie,"SPAN",{"data-svelte-h":!0}),Y(se)!=="svelte-240bj8"&&(se.textContent=Be),Ae=V(Ie),te=_(Ie,"SPAN",{});var we=g(te);Le=B(we,"Participantes ("),pe=B(we,ue),Ne=B(we,")"),we.forEach(i),Ie.forEach(i),Re=V(Ee),le=_(Ee,"DIV",{class:!0});var et=g(le);for(let He=0;He<$.length;He+=1)$[He].l(et);et.forEach(i),Ee.forEach(i),Ze.forEach(i),ye.forEach(i),ke.forEach(i),Ke.forEach(i),N.forEach(i),this.h()},h(){d(l,"class","absolute inset-0"),d(h,"class","text-slate-400 hover:text-white mb-2 flex items-center gap-2"),d(w,"class","text-3xl font-bold"),d(y,"class","text-slate-400 text-sm"),d(M,"class","flex-1 md:flex-none px-4 py-2 bg-white/10 hover:bg-white/20 rounded-lg transition-all text-sm font-medium whitespace-nowrap"),d(D,"class","flex items-center gap-3 w-full md:w-auto"),d(c,"class","flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8"),d(G,"class","text-xl font-bold mb-4"),d(H,"class","bg-black/40 backdrop-blur-xl border border-white/10 rounded-3xl p-8"),d(L,"class","lg:col-span-2"),d(ee,"class","text-lg font-bold mb-4 flex items-center gap-2"),d(le,"class","space-y-3"),d(Z,"class","bg-black/40 backdrop-blur-xl border border-white/10 rounded-3xl p-6 sticky top-8"),d(S,"class","grid grid-cols-1 lg:grid-cols-3 gap-6"),d(f,"class","max-w-6xl mx-auto"),d(a,"class","relative z-10 min-h-screen text-white font-poppins px-4 py-8 md:p-8"),d(e,"class","relative min-h-screen overflow-hidden")},m(v,N){I(v,e,N),o(e,l),Et(t,l,null),o(e,r),o(e,a),o(a,f),o(f,c),o(c,u),o(u,h),o(u,b),o(u,w),o(w,E),o(u,x),o(u,y),o(y,m),o(y,R),o(y,A),U&&U.m(y,null),o(c,k),o(c,D),O&&O.m(D,null),o(D,j),o(D,M),o(f,q),o(f,S),o(S,L),o(L,H),o(H,G),W.m(G,null),o(H,oe),J.m(H,null),o(H,_e),z&&z.m(H,null),o(S,Se),o(S,ce),o(ce,Z),o(Z,ee),o(ee,se),o(ee,Ae),o(ee,te),o(te,Le),o(te,pe),o(te,Ne),o(Z,Re),o(Z,le);for(let Q=0;Q<$.length;Q+=1)$[Q]&&$[Q].m(le,null);re=!0,je||(Ge=[De(h,"click",s[9]),De(M,"click",s[7])],je=!0)},p(v,N){(!re||N&1)&&C!==(C=v[0].name+"")&&X(E,C),(!re||N&1)&&T!==(T=v[0].hostName+"")&&X(R,T),v[1]?U||(U=at(),U.c(),U.m(y,null)):U&&(U.d(1),U=null),v[1]?O?O.p(v,N):(O=it(v),O.c(),O.m(D,j)):O&&(O.d(1),O=null),he!==(he=Ye(v))&&(W.d(1),W=he(v),W&&(W.c(),W.m(G,null))),ve===(ve=$e(v))&&J?J.p(v,N):(J.d(1),J=ve(v),J&&(J.c(),J.m(H,_e))),v[1]?z||(z=ut(),z.c(),z.m(H,null)):z&&(z.d(1),z=null),(!re||N&16)&&ue!==(ue=v[4].length+"")&&X(pe,ue),N&49&&(be=Pe(v[4]),$=Ct($,N,Je,1,v,be,Fe,le,Dt,mt,null,rt))},i(v){re||(ze(t.$$.fragment,v),re=!0)},o(v){Ue(t.$$.fragment,v),re=!1},d(v){v&&i(e),yt(t),U&&U.d(),O&&O.d(),W.d(),J.d(),z&&z.d();for(let N=0;N<$.length;N+=1)$[N].d();je=!1,vt(Ge)}}}function Lt(s){let e,l='<div class="text-center"><div class="inline-block w-16 h-16 border-4 border-primary-500 border-t-transparent rounded-full animate-spin mb-4"></div> <p class="text-slate-400">Conectando...</p></div>';return{c(){e=p("div"),e.innerHTML=l,this.h()},l(t){e=_(t,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-k1cejf"&&(e.innerHTML=l),this.h()},h(){d(e,"class","min-h-screen bg-[#0B1120] text-white font-poppins flex items-center justify-center")},m(t,r){I(t,e,r)},p:me,i:me,o:me,d(t){t&&i(e)}}}function at(s){let e,l="(TÃº)";return{c(){e=p("span"),e.textContent=l,this.h()},l(t){e=_(t,"SPAN",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-ic3m7w"&&(e.textContent=l),this.h()},h(){d(e,"class","text-primary-400 font-bold ml-2")},m(t,r){I(t,e,r)},d(t){t&&i(e)}}}function it(s){let e,l="Cerrar Sala",t,r;return{c(){e=p("button"),e.textContent=l,this.h()},l(a){e=_(a,"BUTTON",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-40mafr"&&(e.textContent=l),this.h()},h(){d(e,"class","flex-1 md:flex-none px-4 py-2 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-lg transition-all text-sm font-medium border border-red-500/20 whitespace-nowrap")},m(a,f){I(a,e,f),t||(r=De(e,"click",s[10]),t=!0)},p:me,d(a){a&&i(e),t=!1,r()}}}function Nt(s){let e;return{c(){e=F("ðŸŽµ Esperando mÃºsica...")},l(l){e=B(l,"ðŸŽµ Esperando mÃºsica...")},m(l,t){I(l,e,t)},d(l){l&&i(e)}}}function Rt(s){let e;return{c(){e=F("ðŸŽµ Reproduciendo")},l(l){e=B(l,"ðŸŽµ Reproduciendo")},m(l,t){I(l,e,t)},d(l){l&&i(e)}}}function jt(s){let e,l="<p>El host aÃºn no ha reproducido nada.</p>";return{c(){e=p("div"),e.innerHTML=l,this.h()},l(t){e=_(t,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-dnto5"&&(e.innerHTML=l),this.h()},h(){d(e,"class","text-center py-12 text-slate-500")},m(t,r){I(t,e,r)},p:me,d(t){t&&i(e)}}}function Ht(s){let e,l,t=`Selecciona un Ã¡lbum para empezar a\r
                                        escuchar juntos`,r,a,f=Pe(s[2].availableAlbums),c=[];for(let u=0;u<f.length;u+=1)c[u]=nt(st(s,f,u));return{c(){e=p("div"),l=p("p"),l.textContent=t,r=P(),a=p("div");for(let u=0;u<c.length;u+=1)c[u].c();this.h()},l(u){e=_(u,"DIV",{class:!0});var h=g(e);l=_(h,"P",{class:!0,"data-svelte-h":!0}),Y(l)!=="svelte-1ebe0br"&&(l.textContent=t),r=V(h),a=_(h,"DIV",{class:!0});var n=g(a);for(let b=0;b<c.length;b+=1)c[b].l(n);n.forEach(i),h.forEach(i),this.h()},h(){d(l,"class","text-slate-400 mb-6"),d(a,"class","grid grid-cols-2 md:grid-cols-3 gap-4 max-h-96 overflow-y-auto px-4"),d(e,"class","text-center py-8")},m(u,h){I(u,e,h),o(e,l),o(e,r),o(e,a);for(let n=0;n<c.length;n+=1)c[n]&&c[n].m(a,null)},p(u,h){if(h&68){f=Pe(u[2].availableAlbums);let n;for(n=0;n<f.length;n+=1){const b=st(u,f,n);c[n]?c[n].p(b,h):(c[n]=nt(b),c[n].c(),c[n].m(a,null))}for(;n<c.length;n+=1)c[n].d(1);c.length=f.length}},d(u){u&&i(e),bt(c,u)}}}function Mt(s){let e,l=s[0].currentTrack&&ot(qe(s));return{c(){l&&l.c(),e=Ce()},l(t){l&&l.l(t),e=Ce()},m(t,r){l&&l.m(t,r),I(t,e,r)},p(t,r){t[0].currentTrack?l?l.p(qe(t),r):(l=ot(qe(t)),l.c(),l.m(e.parentNode,e)):l&&(l.d(1),l=null)},d(t){t&&i(e),l&&l.d(t)}}}function nt(s){let e,l,t,r,a,f,c,u,h=s[24].title+"",n,b,w,C=s[24].artist+"",E,x,y,m;function T(){return s[11](s[24])}return{c(){e=p("button"),l=p("img"),a=P(),f=p("div"),c=p("div"),u=p("p"),n=F(h),b=P(),w=p("p"),E=F(C),x=P(),this.h()},l(R){e=_(R,"BUTTON",{class:!0});var A=g(e);l=_(A,"IMG",{src:!0,alt:!0,class:!0}),a=V(A),f=_(A,"DIV",{class:!0});var k=g(f);c=_(k,"DIV",{class:!0});var D=g(c);u=_(D,"P",{class:!0});var j=g(u);n=B(j,h),j.forEach(i),b=V(D),w=_(D,"P",{class:!0});var M=g(w);E=B(M,C),M.forEach(i),D.forEach(i),k.forEach(i),x=V(A),A.forEach(i),this.h()},h(){Ve(l.src,t=s[24].cover)||d(l,"src",t),d(l,"alt",r=s[24].title),d(l,"class","w-full aspect-square object-cover"),d(u,"class","text-sm font-bold text-white"),d(w,"class","text-xs text-slate-300"),d(c,"class","text-center p-2"),d(f,"class","absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center"),d(e,"class","group relative rounded-xl overflow-hidden hover:scale-105 transition-transform")},m(R,A){I(R,e,A),o(e,l),o(e,a),o(e,f),o(f,c),o(c,u),o(u,n),o(c,b),o(c,w),o(w,E),o(e,x),y||(m=De(e,"click",T),y=!0)},p(R,A){s=R,A&4&&!Ve(l.src,t=s[24].cover)&&d(l,"src",t),A&4&&r!==(r=s[24].title)&&d(l,"alt",r),A&4&&h!==(h=s[24].title+"")&&X(n,h),A&4&&C!==(C=s[24].artist+"")&&X(E,C)},d(R){R&&i(e),y=!1,m()}}}function ot(s){let e,l=s[22]&&s[23]&&ct(s);return{c(){e=p("div"),l&&l.c(),this.h()},l(t){e=_(t,"DIV",{class:!0});var r=g(e);l&&l.l(r),r.forEach(i),this.h()},h(){d(e,"class","text-center")},m(t,r){I(t,e,r),l&&l.m(e,null)},p(t,r){t[22]&&t[23]?l?l.p(t,r):(l=ct(t),l.c(),l.m(e,null)):l&&(l.d(1),l=null)},d(t){t&&i(e),l&&l.d()}}}function ct(s){let e,l,t,r,a,f=s[23].title+"",c,u,h,n=(s[23].artist||s[22].artist)+"",b,w,C;function E(m,T){return m[0].currentTrack.isPlaying?qt:Ot}let x=E(s),y=x(s);return{c(){e=p("img"),r=P(),a=p("h3"),c=F(f),u=P(),h=p("p"),b=F(n),w=P(),C=p("div"),y.c(),this.h()},l(m){e=_(m,"IMG",{src:!0,alt:!0,class:!0}),r=V(m),a=_(m,"H3",{class:!0});var T=g(a);c=B(T,f),T.forEach(i),u=V(m),h=_(m,"P",{class:!0});var R=g(h);b=B(R,n),R.forEach(i),w=V(m),C=_(m,"DIV",{class:!0});var A=g(C);y.l(A),A.forEach(i),this.h()},h(){Ve(e.src,l=s[22].cover)||d(e,"src",l),d(e,"alt",t=s[22].title),d(e,"class","w-64 h-64 mx-auto rounded-2xl shadow-2xl mb-6"),d(a,"class","text-2xl font-bold mb-2"),d(h,"class","text-slate-400 mb-4"),d(C,"class","flex items-center justify-center gap-2")},m(m,T){I(m,e,T),I(m,r,T),I(m,a,T),o(a,c),I(m,u,T),I(m,h,T),o(h,b),I(m,w,T),I(m,C,T),y.m(C,null)},p(m,T){T&5&&!Ve(e.src,l=m[22].cover)&&d(e,"src",l),T&5&&t!==(t=m[22].title)&&d(e,"alt",t),T&5&&f!==(f=m[23].title+"")&&X(c,f),T&5&&n!==(n=(m[23].artist||m[22].artist)+"")&&X(b,n),x!==(x=E(m))&&(y.d(1),y=x(m),y&&(y.c(),y.m(C,null)))},d(m){m&&(i(e),i(r),i(a),i(u),i(h),i(w),i(C)),y.d()}}}function Ot(s){let e,l,t,r="Pausado";return{c(){e=p("div"),l=P(),t=p("span"),t.textContent=r,this.h()},l(a){e=_(a,"DIV",{class:!0}),g(e).forEach(i),l=V(a),t=_(a,"SPAN",{class:!0,"data-svelte-h":!0}),Y(t)!=="svelte-t7ul9k"&&(t.textContent=r),this.h()},h(){d(e,"class","w-3 h-3 bg-slate-500 rounded-full"),d(t,"class","text-slate-500 text-sm font-bold")},m(a,f){I(a,e,f),I(a,l,f),I(a,t,f)},d(a){a&&(i(e),i(l),i(t))}}}function qt(s){let e,l,t,r="Reproduciendo";return{c(){e=p("div"),l=P(),t=p("span"),t.textContent=r,this.h()},l(a){e=_(a,"DIV",{class:!0}),g(e).forEach(i),l=V(a),t=_(a,"SPAN",{class:!0,"data-svelte-h":!0}),Y(t)!=="svelte-fc5aqd"&&(t.textContent=r),this.h()},h(){d(e,"class","w-3 h-3 bg-green-400 rounded-full animate-pulse"),d(t,"class","text-green-400 text-sm font-bold")},m(a,f){I(a,e,f),I(a,l,f),I(a,t,f)},d(a){a&&(i(e),i(l),i(t))}}}function ut(s){let e,l=`<p class="text-sm text-primary-300">ðŸ’¡ Como host, los controles en /app se
                                        sincronizarÃ¡n automÃ¡ticamente aquÃ­.</p>`;return{c(){e=p("div"),e.innerHTML=l,this.h()},l(t){e=_(t,"DIV",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-ikpvgi"&&(e.innerHTML=l),this.h()},h(){d(e,"class","mt-6 p-4 bg-primary-500/10 border border-primary-500/20 rounded-xl")},m(t,r){I(t,e,r)},d(t){t&&i(e)}}}function dt(s){let e,l="Host";return{c(){e=p("p"),e.textContent=l,this.h()},l(t){e=_(t,"P",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-v8jxyn"&&(e.textContent=l),this.h()},h(){d(e,"class","text-xs text-primary-400")},m(t,r){I(t,e,r)},d(t){t&&i(e)}}}function ft(s){let e,l="(TÃº)";return{c(){e=p("span"),e.textContent=l,this.h()},l(t){e=_(t,"SPAN",{class:!0,"data-svelte-h":!0}),Y(e)!=="svelte-199xcym"&&(e.textContent=l),this.h()},h(){d(e,"class","text-xs text-slate-500")},m(t,r){I(t,e,r)},d(t){t&&i(e)}}}function mt(s,e){let l,t,r=(e[19].name[0]?.toUpperCase()||"?")+"",a,f,c,u,h=e[19].name+"",n,b,w,C,E=e[19].uid===e[0].hostId&&dt(),x=e[19].uid===e[5].user?.uid&&ft();return{key:s,first:null,c(){l=p("div"),t=p("div"),a=F(r),f=P(),c=p("div"),u=p("p"),n=F(h),b=P(),E&&E.c(),w=P(),x&&x.c(),C=P(),this.h()},l(y){l=_(y,"DIV",{class:!0});var m=g(l);t=_(m,"DIV",{class:!0});var T=g(t);a=B(T,r),T.forEach(i),f=V(m),c=_(m,"DIV",{class:!0});var R=g(c);u=_(R,"P",{class:!0});var A=g(u);n=B(A,h),A.forEach(i),b=V(R),E&&E.l(R),R.forEach(i),w=V(m),x&&x.l(m),C=V(m),m.forEach(i),this.h()},h(){d(t,"class","w-10 h-10 rounded-full bg-gradient-to-br from-primary-500 to-orange-500 flex items-center justify-center text-sm font-bold"),d(u,"class","text-sm font-medium"),d(c,"class","flex-1"),d(l,"class","flex items-center gap-3 p-3 bg-white/5 rounded-xl"),this.first=l},m(y,m){I(y,l,m),o(l,t),o(t,a),o(l,f),o(l,c),o(c,u),o(u,n),o(c,b),E&&E.m(c,null),o(l,w),x&&x.m(l,null),o(l,C)},p(y,m){e=y,m&16&&r!==(r=(e[19].name[0]?.toUpperCase()||"?")+"")&&X(a,r),m&16&&h!==(h=e[19].name+"")&&X(n,h),e[19].uid===e[0].hostId?E||(E=dt(),E.c(),E.m(c,null)):E&&(E.d(1),E=null),e[19].uid===e[5].user?.uid?x||(x=ft(),x.c(),x.m(l,C)):x&&(x.d(1),x=null)},d(y){y&&i(l),E&&E.d(),x&&x.d()}}}function Ut(s){let e,l,t,r,a,f;document.title=e=(s[0]?.name||"Sala")+" | ChillChess";const c=[Lt,At],u=[];function h(n,b){return n[3]?0:n[0]?1:-1}return~(t=h(s))&&(r=u[t]=c[t](s)),{c(){l=P(),r&&r.c(),a=Ce()},l(n){pt("svelte-16d8z6n",document.head).forEach(i),l=V(n),r&&r.l(n),a=Ce()},m(n,b){I(n,l,b),~t&&u[t].m(n,b),I(n,a,b),f=!0},p(n,[b]){(!f||b&1)&&e!==(e=(n[0]?.name||"Sala")+" | ChillChess")&&(document.title=e);let w=t;t=h(n),t===w?~t&&u[t].p(n,b):(r&&(Tt(),Ue(u[w],1,1,()=>{u[w]=null}),xt()),~t?(r=u[t],r?r.p(n,b):(r=u[t]=c[t](n),r.c()),ze(r,1),r.m(a.parentNode,a)):r=null)},i(n){f||(ze(r),f=!0)},o(n){Ue(r),f=!1},d(n){n&&(i(l),i(a)),~t&&u[t].d(n)}}}function zt(s,e,l){let t,r,a;Me(s,fe,k=>l(2,t=k)),Me(s,Pt,k=>l(5,r=k)),Me(s,Vt,k=>l(15,a=k));const f=a.params.id;let c=null,u=!0,h=!1,n=null,b=[];function w(k){lt(k)}ht(async()=>{if(!r.isLoggedIn){Te("/");return}const{doc:k,onSnapshot:D,updateDoc:j,serverTimestamp:M}=await ne(async()=>{const{doc:S,onSnapshot:L,updateDoc:H,serverTimestamp:G}=await import("../chunks/5dAqgG7A.js").then(oe=>oe.E);return{doc:S,onSnapshot:L,updateDoc:H,serverTimestamp:G}},[],import.meta.url),{db:K}=await ne(async()=>{const{db:S}=await import("../chunks/5dAqgG7A.js").then(L=>L.F);return{db:S}},[],import.meta.url),q=k(K,"listeningRooms",f);if(n=D(q,S=>{if(!S.exists()){alert("Esta sala no existe."),Te("/rooms");return}const L=S.data();l(0,c=L),l(1,h=L.hostId===r.user?.uid),l(4,b=Object.entries(L.participants).map(([H,G])=>({uid:H,name:G.displayName}))),l(3,u=!1)}),r.user)try{await j(q,{[`participants.${r.user.uid}`]:{displayName:r.user.displayName||"Usuario",joinedAt:M()}})}catch(S){console.error("Error joining room:",S)}if(h){m();const S=fe.subscribe(async L=>{if(m(),!L.currentAlbumId)return;const H=L.playlist[L.currentTrackIndex];try{await j(q,{currentTrack:{albumId:L.currentAlbumId,trackIndex:L.currentTrackIndex,isPlaying:L.isPlaying,title:H?.title||"Unknown",timestamp:M()}})}catch(G){console.error("Error syncing:",G)}});tt(()=>{S(),x&&clearTimeout(x)})}}),tt(async()=>{if(n&&n(),r.isLoggedIn&&r.user)try{const{doc:k,updateDoc:D,deleteField:j}=await ne(async()=>{const{doc:q,updateDoc:S,deleteField:L}=await import("../chunks/5dAqgG7A.js").then(H=>H.E);return{doc:q,updateDoc:S,deleteField:L}},[],import.meta.url),{db:M}=await ne(async()=>{const{db:q}=await import("../chunks/5dAqgG7A.js").then(S=>S.F);return{db:q}},[],import.meta.url),K=k(M,"listeningRooms",f);await D(K,{[`participants.${r.user.uid}`]:j()})}catch(k){console.error("Error leaving room:",k)}});function C(){const k=`${window.location.origin}/rooms/${f}`;navigator.clipboard.writeText(k),Oe.success("Enlace copiado al portapapeles")}async function E(k=!1){if(!(!k&&!confirm("Â¿EstÃ¡s seguro de que quieres cerrar esta sala permanentemente? Todos los participantes serÃ¡n desconectados.")))try{const{doc:D,deleteDoc:j}=await ne(async()=>{const{doc:K,deleteDoc:q}=await import("../chunks/5dAqgG7A.js").then(S=>S.E);return{doc:K,deleteDoc:q}},[],import.meta.url),{db:M}=await ne(async()=>{const{db:K}=await import("../chunks/5dAqgG7A.js").then(q=>q.F);return{db:K}},[],import.meta.url);await j(D(M,"listeningRooms",f)),Oe.success(k?"Sala cerrada por inactividad (15 min)":"Sala cerrada exitosamente"),Te("/rooms")}catch(D){console.error("Error closing room:",D),Oe.error("Error al cerrar la sala")}}let x;const y=15*60*1e3;function m(){x&&clearTimeout(x),x=setTimeout(()=>{if(t.isPlaying){m();return}E(!0)},y)}const T=()=>Te("/rooms"),R=()=>E(!1),A=k=>w(k.id);return s.$$.update=()=>{if(s.$$.dirty&7&&c&&!h&&c.currentTrack&&t.availableAlbums.length>0){const k=c.currentTrack,D=t;k.albumId!==D.currentAlbumId?(lt(k.albumId),fe.update(j=>({...j,currentTrackIndex:k.trackIndex}))):k.trackIndex!==D.currentTrackIndex&&fe.update(j=>({...j,currentTrackIndex:k.trackIndex})),k.isPlaying!==D.isPlaying&&fe.update(j=>({...j,isPlaying:k.isPlaying}))}},[c,h,t,u,b,r,w,C,E,T,R,A]}class Zt extends kt{constructor(e){super(),gt(this,e,zt,Ut,_t,{})}}export{Zt as component};
